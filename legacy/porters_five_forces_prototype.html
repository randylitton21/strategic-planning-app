<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Porter's Five Forces - Prototype</title>
    <!-- Google Fonts - Inter for modern, readable typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        /* ============================================
           MODERN DESIGN SYSTEM - BRIGHT & PROFESSIONAL
           ============================================ */

        /* Color Palette - Bright, Futuristic, Professional (No Gradients) */
        :root {
            --primary-color: #5B8DEF;
            --primary-dark: #4A7BC8;
            --primary-light: #7BA3F5;
            --primary-purple: #9333EA;
            --accent-cyan: #00F0FF;
            --accent-purple: #A855F7;
            --accent-blue: #3B82F6;
            --accent-pink: #EC4899;
            --bg-primary: #FFFFFF;
            --bg-secondary: #F8FAFC;
            --bg-tertiary: #F1F5F9;
            --bg-main: #E8F4F8;
            --text-primary: #0F172A;
            --text-secondary: #475569;
            --text-tertiary: #64748B;
            --text-light: #94A3B8;
            --text-white: #FFFFFF;
            --success: #10B981;
            --success-light: #D1FAE5;
            --warning: #F59E0B;
            --warning-light: #FEF3C7;
            --error: #EF4444;
            --error-light: #FEE2E2;
            --info: #3B82F6;
            --info-light: #DBEAFE;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-glow: 0 0 20px rgba(147, 51, 234, 0.3);
            --radius-sm: 0.375rem;
            --radius-md: 0.5rem;
            --radius-lg: 0.75rem;
            --radius-xl: 1rem;
            --radius-2xl: 1.5rem;
            --radius-full: 9999px;
            --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-base: 300ms cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: var(--bg-main);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-primary);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            line-height: 1.6;
            font-weight: 400;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: transparent;
            border-radius: var(--radius-2xl);
            box-shadow: none;
            padding: 30px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            padding-top: 100px;
            border-bottom: 3px solid var(--primary-color);
            position: relative;
            background: var(--primary-color);
            color: var(--text-white);
            border-radius: var(--radius-xl) var(--radius-xl) 0 0;
            box-shadow: var(--shadow-md);
        }

        /* Save Button Styles */
        .save-button-container {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 10;
        }

        .save-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            color: var(--text-white);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 18px;
            border-radius: var(--radius-full);
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            text-decoration: none;
            display: inline-block;
            font-family: 'Inter', sans-serif;
        }

        .save-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .save-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .nav-buttons {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            z-index: 10;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            color: var(--text-white);
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 10px 18px;
            border-radius: var(--radius-full);
            font-size: 0.9em;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-family: 'Inter', sans-serif;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .nav-btn:active {
            transform: translateY(0) scale(1);
        }

        .nav-btn.secondary {
            background: rgba(255, 255, 255, 0.15);
        }

        header h1 {
            color: var(--text-white);
            font-size: 2.75em;
            margin-bottom: 12px;
            font-weight: 800;
            letter-spacing: -0.02em;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .subtitle {
            color: var(--text-white);
            font-size: 1.15em;
            opacity: 0.95;
            font-weight: 400;
        }

        @media (max-width: 768px) {
            .save-button-container {
                position: static;
                text-align: center;
                margin-bottom: 10px;
            }
            
            .nav-buttons {
                position: static;
                justify-content: center;
                margin-bottom: 15px;
            }
            
            header {
                padding-top: 30px;
            }
        }

        /* Porter's Five Forces Grid Layout - Visual Representation */
        .forces-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: auto 1fr auto;
            gap: 20px;
            margin-top: 30px;
            max-width: 1200px;
            margin-left: auto;
            margin-right: auto;
        }

        /* Top: Threat of New Entrants */
        .force-section.new-entrants {
            grid-column: 2;
            grid-row: 1;
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }

        .force-section.new-entrants .section-title {
            color: #f57c00;
        }

        /* Left: Bargaining Power of Suppliers */
        .force-section.suppliers {
            grid-column: 1;
            grid-row: 2;
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }

        .force-section.suppliers .section-title {
            color: #388e3c;
        }

        /* Center: Rivalry Among Existing Competitors */
        .force-section.rivalry {
            grid-column: 2;
            grid-row: 2;
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            border: 3px solid #2196f3;
            position: relative;
        }

        .force-section.rivalry .section-title {
            color: #1976d2;
            font-size: 1.6em;
        }

        .force-section.rivalry::before {
            content: '';
            position: absolute;
            top: -10px;
            left: -10px;
            right: -10px;
            bottom: -10px;
            border: 2px dashed #2196f3;
            border-radius: 8px;
            opacity: 0.3;
            pointer-events: none;
        }

        /* Right: Bargaining Power of Buyers */
        .force-section.buyers {
            grid-column: 3;
            grid-row: 2;
            background: #f3e5f5;
            border-left: 4px solid #9c27b0;
        }

        .force-section.buyers .section-title {
            color: #7b1fa2;
        }

        /* Bottom: Threat of Substitute Products */
        .force-section.substitutes {
            grid-column: 2;
            grid-row: 3;
            background: #fce4ec;
            border-left: 4px solid #e91e63;
        }

        .force-section.substitutes .section-title {
            color: #c2185b;
        }

        .force-section {
            border-radius: 8px;
            padding: 20px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
        }

        .section-header {
            margin-bottom: 15px;
        }

        .section-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-subtitle {
            font-size: 0.9em;
            color: #666;
            font-style: italic;
        }

        .cards-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            padding: 15px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 60px;
        }

        .card.placeholder-card {
            cursor: pointer;
        }

        .card.placeholder-card:hover {
            border-color: #0f4c75;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .card:hover {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transform: translateY(-2px);
        }

        .card.editing {
            border-color: #0f4c75;
            box-shadow: 0 0 0 3px rgba(15, 76, 117, 0.1);
        }

        .card-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .card-text {
            flex: 1;
            font-size: 0.95em;
            line-height: 1.5;
        }

        .card-text.empty {
            color: #999;
            font-style: italic;
        }

        .card-actions {
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .card:hover .card-actions {
            opacity: 1;
        }

        .btn-icon {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            color: #666;
            transition: color 0.2s;
        }

        .btn-icon:hover {
            color: #0f4c75;
        }

        .btn-add-card {
            background: rgba(255, 255, 255, 0.8);
            border: 2px dashed #999;
            border-radius: 6px;
            padding: 12px;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .btn-add-card:hover {
            background: rgba(255, 255, 255, 1);
            border-color: #0f4c75;
            color: #0f4c75;
        }

        .card-input {
            width: 100%;
            border: none;
            outline: none;
            font-size: 0.95em;
            font-family: inherit;
            resize: none;
            min-height: 60px;
            padding: 0;
        }

        .save-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            font-size: 0.9em;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            opacity: 0;
            transform: translateY(-10px);
            transition: all 0.3s ease;
            z-index: 1000;
            pointer-events: none;
        }

        .save-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        /* Help Box */
        .video-link-btn:hover {
            background: #CC0000 !important;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 0, 0, 0.4) !important;
        }

        .video-link-btn[style*="background: #6B7280"]:hover {
            background: #4B5563 !important;
            box-shadow: 0 4px 12px rgba(107, 114, 128, 0.4) !important;
        }

        .video-link-btn:active {
            transform: translateY(0);
        }

        .help-box {
            background: #f8f9fa;
            border-left: 4px solid #0f4c75;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }

        .help-box.collapsible {
            transition: all 0.3s ease;
        }

        .help-box.collapsed .help-content {
            display: none;
        }

        .help-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .help-box h3 {
            color: #0f4c75;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .help-box p {
            color: #666;
            line-height: 1.6;
            font-size: 0.95em;
        }

        .help-box .example {
            margin-top: 15px;
            padding: 12px;
            background: #e7f3ff;
            border-left: 3px solid #2196f3;
            border-radius: 4px;
        }

        .help-toggle {
            background: none;
            border: none;
            font-size: 1.2em;
            cursor: pointer;
            padding: 0;
            margin-left: 8px;
            opacity: 0.7;
            transition: opacity 0.2s;
        }

        .help-toggle:hover {
            opacity: 1;
        }

        .toggle-btn {
            background: #0f4c75;
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }

        .toggle-btn:hover {
            background: #3282b8;
            transform: scale(1.1);
        }

        /* Contextual Help Modal */
        .contextual-help-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .contextual-help-modal.show {
            display: flex;
        }

        .contextual-help-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .contextual-help-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #666;
            line-height: 1;
        }

        .contextual-help-close:hover {
            color: #0f4c75;
        }

        .contextual-help-content h4 {
            color: #0f4c75;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .example-box {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .example-box ul {
            margin-top: 10px;
            margin-left: 20px;
        }

        .example-box li {
            margin-bottom: 8px;
            color: #333;
        }

        /* Template Library */
        .template-library {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .template-library.show {
            display: flex;
        }

        .template-library-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .template-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .template-item {
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-item:hover {
            border-color: #0f4c75;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .template-item h5 {
            color: #0f4c75;
            margin-bottom: 8px;
        }

        .template-item p {
            font-size: 0.85em;
            color: #666;
        }

        /* Learn Menu Modal */
        .learn-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .learn-menu.show {
            display: flex;
        }

        .learn-menu-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .learn-menu-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #666;
            line-height: 1;
        }

        .learn-menu-close:hover {
            color: #0f4c75;
        }

        .learn-menu h2 {
            color: #0f4c75;
            margin-bottom: 20px;
        }

        .learn-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .learn-section:last-child {
            border-bottom: none;
        }

        .learn-section h3 {
            color: #0f4c75;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .learn-section ul {
            list-style: none;
            padding-left: 0;
        }

        .learn-section li {
            padding: 8px 0;
            cursor: pointer;
            color: #333;
            transition: color 0.2s;
        }

        .learn-section li:hover {
            color: #0f4c75;
        }

        .learn-section li:before {
            content: "‚Üí ";
            color: #0f4c75;
            margin-right: 5px;
        }

        /* Examples Mode */
        .examples-mode-overlay {
            position: fixed;
            top: 0;
            right: 0;
            width: 400px;
            height: 100%;
            background: white;
            box-shadow: -4px 0 12px rgba(0, 0, 0, 0.15);
            z-index: 1500;
            overflow-y: auto;
            padding: 20px;
            display: none;
        }

        .examples-mode-overlay.show {
            display: block;
        }

        .examples-mode-overlay h3 {
            color: #0f4c75;
            margin-bottom: 15px;
            border-bottom: 2px solid #0f4c75;
            padding-bottom: 10px;
        }

        .example-section {
            margin-bottom: 25px;
        }

        .example-section h4 {
            color: #0f4c75;
            font-size: 1em;
            margin-bottom: 10px;
        }

        .example-card {
            background: #f8f9fa;
            border-left: 4px solid #0f4c75;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        /* Validation Indicators */
        .validation-indicator {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
        }

        .validation-indicator.valid {
            background: #4caf50;
            color: white;
        }

        .validation-indicator.warning {
            background: #ff9800;
            color: white;
        }

        .validation-indicator.suggestion {
            background: #2196f3;
            color: white;
        }

        @media (max-width: 1024px) {
            .forces-grid {
                grid-template-columns: 1fr;
                grid-template-rows: auto;
            }

            .force-section.new-entrants,
            .force-section.suppliers,
            .force-section.rivalry,
            .force-section.buyers,
            .force-section.substitutes {
                grid-column: 1;
                grid-row: auto;
            }
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 2em;
            }

            .container {
                padding: 15px;
            }
        }

        /* Export Options */
        .export-options {
            position: relative;
            display: inline-block;
        }

        .export-dropdown {
            display: none;
            position: absolute;
            bottom: 100%;
            right: 0;
            margin-bottom: 10px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            min-width: 200px;
            z-index: 1000;
            overflow: hidden;
        }

        .export-dropdown.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .export-option {
            display: block;
            width: 100%;
            padding: 12px 20px;
            background: white;
            border: none;
            border-bottom: 1px solid #e0e0e0;
            text-align: left;
            cursor: pointer;
            font-size: 0.95em;
            color: #333;
            transition: background 0.2s;
        }

        .export-option:last-child {
            border-bottom: none;
        }

        .export-option:hover {
            background: #f5f5f5;
        }

        .export-option:active {
            background: #e0e0e0;
        }

        .btn-control,
        .btn-export {
            padding: 14px 32px;
            border: none;
            border-radius: var(--radius-full);
            font-size: 1.05em;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-base);
            -webkit-tap-highlight-color: transparent;
            font-family: 'Inter', sans-serif;
            letter-spacing: -0.01em;
            position: relative;
            overflow: hidden;
            background: var(--primary-color);
            color: var(--text-white);
            box-shadow: var(--shadow-md);
        }

        .btn-control:hover,
        .btn-export:hover {
            background: var(--primary-dark);
            transform: translateY(-3px) scale(1.02);
            box-shadow: var(--shadow-xl), var(--shadow-glow);
        }

        .btn-control:active,
        .btn-export:active {
            transform: translateY(-1px) scale(1);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="nav-buttons">
                <a href="prototypes_home.html" class="nav-btn secondary">üè† Home</a>
                <a href="main_app_prototype.html" class="nav-btn">üìñ Strategic Plan</a>
                <a href="goal_setting_template_prototype.html" class="nav-btn">üéØ Goal Setting</a>
                <a href="strategic_canvas_prototype.html" class="nav-btn">üé® Strategic Canvas</a>
                <a href="strategic_action_plan_prototype.html" class="nav-btn">üìã Action Plan</a>
                <a href="contingency_plan_prototype.html" class="nav-btn">üõ°Ô∏è Contingency Plan</a>
                <a href="product_canvas_prototype.html" class="nav-btn">üìä Product Canvas</a>
            </div>
            <h1>Porter's Five Forces</h1>
            <p class="subtitle">Analyze competitive intensity and industry attractiveness</p>
        </header>

        <div class="help-box collapsible" id="mainHelpBox">
            <div class="help-header" onclick="toggleHelpBox(this)">
                <h3>About Porter's Five Forces</h3>
                <button class="toggle-btn" aria-label="Toggle section">‚àí</button>
            </div>
            <div class="help-content">
                <p>Porter's Five Forces cuts through the BS and shows you exactly what's going on in your market. It helps you understand why some industries make tons of money while others struggle. Use this to spot opportunities, avoid disasters, and make smart decisions about entering new markets or competing where you are.</p>
                <div class="example">
                    <strong>How to Use:</strong> Go through each of the five forces in your industry. Figure out what makes each force stronger or weaker. This tells you where you stand competitively and helps you spot opportunities or threats before they bite you.
                </div>
                <div class="video-link-section" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--primary-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        <span>üìπ</span> Video Tutorials
                    </h4>
                    <div style="margin-bottom: 15px;">
                        <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">üéì Harvard Business Review (Recommended):</p>
                        <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">Harvard Business Review: Strategic insights on understanding competitive forces and industry dynamics through Porter's Five Forces framework.</p>
                        <a href="https://www.youtube.com/watch?v=mYF2_FBCvXw&t=186s" target="_blank" rel="noopener noreferrer" 
                           class="video-link-btn" 
                           style="display: inline-flex; align-items: center; gap: 8px; background: #FF0000; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(255, 0, 0, 0.3); margin-bottom: 15px;">
                            <span>‚ñ∂Ô∏è</span> Watch HBR Video
                        </a>
                    </div>
                    <div style="padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1);">
                        <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">üìö Basic Tutorial (For Beginners):</p>
                        <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">Simple explanation of Porter's Five Forces model for beginners - understand how to analyze industry competition.</p>
                        <a href="https://www.youtube.com/watch?v=XCWHSeDU-zk" target="_blank" rel="noopener noreferrer" 
                           class="video-link-btn" 
                           style="display: inline-flex; align-items: center; gap: 8px; background: #6B7280; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3);">
                            <span>‚ñ∂Ô∏è</span> Watch Basic Tutorial
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Control Buttons -->
        <div style="text-align: center; margin-bottom: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
            <button class="btn-control" onclick="showTemplateLibrary()" style="background: var(--info); color: white; border: none; padding: 12px 24px; border-radius: var(--radius-full); cursor: pointer; font-weight: 600; font-family: 'Inter', sans-serif;">
                üìö Load Template
            </button>
            <button class="btn-control" onclick="showLearnMenu()" style="background: var(--text-tertiary); color: white; border: none; padding: 12px 24px; border-radius: var(--radius-full); cursor: pointer; font-weight: 600; font-family: 'Inter', sans-serif;">
                üìñ Learn
            </button>
            <button class="btn-control" onclick="toggleExamplesMode()" id="examplesModeBtn" style="background: var(--success); color: white; border: none; padding: 12px 24px; border-radius: var(--radius-full); cursor: pointer; font-weight: 600; font-family: 'Inter', sans-serif;">
                üëÅÔ∏è View Examples
            </button>
            <button class="btn-control" onclick="triggerImportWordExport()" style="background: #9c27b0; color: white; border: none; padding: 12px 24px; border-radius: var(--radius-full); cursor: pointer; font-weight: 600; font-family: 'Inter', sans-serif;">
                üì§ Import Analysis
            </button>
            <div class="export-options" style="position: relative; display: inline-block;">
                <button class="btn-control btn-export" onclick="showExportOptions()" style="background: var(--primary-color); color: white; border: none; padding: 12px 24px; border-radius: var(--radius-full); cursor: pointer; font-weight: 600; font-family: 'Inter', sans-serif;">
                    üì• Export Analysis
                </button>
                <div class="export-dropdown" id="exportDropdown">
                    <button class="export-option" onclick="exportPortersFiveForces('txt')">Export as Text (.txt)</button>
                    <button class="export-option" onclick="exportPortersFiveForces('docx')">Export as Word (.docx)</button>
                    <button class="export-option" onclick="exportPortersFiveForces('xlsx')">Export as Excel (.xlsx)</button>
                </div>
            </div>
        </div>

        <div class="forces-grid">
            <!-- Threat of New Entrants (Top) -->
            <div class="force-section new-entrants">
                <div class="section-header">
                    <div class="section-title">
                        Threat of New Entrants
                        <button class="help-toggle" onclick="showContextualHelp('new-entrants')" aria-label="Learn about threat of new entrants">‚ÑπÔ∏è</button>
                    </div>
                    <div class="section-subtitle">How easy is it for new competitors to enter?</div>
                </div>
                <div class="cards-container" data-section="new-entrants">
                    <!-- Cards will be added here -->
                </div>
                <button class="btn-add-card" onclick="addCard('new-entrants')">+ Add Factor</button>
            </div>

            <!-- Bargaining Power of Suppliers (Left) -->
            <div class="force-section suppliers">
                <div class="section-header">
                    <div class="section-title">
                        Bargaining Power of Suppliers
                        <button class="help-toggle" onclick="showContextualHelp('suppliers')" aria-label="Learn about supplier power">‚ÑπÔ∏è</button>
                    </div>
                    <div class="section-subtitle">How much power do suppliers have?</div>
                </div>
                <div class="cards-container" data-section="suppliers">
                    <!-- Cards will be added here -->
                </div>
                <button class="btn-add-card" onclick="addCard('suppliers')">+ Add Factor</button>
            </div>

            <!-- Rivalry Among Existing Competitors (Center) -->
            <div class="force-section rivalry">
                <div class="section-header">
                    <div class="section-title">
                        Rivalry Among Existing Competitors
                        <button class="help-toggle" onclick="showContextualHelp('rivalry')" aria-label="Learn about competitive rivalry">‚ÑπÔ∏è</button>
                    </div>
                    <div class="section-subtitle">How intense is competition between existing players?</div>
                </div>
                <div class="cards-container" data-section="rivalry">
                    <!-- Cards will be added here -->
                </div>
                <button class="btn-add-card" onclick="addCard('rivalry')">+ Add Factor</button>
            </div>

            <!-- Bargaining Power of Buyers (Right) -->
            <div class="force-section buyers">
                <div class="section-header">
                    <div class="section-title">
                        Bargaining Power of Buyers
                        <button class="help-toggle" onclick="showContextualHelp('buyers')" aria-label="Learn about buyer power">‚ÑπÔ∏è</button>
                    </div>
                    <div class="section-subtitle">How much power do customers have?</div>
                </div>
                <div class="cards-container" data-section="buyers">
                    <!-- Cards will be added here -->
                </div>
                <button class="btn-add-card" onclick="addCard('buyers')">+ Add Factor</button>
            </div>

            <!-- Threat of Substitute Products (Bottom) -->
            <div class="force-section substitutes">
                <div class="section-header">
                    <div class="section-title">
                        Threat of Substitute Products
                        <button class="help-toggle" onclick="showContextualHelp('substitutes')" aria-label="Learn about substitute threats">‚ÑπÔ∏è</button>
                    </div>
                    <div class="section-subtitle">What alternatives exist for customers?</div>
                </div>
                <div class="cards-container" data-section="substitutes">
                    <!-- Cards will be added here -->
                </div>
                <button class="btn-add-card" onclick="addCard('substitutes')">+ Add Factor</button>
            </div>
        </div>
    </div>

    <div class="save-indicator" id="saveIndicator">Saved</div>

    <!-- Contextual Help Modal -->
    <div class="contextual-help-modal" id="contextualHelpModal" onclick="closeContextualHelp(event)">
        <div class="contextual-help-content" onclick="event.stopPropagation()">
            <button class="contextual-help-close" onclick="closeContextualHelp()">&times;</button>
            <div id="contextualHelpContent"></div>
        </div>
    </div>

    <!-- Examples Mode Overlay -->
    <div class="examples-mode-overlay" id="examplesModeOverlay">
        <h3>Example Analysis</h3>
        <div id="examplesModeContent"></div>
    </div>

    <!-- Learn Menu Modal -->
    <div class="learn-menu" id="learnMenu" onclick="closeLearnMenu(event)">
        <div class="learn-menu-content" onclick="event.stopPropagation()">
            <button class="learn-menu-close" onclick="closeLearnMenu()">&times;</button>
            <h2>üìö Learn Center</h2>
            <div class="learn-section">
                <h3>Porter's Five Forces Guide</h3>
                <ul>
                    <li onclick="showLearnContent('porters-overview')">What is Porter's Five Forces?</li>
                    <li onclick="showLearnContent('porters-forces')">Understanding Each Force</li>
                    <li onclick="showLearnContent('porters-best-practices')">Best Practices</li>
                    <li onclick="showLearnContent('porters-common-mistakes')">Common Mistakes</li>
                </ul>
            </div>
            <div class="learn-section">
                <h3>Strategic Canvas Guide</h3>
                <ul>
                    <li onclick="showLearnContent('canvas-overview')">What is Strategic Canvas?</li>
                    <li onclick="showLearnContent('canvas-sections')">How to Use Each Section</li>
                    <li onclick="showLearnContent('canvas-best-practices')">Best Practices</li>
                    <li onclick="showLearnContent('canvas-common-mistakes')">Common Mistakes</li>
                </ul>
            </div>
            <div class="learn-section">
                <h3>Action Plan Guide</h3>
                <ul>
                    <li onclick="showLearnContent('action-goals')">Creating Effective Goals</li>
                    <li onclick="showLearnContent('action-steps')">Defining Action Steps</li>
                    <li onclick="showLearnContent('action-responsibilities')">Assigning Responsibilities</li>
                    <li onclick="showLearnContent('action-tracking')">Tracking Progress</li>
                </ul>
            </div>
            <div class="learn-section">
                <h3>Best Practices</h3>
                <ul>
                    <li onclick="showLearnContent('fundamentals')">Strategic Planning Fundamentals</li>
                    <li onclick="showLearnContent('frameworks')">Common Frameworks</li>
                    <li onclick="showLearnContent('expert-tips')">Expert Tips</li>
                </ul>
            </div>
            <div id="learnContentDisplay" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #0f4c75; display: none;">
                <div id="learnContentText"></div>
                <button onclick="hideLearnContent()" style="margin-top: 15px; padding: 8px 16px; background: #0f4c75; color: white; border: none; border-radius: 6px; cursor: pointer;">Close</button>
            </div>
        </div>
    </div>

    <!-- Template Library Modal -->
    <div class="template-library" id="templateLibrary" onclick="closeTemplateLibrary(event)">
        <div class="template-library-content" onclick="event.stopPropagation()">
            <button class="contextual-help-close" onclick="closeTemplateLibrary()">&times;</button>
            <h3 style="color: #0f4c75; margin-bottom: 20px;">üìö Template Library</h3>
            <p style="color: #666; margin-bottom: 20px;">Choose a template to load example data and learn best practices:</p>
            <div class="template-list" id="templateList">
                <!-- Templates will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Premium gate: require login (Strategic Planning is the only free tool)
        (function requireLoginForPremium() {
            function getSessionUsername() {
                try {
                    var raw = sessionStorage.getItem('prototype_userSession');
                    if (!raw) return null;
                    var data = JSON.parse(raw);
                    return (data && data.user && data.user.username) || data.username || null;
                } catch (e) { return null; }
            }

            if (!getSessionUsername()) {
                var page = window.location.pathname.split('/').pop() + window.location.search + window.location.hash;
                window.location.replace('prototypes_home.html?action=login&return=' + encodeURIComponent(page));
            }
        })();

        // Data structure to store five forces data
        let forcesData = {
            'new-entrants': [],
            'suppliers': [],
            'rivalry': [],
            'buyers': [],
            'substitutes': []
        };

        // Store user's data when loading templates
        let userDataBackup = null;

        // Get current username from session
        function getCurrentUsername() {
            try {
                var session = sessionStorage.getItem('prototype_userSession');
                if (session) {
                    var sessionData = JSON.parse(session);
                    return sessionData.user ? sessionData.user.username : null;
                }
            } catch (e) {
                console.log('Could not get username from session');
            }
            return null;
        }

        // Load saved data on page load (user-specific)
        function loadSavedData() {
            var username = getCurrentUsername();
            if (!username) {
                return;
            }
            
            try {
                var storageKey = 'portersFiveForcesData_' + username;
                var saved = localStorage.getItem(storageKey);
                if (saved) {
                    forcesData = JSON.parse(saved);
                    renderAllCards();
                }
            } catch (e) {
                console.log('Could not load saved data');
            }
        }

        // Save data to localStorage (user-specific, auto-save)
        function saveData() {
            var username = getCurrentUsername();
            if (!username) {
                // Not logged in - don't save
                return;
            }
            
            try {
                var storageKey = 'portersFiveForcesData_' + username;
                localStorage.setItem(storageKey, JSON.stringify(forcesData));
                showSaveIndicator();
            } catch (e) {
                console.log('Could not save data');
            }
        }

        // Show save indicator
        function showSaveIndicator() {
            const indicator = document.getElementById('saveIndicator');
            indicator.classList.add('show');
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // Import functionality
        function triggerImportWordExport() {
            var input = document.getElementById('importWordExportInput');
            if (!input) return;
            input.value = '';
            input.click();
        }

        // Hook up import input change
        try {
            var __importInput = document.getElementById('importWordExportInput');
            if (__importInput) {
                __importInput.addEventListener('change', function(e) {
                    var file = e.target.files && e.target.files[0];
                    if (file) importPortersFiveForcesFromWordExport(file);
                });
            }
        } catch (e) { /* ignore */ }

        function importPortersFiveForcesFromWordExport(file) {
            if (!file) return;
            if (!confirm('This will replace your current Porter\'s Five Forces analysis with the contents of the uploaded export. Continue?')) {
                return;
            }

            var reader = new FileReader();
            reader.onerror = function() {
                alert('Could not read the file. Please try again.');
            };
            reader.onload = function() {
                try {
                    var buf = reader.result;
                    var bytes = new Uint8Array(buf);
                    // Detect real DOCX zip (PK..). We cannot parse zipped OOXML without a library.
                    if (bytes && bytes.length >= 2 && bytes[0] === 0x50 && bytes[1] === 0x4B) {
                        alert('That looks like a standard Word .docx (zipped) file. This importer supports the Word export generated by this app (HTML in a .doc/.docx). Please upload the file you downloaded from the Export button in this app.');
                        return;
                    }

                    var text = new TextDecoder('utf-8', { fatal: false }).decode(bytes);
                    // Basic sanity check that it's our exported HTML
                    if (text.indexOf('PORTER\'S FIVE FORCES') === -1 || text.indexOf('class="meta"') === -1) {
                        alert('This file does not look like a Porter\'s Five Forces export from this app. Please export using "Export as Word" and upload that file.');
                        return;
                    }

                    var imported = parsePortersFiveForcesFromExportHtml(text);
                    if (!imported) {
                        alert('Could not parse the uploaded export. Please try re-exporting and importing again.');
                        return;
                    }

                    // Apply imported data
                    forcesData = imported;
                    renderAllSections();
                    saveData();
                    alert('‚úÖ Imported your Porter\'s Five Forces analysis from the Word export.');
                } catch (err) {
                    console.error(err);
                    alert('Import failed. Please try again with a fresh export from this app.');
                }
            };
            reader.readAsArrayBuffer(file);
        }

        function parsePortersFiveForcesFromExportHtml(htmlText) {
            var doc;
            try {
                doc = new DOMParser().parseFromString(htmlText, 'text/html');
            } catch (e) {
                return null;
            }
            if (!doc) return null;

            function norm(s) {
                if (!s) return '';
                return String(s)
                    .replace(/\r\n/g, '\n')
                    .replace(/\r/g, '\n')
                    .replace(/[ \t]+\n/g, '\n')
                    .replace(/\n{3,}/g, '\n\n')
                    .trim();
            }

            function textOf(el) {
                if (!el) return '';
                return norm(el.innerText || el.textContent || '');
            }

            // Initialize empty forces data structure
            var importedData = {
                'new-entrants': [],
                'suppliers': [],
                'buyers': [],
                'substitutes': [],
                'rivals': []
            };

            const sectionNames = {
                'New Entrants': 'new-entrants',
                'Supplier Power': 'suppliers',
                'Buyer Power': 'buyers',
                'Substitute Products': 'substitutes',
                'Industry Rivalry': 'rivals'
            };

            // Find all h2 sections
            var sections = doc.querySelectorAll('h2');
            for (var i = 0; i < sections.length; i++) {
                var sectionTitle = norm(sections[i].textContent || '');
                var sectionKey = sectionNames[sectionTitle];

                if (sectionKey && importedData[sectionKey] !== undefined) {
                    // Find the next ul after this h2
                    var current = sections[i];
                    var ul = null;
                    while (current = current.nextElementSibling) {
                        if (current.tagName === 'UL') {
                            ul = current;
                            break;
                        }
                        if (current.tagName === 'H2') break; // Stop at next section
                    }

                    if (ul) {
                        var lis = ul.querySelectorAll('li');
                        for (var j = 0; j < lis.length; j++) {
                            var cardText = textOf(lis[j]);
                            if (cardText) {
                                importedData[sectionKey].push({
                                    id: Date.now().toString() + Math.random().toString(16).slice(2),
                                    text: cardText
                                });
                            }
                        }
                    }
                }
            }

            return importedData;
        }

        // Add a new card to a section
        function addCard(section) {
            const cardId = Date.now().toString();
            const card = {
                id: cardId,
                text: ''
            };
            
            forcesData[section].push(card);
            renderSection(section);
            saveData();
            
            // Focus on the new card and start editing immediately
            setTimeout(() => {
                const cardElement = document.querySelector(`[data-card-id="${cardId}"]`);
                if (cardElement) {
                    startEditing(section, cardId);
                }
            }, 50);
        }

        // Delete a card
        function deleteCard(section, cardId) {
            forcesData[section] = forcesData[section].filter(card => card.id !== cardId);
            renderSection(section);
            saveData();
        }

        // Update card text
        function updateCardText(section, cardId, text) {
            const card = forcesData[section].find(c => c.id === cardId);
            if (card) {
                card.text = text;
                saveData();
            }
        }

        // Render all cards
        function renderAllCards() {
            Object.keys(forcesData).forEach(section => {
                renderSection(section);
            });
        }

        // Render cards for a specific section
        function renderSection(section) {
            const container = document.querySelector(`[data-section="${section}"]`);
            if (!container) return;

            container.innerHTML = '';

            const cards = forcesData[section] || [];

            if (cards.length === 0) {
                // Show placeholder
                const placeholder = document.createElement('div');
                placeholder.className = 'card placeholder-card';
                placeholder.setAttribute('data-section', section);
                placeholder.innerHTML = `
                    <div class="card-content">
                        <div class="card-text empty">Click to add a factor</div>
                    </div>
                `;
                placeholder.onclick = (e) => {
                    e.stopPropagation();
                    addCard(section);
                };
                container.appendChild(placeholder);
            } else {
                cards.forEach(card => {
                    const cardElement = createCardElement(section, card);
                    container.appendChild(cardElement);
                    // Trigger validation after rendering
                    setTimeout(() => updateCardValidation(section, card.id), 100);
                });
            }
        }

        // Create card element
        function createCardElement(section, card) {
            const cardDiv = document.createElement('div');
            cardDiv.className = 'card';
            cardDiv.setAttribute('data-card-id', card.id);

            const isEditing = card.text === '' || cardDiv.classList.contains('editing');

            cardDiv.innerHTML = `
                <div class="card-content">
                    <div class="card-text" style="display: ${isEditing ? 'none' : 'block'}">
                        ${card.text || '<span class="empty">Click to add a factor</span>'}
                    </div>
                    <textarea 
                        class="card-input" 
                        style="display: ${isEditing ? 'block' : 'none'}"
                        placeholder="Enter your text here..."
                        onblur="finishEditing('${section}', '${card.id}', this)"
                        onkeydown="handleCardKeydown(event, '${section}', '${card.id}', this)"
                    >${card.text}</textarea>
                    <div class="card-actions">
                        <button class="btn-icon btn-edit" onclick="startEditing('${section}', '${card.id}')" title="Edit">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                        </button>
                        <button class="btn-icon btn-delete" onclick="deleteCard('${section}', '${card.id}')" title="Delete">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M3 6h18"></path>
                                <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `;

            // Auto-start editing if card is empty
            if (!card.text) {
                setTimeout(() => {
                    startEditing(section, card.id);
                }, 50);
            }

            return cardDiv;
        }

        // Start editing a card
        function startEditing(section, cardId) {
            const cardElement = document.querySelector(`[data-card-id="${cardId}"]`);
            if (!cardElement) return;

            cardElement.classList.add('editing');
            const textDiv = cardElement.querySelector('.card-text');
            const input = cardElement.querySelector('.card-input');

            if (textDiv && input) {
                textDiv.style.display = 'none';
                input.style.display = 'block';
                input.focus();
                input.select();
            }
        }

        // Finish editing a card
        function finishEditing(section, cardId, inputElement) {
            const text = inputElement.value.trim();
            updateCardText(section, cardId, text);

            const cardElement = document.querySelector(`[data-card-id="${cardId}"]`);
            if (!cardElement) return;

            cardElement.classList.remove('editing');
            const textDiv = cardElement.querySelector('.card-text');
            const input = cardElement.querySelector('.card-input');

            if (textDiv && input) {
                textDiv.innerHTML = text || '<span class="empty">Click to add a factor</span>';
                textDiv.style.display = 'block';
                input.style.display = 'none';
            }
            
            // Trigger validation after editing
            setTimeout(() => updateCardValidation(section, cardId), 300);
        }

        // Handle keyboard events in card input
        function handleCardKeydown(event, section, cardId, inputElement) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                finishEditing(section, cardId, inputElement);
            } else if (event.key === 'Escape') {
                finishEditing(section, cardId, inputElement);
            }
        }

        // Click on card to edit
        document.addEventListener('click', function(e) {
            const card = e.target.closest('.card');
            if (card && !card.classList.contains('editing')) {
                // Check if it's a placeholder card - let its own onclick handle it
                if (card.classList.contains('placeholder-card')) {
                    return;
                }
                
                const cardId = card.getAttribute('data-card-id');
                if (cardId) {
                    const section = card.closest('[data-section]')?.getAttribute('data-section');
                    if (section) {
                        startEditing(section, cardId);
                    }
                }
            }
        });

        // ============================================
        // PHASE 1: EDUCATIONAL FEATURES
        // ============================================

        // Toggle help box (collapsible)
        function toggleHelpBox(header) {
            const helpBox = header.closest('.help-box');
            if (helpBox) {
                helpBox.classList.toggle('collapsed');
                const toggleBtn = header.querySelector('.toggle-btn');
                if (toggleBtn) {
                    toggleBtn.textContent = helpBox.classList.contains('collapsed') ? '+' : '‚àí';
                }
            }
        }

        // Contextual Help Content
        const contextualHelpContent = {
            'new-entrants': {
                title: 'Threat of New Entrants',
                content: `
                    <p>This force looks at how easy or hard it is for new competitors to jump into your market.</p>
                    <div class="example-box">
                        <strong>High Threat (Easy Entry) Factors:</strong>
                        <ul>
                            <li>Low capital requirements</li>
                            <li>Minimal regulatory barriers</li>
                            <li>No significant economies of scale</li>
                            <li>Low brand loyalty</li>
                            <li>Easy access to distribution channels</li>
                        </ul>
                        <strong>Low Threat (Barriers to Entry) Factors:</strong>
                        <ul>
                            <li>High capital investment required</li>
                            <li>Strong brand loyalty</li>
                            <li>Significant economies of scale</li>
                            <li>Regulatory restrictions or licenses</li>
                            <li>Proprietary technology or patents</li>
                            <li>Limited access to distribution</li>
                        </ul>
                        <strong>Best Practices:</strong>
                        <ul>
                            <li>Identify specific barriers that protect your industry</li>
                            <li>Consider how technology might lower barriers</li>
                            <li>Assess the likelihood of new entrants in the next 2-3 years</li>
                            <li>Think about what would make entry easier or harder</li>
                        </ul>
                    </div>
                `
            },
            'suppliers': {
                title: 'Bargaining Power of Suppliers',
                content: `
                    <p>Suppliers can squeeze you if there aren't many of them, they offer unique products, or they could become your competitors.</p>
                    <div class="example-box">
                        <strong>High Supplier Power Factors:</strong>
                        <ul>
                            <li>Few suppliers relative to buyers</li>
                            <li>Unique or differentiated products</li>
                            <li>High switching costs for buyers</li>
                            <li>Suppliers can integrate forward (become competitors)</li>
                            <li>Suppliers are not dependent on your industry</li>
                            <li>No substitute inputs available</li>
                        </ul>
                        <strong>Low Supplier Power Factors:</strong>
                        <ul>
                            <li>Many suppliers available</li>
                            <li>Commoditized products</li>
                            <li>Low switching costs</li>
                            <li>Suppliers depend on your industry for revenue</li>
                            <li>Substitute inputs readily available</li>
                            <li>Buyers can integrate backward (become suppliers)</li>
                        </ul>
                        <strong>Best Practices:</strong>
                        <ul>
                            <li>Identify your key suppliers and their characteristics</li>
                            <li>Assess concentration in supplier markets</li>
                            <li>Consider your ability to switch suppliers</li>
                            <li>Evaluate supplier dependence on your business</li>
                        </ul>
                    </div>
                `
            },
            'rivalry': {
                title: 'Rivalry Among Existing Competitors',
                content: `
                    <p>Intense competition from existing players can lead to price wars, higher marketing costs, and shrinking profits.</p>
                    <div class="example-box">
                        <strong>High Rivalry Factors:</strong>
                        <ul>
                            <li>Slow industry growth</li>
                            <li>High fixed costs or high storage costs</li>
                            <li>Undifferentiated products or services</li>
                            <li>Many competitors of similar size</li>
                            <li>High exit barriers</li>
                            <li>Competitors with diverse strategies</li>
                        </ul>
                        <strong>Low Rivalry Factors:</strong>
                        <ul>
                            <li>Fast industry growth</li>
                            <li>Differentiated products</li>
                            <li>Few competitors or clear market leader</li>
                            <li>Low fixed costs</li>
                            <li>High customer switching costs</li>
                            <li>Similar competitors with similar strategies</li>
                        </ul>
                        <strong>Best Practices:</strong>
                        <ul>
                            <li>Identify your main competitors</li>
                            <li>Assess intensity of price competition</li>
                            <li>Consider non-price competition (quality, service, innovation)</li>
                            <li>Evaluate industry growth rate</li>
                            <li>Think about what drives competitive behavior</li>
                        </ul>
                    </div>
                `
            },
            'buyers': {
                title: 'Bargaining Power of Buyers',
                content: `
                    <p>Customers gain power when there aren't many of them, they buy in large amounts, or they can easily switch to other options.</p>
                    <div class="example-box">
                        <strong>High Buyer Power Factors:</strong>
                        <ul>
                            <li>Few buyers relative to sellers</li>
                            <li>Large volume purchases</li>
                            <li>Low switching costs</li>
                            <li>Buyers can integrate backward (become suppliers)</li>
                            <li>Price-sensitive buyers</li>
                            <li>Standardized or undifferentiated products</li>
                            <li>Buyers have full information</li>
                        </ul>
                        <strong>Low Buyer Power Factors:</strong>
                        <ul>
                            <li>Many buyers relative to sellers</li>
                            <li>Small individual purchases</li>
                            <li>High switching costs</li>
                            <li>Differentiated products</li>
                            <li>Buyers depend on your products</li>
                            <li>Limited buyer information</li>
                            <li>Buyers cannot integrate backward</li>
                        </ul>
                        <strong>Best Practices:</strong>
                        <ul>
                            <li>Identify your key customer segments</li>
                            <li>Assess customer concentration</li>
                            <li>Evaluate customer switching costs</li>
                            <li>Consider customer price sensitivity</li>
                            <li>Think about your product differentiation</li>
                        </ul>
                    </div>
                `
            },
            'substitutes': {
                title: 'Threat of Substitute Products or Services',
                content: `
                    <p>This force looks at the risk from alternatives that meet the same needs, even if they're from completely different industries.</p>
                    <div class="example-box">
                        <strong>High Substitute Threat Factors:</strong>
                        <ul>
                            <li>Close substitutes readily available</li>
                            <li>Substitutes offer better price-performance ratio</li>
                            <li>Low switching costs to substitutes</li>
                            <li>Substitutes improving in quality or price</li>
                            <li>Buyers view substitutes as equivalent</li>
                            <li>Substitute industries growing rapidly</li>
                        </ul>
                        <strong>Low Substitute Threat Factors:</strong>
                        <ul>
                            <li>No close substitutes available</li>
                            <li>High switching costs</li>
                            <li>Substitutes are inferior in quality or performance</li>
                            <li>Substitutes are more expensive</li>
                            <li>Strong brand loyalty reduces substitution</li>
                            <li>Unique product features not available in substitutes</li>
                        </ul>
                        <strong>Best Practices:</strong>
                        <ul>
                            <li>Think broadly about alternatives (not just direct competitors)</li>
                            <li>Consider substitutes from different industries</li>
                            <li>Assess price-performance of substitutes</li>
                            <li>Evaluate switching costs for customers</li>
                            <li>Monitor trends in substitute industries</li>
                            <li>Example: Streaming services substituting for cable TV</li>
                        </ul>
                    </div>
                `
            }
        };

        // Show contextual help
        function showContextualHelp(section) {
            const help = contextualHelpContent[section];
            if (!help) return;

            const modal = document.getElementById('contextualHelpModal');
            const content = document.getElementById('contextualHelpContent');
            
            if (modal && content) {
                content.innerHTML = `<h4>${help.title}</h4>${help.content}`;
                modal.classList.add('show');
            }
        }

        // Close contextual help
        function closeContextualHelp(event) {
            if (event && event.target !== event.currentTarget) return;
            const modal = document.getElementById('contextualHelpModal');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // Template Library Data
        const templates = [
            {
                name: 'E-commerce Industry',
                description: 'Online retail competitive analysis',
                data: {
                    'new-entrants': [
                        { id: '1', text: 'Low barriers: Easy to set up online store with platforms like Shopify' },
                        { id: '2', text: 'High threat: Minimal capital requirements compared to physical retail' },
                        { id: '3', text: 'Moderate: Brand building and customer acquisition are challenging' }
                    ],
                    'suppliers': [
                        { id: '1', text: 'Low power: Many manufacturers and wholesalers available globally' },
                        { id: '2', text: 'Moderate: Dropshipping reduces supplier dependency' },
                        { id: '3', text: 'High power: Exclusive brand suppliers can limit product access' }
                    ],
                    'rivalry': [
                        { id: '1', text: 'Very high: Intense price competition and frequent promotions' },
                        { id: '2', text: 'High: Many competitors with similar offerings' },
                        { id: '3', text: 'Moderate: Differentiation through customer service and brand' }
                    ],
                    'buyers': [
                        { id: '1', text: 'Very high: Easy price comparison and switching between sites' },
                        { id: '2', text: 'High: Low switching costs, many alternatives' },
                        { id: '3', text: 'Moderate: Loyalty programs can reduce switching' }
                    ],
                    'substitutes': [
                        { id: '1', text: 'High: Physical retail stores still preferred by many' },
                        { id: '2', text: 'Moderate: Social commerce and marketplaces offer alternatives' },
                        { id: '3', text: 'Low: Direct-to-consumer brands competing with marketplaces' }
                    ]
                }
            },
            {
                name: 'Software as a Service (SaaS)',
                description: 'Cloud software industry analysis',
                data: {
                    'new-entrants': [
                        { id: '1', text: 'Moderate: Technical expertise required but cloud infrastructure lowers barriers' },
                        { id: '2', text: 'High: Low capital requirements compared to on-premise software' },
                        { id: '3', text: 'Moderate: Network effects and customer switching costs create barriers' }
                    ],
                    'suppliers': [
                        { id: '1', text: 'Low: Cloud infrastructure providers (AWS, Azure) are commoditized' },
                        { id: '2', text: 'Low: Many third-party integrations available' },
                        { id: '3', text: 'Moderate: Talent (developers) can be a constraint' }
                    ],
                    'rivalry': [
                        { id: '1', text: 'High: Many competitors in most categories' },
                        { id: '2', text: 'Moderate: Differentiation through features and integrations' },
                        { id: '3', text: 'High: Price competition in mature categories' }
                    ],
                    'buyers': [
                        { id: '1', text: 'Moderate: High switching costs due to data migration' },
                        { id: '2', text: 'High: Enterprise buyers have significant negotiating power' },
                        { id: '3', text: 'Moderate: Switching costs protect vendors but buyers can negotiate' }
                    ],
                    'substitutes': [
                        { id: '1', text: 'Moderate: On-premise software still used by some enterprises' },
                        { id: '2', text: 'Low: Open-source alternatives in some categories' },
                        { id: '3', text: 'Moderate: Custom development as alternative' }
                    ]
                }
            },
            {
                name: 'Restaurant Industry',
                description: 'Food service competitive analysis',
                data: {
                    'new-entrants': [
                        { id: '1', text: 'Moderate: Relatively low barriers but requires capital for location and equipment' },
                        { id: '2', text: 'High: Many new restaurants fail, but easy to start' },
                        { id: '3', text: 'Moderate: Brand and location are critical success factors' }
                    ],
                    'suppliers': [
                        { id: '1', text: 'Low: Many food suppliers and distributors available' },
                        { id: '2', text: 'Moderate: Large chains have more negotiating power' },
                        { id: '3', text: 'Low: Commoditized ingredients generally available' }
                    ],
                    'rivalry': [
                        { id: '1', text: 'Very high: Intense competition, many competitors' },
                        { id: '2', text: 'High: Price competition and promotional activity' },
                        { id: '3', text: 'High: Differentiation through cuisine, atmosphere, and service' }
                    ],
                    'buyers': [
                        { id: '1', text: 'Very high: Many restaurant options, easy to switch' },
                        { id: '2', text: 'High: Price-sensitive customers' },
                        { id: '3', text: 'Moderate: Loyalty programs can create switching costs' }
                    ],
                    'substitutes': [
                        { id: '1', text: 'High: Home cooking, meal kits, and grocery stores' },
                        { id: '2', text: 'High: Food delivery services and fast-casual options' },
                        { id: '3', text: 'Moderate: Corporate cafeterias and catering' }
                    ]
                }
            },
            {
                name: 'Healthcare Services',
                description: 'Medical services industry analysis',
                data: {
                    'new-entrants': [
                        { id: '1', text: 'Low: High regulatory barriers (licensing, certifications)' },
                        { id: '2', text: 'Low: Significant capital requirements for facilities and equipment' },
                        { id: '3', text: 'Low: Insurance network requirements create barriers' }
                    ],
                    'suppliers': [
                        { id: '1', text: 'Moderate: Medical equipment suppliers have some power' },
                        { id: '2', text: 'High: Pharmaceutical companies with patented drugs' },
                        { id: '3', text: 'Moderate: Limited suppliers for specialized equipment' }
                    ],
                    'rivalry': [
                        { id: '1', text: 'Moderate: Competition but not primarily on price' },
                        { id: '2', text: 'Moderate: Differentiation through specialization and quality' },
                        { id: '3', text: 'Low: Insurance networks limit direct competition' }
                    ],
                    'buyers': [
                        { id: '1', text: 'Low: Insurance companies are primary payers, not patients' },
                        { id: '2', text: 'Moderate: Patients have limited choice in emergency situations' },
                        { id: '3', text: 'Low: High switching costs (relationships, medical records)' }
                    ],
                    'substitutes': [
                        { id: '1', text: 'Low: Limited alternatives to professional medical care' },
                        { id: '2', text: 'Moderate: Telemedicine and retail clinics for minor issues' },
                        { id: '3', text: 'Low: Preventive care and wellness programs' }
                    ]
                }
            },
            {
                name: 'Automotive Manufacturing',
                description: 'Car manufacturing industry analysis',
                data: {
                    'new-entrants': [
                        { id: '1', text: 'Very low: Extremely high capital requirements (billions for factories)' },
                        { id: '2', text: 'Low: Significant economies of scale required' },
                        { id: '3', text: 'Low: Regulatory compliance and safety standards' }
                    ],
                    'suppliers': [
                        { id: '1', text: 'Moderate: Many component suppliers but some specialized parts' },
                        { id: '2', text: 'Moderate: Large automakers have negotiating power' },
                        { id: '3', text: 'High: Specialized technology suppliers (batteries, chips) have power' }
                    ],
                    'rivalry': [
                        { id: '1', text: 'High: Intense competition among established players' },
                        { id: '2', text: 'Moderate: Differentiation through brand, features, and quality' },
                        { id: '3', text: 'High: Slow industry growth increases competition' }
                    ],
                    'buyers': [
                        { id: '1', text: 'Moderate: Individual buyers have limited power' },
                        { id: '2', text: 'High: Fleet buyers and rental companies have significant power' },
                        { id: '3', text: 'Moderate: High switching costs (trade-ins, financing)' }
                    ],
                    'substitutes': [
                        { id: '1', text: 'Moderate: Public transportation, ride-sharing, and bikes' },
                        { id: '2', text: 'Moderate: Electric vehicles substituting for gas vehicles' },
                        { id: '3', text: 'Low: Personal vehicle ownership still preferred by most' }
                    ]
                }
            }
        ];

        // Show template library
        function showTemplateLibrary() {
            const modal = document.getElementById('templateLibrary');
            const list = document.getElementById('templateList');
            
            if (!modal || !list) return;

            list.innerHTML = '';
            templates.forEach((template, index) => {
                const item = document.createElement('div');
                item.className = 'template-item';
                item.innerHTML = `
                    <h5>${template.name}</h5>
                    <p>${template.description}</p>
                `;
                item.onclick = () => loadTemplate(index);
                list.appendChild(item);
            });

            modal.classList.add('show');
        }

        // Close template library
        function closeTemplateLibrary(event) {
            if (event && event.target !== event.currentTarget) return;
            const modal = document.getElementById('templateLibrary');
            if (modal) {
                modal.classList.remove('show');
            }
        }

        // Load template
        function loadTemplate(index) {
            const template = templates[index];
            if (!template) return;

            if (confirm(`Load "${template.name}" template? This will replace your current data.`)) {
                // Save current user data before loading template
                saveData(); // Ensure current data is saved
                userDataBackup = JSON.parse(JSON.stringify(forcesData)); // Deep copy current data
                
                forcesData = JSON.parse(JSON.stringify(template.data));
                renderAllCards();
                saveData();
                closeTemplateLibrary();
                
                // Show "Your Data" button and hide "Load Template" button
                showYourDataButton();
            }
        }

        // Show "Your Data" button after loading template
        function showYourDataButton() {
            const templateBtn = document.querySelector('button[onclick="showTemplateLibrary()"]');
            const yourDataBtnContainer = document.getElementById('yourDataButtonContainer');
            
            if (templateBtn) {
                templateBtn.style.display = 'none';
            }
            
            if (!yourDataBtnContainer) {
                // Create the "Your data" button container if it doesn't exist
                const buttonDiv = document.querySelector('div[style*="text-align: center"]');
                if (buttonDiv) {
                    const yourDataDiv = document.createElement('div');
                    yourDataDiv.id = 'yourDataButtonContainer';
                    yourDataDiv.style.cssText = 'text-align: center; margin-top: 15px;';
                    yourDataDiv.innerHTML = '<button onclick="restoreUserData()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;">Your Data</button>';
                    buttonDiv.appendChild(yourDataDiv);
                }
            } else {
                yourDataBtnContainer.style.display = 'block';
            }
        }

        // Restore user's original data
        function restoreUserData() {
            if (!userDataBackup) {
                // No backup means user hasn't entered anything, so clear the form
                forcesData = {
                    'new-entrants': [],
                    'suppliers': [],
                    'rivalry': [],
                    'buyers': [],
                    'substitutes': []
                };
            } else {
                // Restore the user's data
                forcesData = JSON.parse(JSON.stringify(userDataBackup)); // Deep copy backup
                userDataBackup = null; // Clear backup
            }
            
            renderAllCards();
            
            // Hide "Your data" button and show "Load Template" button
            const templateBtn = document.querySelector('button[onclick="showTemplateLibrary()"]');
            const yourDataBtnContainer = document.getElementById('yourDataButtonContainer');
            
            if (templateBtn) {
                templateBtn.style.display = 'inline-block';
            }
            
            if (yourDataBtnContainer) {
                yourDataBtnContainer.style.display = 'none';
            }
            
            // Save restored/cleared data
            saveData();
        }

        // ========== PHASE 2: Enhanced Learning Features ==========

        // Examples Mode
        let examplesModeActive = false;
        const exampleForcesData = {
            'new-entrants': [
                { id: 'ex1', text: 'Low barriers: Easy to set up online store with platforms like Shopify' },
                { id: 'ex2', text: 'High threat: Minimal capital requirements compared to physical retail' }
            ],
            'suppliers': [
                { id: 'ex1', text: 'Low power: Many manufacturers and wholesalers available globally' },
                { id: 'ex2', text: 'Moderate: Dropshipping reduces supplier dependency' }
            ],
            'rivalry': [
                { id: 'ex1', text: 'Very high: Intense price competition and frequent promotions' },
                { id: 'ex2', text: 'High: Many competitors with similar offerings' }
            ],
            'buyers': [
                { id: 'ex1', text: 'Very high: Easy price comparison and switching between sites' },
                { id: 'ex2', text: 'High: Low switching costs, many alternatives' }
            ],
            'substitutes': [
                { id: 'ex1', text: 'High: Physical retail stores still preferred by many' },
                { id: 'ex2', text: 'Moderate: Social commerce and marketplaces offer alternatives' }
            ]
        };

        function toggleExamplesMode() {
            examplesModeActive = !examplesModeActive;
            const overlay = document.getElementById('examplesModeOverlay');
            const btn = document.getElementById('examplesModeBtn');
            
            if (examplesModeActive) {
                overlay.classList.add('show');
                btn.textContent = '‚úñÔ∏è Hide Examples';
                renderExamplesMode();
            } else {
                overlay.classList.remove('show');
                btn.textContent = 'üëÅÔ∏è View Examples';
            }
        }

        function renderExamplesMode() {
            const content = document.getElementById('examplesModeContent');
            let html = '';
            
            const sections = [
                { key: 'new-entrants', name: 'Threat of New Entrants' },
                { key: 'suppliers', name: 'Bargaining Power of Suppliers' },
                { key: 'rivalry', name: 'Rivalry Among Existing Competitors' },
                { key: 'buyers', name: 'Bargaining Power of Buyers' },
                { key: 'substitutes', name: 'Threat of Substitute Products' }
            ];
            
            sections.forEach(section => {
                html += `<div class="example-section">
                    <h4>${section.name}</h4>`;
                
                exampleForcesData[section.key].forEach(card => {
                    html += `<div class="example-card">${card.text}</div>`;
                });
                
                html += `</div>`;
            });
            
            content.innerHTML = html;
        }

        // Learn Menu
        function showLearnMenu() {
            document.getElementById('learnMenu').classList.add('show');
        }

        function closeLearnMenu(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('learnMenu').classList.remove('show');
            hideLearnContent();
        }

        // Video Links for Educational Content (HBR prioritized, with basic options)
        const videoLinks = {
            'porters-overview': {
                url: 'https://www.youtube.com/watch?v=mYF2_FBCvXw&t=186s',
                description: 'Harvard Business Review: Strategic insights on understanding competitive forces and industry dynamics through Porter\'s Five Forces framework.',
                hbrCreator: 'Harvard Business Review',
                basicUrl: 'https://www.youtube.com/watch?v=XCWHSeDU-zk',
                basicDescription: 'Basic Tutorial: Simple explanation of Porter\'s Five Forces model for beginners - understand how to analyze industry competition.',
                basicCreator: 'Two Teachers'
            },
            'porters-forces': {
                url: 'https://www.youtube.com/watch?v=mYF2_FBCvXw&t=186s',
                description: 'Harvard Business Review: Strategic insights on understanding competitive forces and industry dynamics.',
                hbrCreator: 'Harvard Business Review',
                basicUrl: 'https://www.youtube.com/watch?v=XCWHSeDU-zk',
                basicDescription: 'Basic Tutorial: Learn how to analyze each of the five forces in detail - a beginner-friendly guide.',
                basicCreator: 'Two Teachers'
            }
        };

        // Helper function to render video link (HBR prioritized, with basic option)
        function renderVideoLink(contentKey) {
            const video = videoLinks[contentKey];
            if (!video) return '';
            
            const creator = (video.hbrCreator || video.creator || '').toString();
            const isHbr = creator.toLowerCase().includes('harvard business review');
            const headerLabel = isHbr ? 'üéì Harvard Business Review (Recommended):' : 'üéì Recommended Video:';
            const buttonLabel = isHbr ? 'Watch HBR Video' : 'Watch Video';
            const creditLabel = creator || (isHbr ? 'Harvard Business Review' : 'YouTube Creator');
            const desc = isHbr ? (video.description || '') : String(video.description || '').replace(/^Harvard Business Review:\s*/i, '');
            
            let html = `
                <div class="video-link-section" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--primary-color);">
                    <h4 style="color: var(--primary-color); margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                        <span>üìπ</span> Video Tutorials
                    </h4>
                    <div style="margin-bottom: 15px;">
                        <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">${headerLabel}</p>
                        <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">${desc}</p>
                        <a href="${video.url}" target="_blank" rel="noopener noreferrer" 
                           class="video-link-btn" 
                           style="display: inline-flex; align-items: center; gap: 8px; background: #FF0000; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(255, 0, 0, 0.3); margin-bottom: 10px;">
                            <span>‚ñ∂Ô∏è</span> ${buttonLabel}
                        </a>
                        <div style="margin-top: 8px; font-size: 0.8em; color: var(--text-tertiary); font-style: italic;">
                            <p style="margin: 0;"><strong>Video Credit:</strong> ${creditLabel}</p>
                        </div>
                    </div>`;
            
            // Add basic video if available
            if (video.basicUrl) {
                html += `
                    <div style="padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1);">
                        <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">üìö Basic Tutorial (For Beginners):</p>
                        <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">${video.basicDescription}</p>
                        <a href="${video.basicUrl}" target="_blank" rel="noopener noreferrer" 
                           class="video-link-btn" 
                           style="display: inline-flex; align-items: center; gap: 8px; background: #6B7280; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3); margin-bottom: 10px;">
                            <span>‚ñ∂Ô∏è</span> Watch Basic Tutorial
                        </a>
                        <div style="margin-top: 8px; font-size: 0.8em; color: var(--text-tertiary); font-style: italic;">
                            <p style="margin: 0;"><strong>Video Credit:</strong> ${video.basicCreator || 'YouTube Creator'}</p>
                        </div>
                    </div>`;
            }
            
            html += `
                    <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1); font-size: 0.75em; color: var(--text-tertiary); font-style: italic;">
                        <p style="margin: 0;">This is an external link to a YouTube video. We do not own this content; it is linked for educational purposes only. Content is subject to YouTube's terms and may change or be removed by the original creator.</p>
                    </div>
                </div>`;
            return html;
        }

        const learnContent = {
            'porters-overview': {
                title: 'What is Porter\'s Five Forces?',
                text: `<p>Porter's Five Forces is a strategic framework developed by Michael E. Porter in 1979 to analyze the competitive intensity and attractiveness of an industry or market. It helps businesses understand the structural factors that influence profitability and guide decisions on entry, expansion, or competitive positioning.</p>
                <p><strong>The Five Forces:</strong></p>
                <ol>
                    <li><strong>Threat of New Entrants:</strong> How easy is it for new competitors to enter?</li>
                    <li><strong>Bargaining Power of Suppliers:</strong> How much power do suppliers have?</li>
                    <li><strong>Rivalry Among Existing Competitors:</strong> How intense is competition?</li>
                    <li><strong>Bargaining Power of Buyers:</strong> How much power do customers have?</li>
                    <li><strong>Threat of Substitute Products:</strong> What alternatives exist?</li>
                </ol>
                <p>This model is widely used in business strategy, but its effectiveness depends on applying it dynamically, as industry conditions evolve over time.</p>`
            },
            'porters-forces': {
                title: 'Understanding Each Force',
                text: `<p><strong>1. Threat of New Entrants:</strong> Assess barriers like capital requirements, economies of scale, brand loyalty, or regulatory hurdles. Low barriers mean high threat and lower profitability potential.</p>
                <p><strong>2. Bargaining Power of Suppliers:</strong> Suppliers can exert pressure if they are few in number, offer unique products, or can integrate forward. Strong supplier power squeezes industry profits.</p>
                <p><strong>3. Rivalry Among Existing Competitors:</strong> Intense competition‚Äîdriven by slow growth, high fixed costs, or undifferentiated products‚Äîleads to price wars and eroded profits.</p>
                <p><strong>4. Bargaining Power of Buyers:</strong> Customers gain leverage when concentrated, purchase in large volumes, or can easily switch. High buyer power forces lower prices or improved quality.</p>
                <p><strong>5. Threat of Substitute Products:</strong> Evaluate risk from alternatives that fulfill similar needs, even from different industries. Close substitutes limit pricing power.</p>`
            },
            'porters-best-practices': {
                title: 'Best Practices for Porter\'s Five Forces Analysis',
                text: `<ul>
                    <li><strong>Be Specific:</strong> Identify concrete factors rather than vague statements. Instead of "high competition," write "15 major competitors with similar products and frequent price wars."</li>
                    <li><strong>Consider All Forces:</strong> Don't focus only on rivalry. All five forces affect profitability.</li>
                    <li><strong>Think Dynamically:</strong> Industry conditions change. Consider how forces might evolve over time.</li>
                    <li><strong>Use Industry Context:</strong> What's true for one industry may not apply to another. Tailor your analysis.</li>
                    <li><strong>Identify Opportunities:</strong> Look for forces that are weak or can be influenced to your advantage.</li>
                    <li><strong>Quantify When Possible:</strong> Use numbers, percentages, or specific examples to support your analysis.</li>
                    <li><strong>Consider Interconnections:</strong> Forces interact with each other. A change in one can affect others.</li>
                </ul>`
            },
            'porters-common-mistakes': {
                title: 'Common Mistakes to Avoid',
                text: `<ul>
                    <li><strong>Focusing Only on Rivalry:</strong> All five forces matter. Don't ignore suppliers, buyers, or substitutes.</li>
                    <li><strong>Static Analysis:</strong> Industries evolve. Consider how forces might change.</li>
                    <li><strong>Too Vague:</strong> "High competition" is less useful than "15 competitors with 2% market share each, frequent price promotions."</li>
                    <li><strong>Ignoring Substitutes:</strong> Substitutes can come from different industries. Think broadly.</li>
                    <li><strong>Overlooking Buyer Power:</strong> Even in B2B, buyer concentration and switching costs matter.</li>
                    <li><strong>Not Considering Regional Differences:</strong> Forces can vary by geography or market segment.</li>
                    <li><strong>One-Time Analysis:</strong> Revisit your analysis regularly as conditions change.</li>
                </ul>`
            },
            'canvas-overview': {
                title: 'What is Strategic Canvas?',
                text: `<p>The Strategic Canvas is a visual framework that helps you organize and structure your strategic thinking. It breaks down complex strategy into seven key components:</p>
                <ol>
                    <li><strong>Challenges:</strong> Problems or obstacles you need to address</li>
                    <li><strong>Aspirations:</strong> Your ideal desired outcomes</li>
                    <li><strong>Focus Area:</strong> The scope and boundaries of your strategy</li>
                    <li><strong>Guiding Principles:</strong> Core values and approaches to overcome challenges</li>
                    <li><strong>Activities:</strong> Specific actions that solve problems</li>
                    <li><strong>Outcomes:</strong> Measurable metrics for success</li>
                    <li><strong>Next Steps:</strong> Action plans and progress tracking</li>
                </ol>
                <p>By organizing your strategy this way, you create a clear roadmap from problems to solutions to measurable results.</p>`
            },
            'canvas-sections': {
                title: 'How to Use Each Section',
                text: `<p><strong>Start with Challenges:</strong> Identify 3-5 key problems or obstacles. Be specific and include context.</p>
                <p><strong>Define Aspirations:</strong> Create 2-4 ideal outcomes that directly address your challenges. Make them measurable when possible.</p>
                <p><strong>Set Focus Area:</strong> Clearly define the scope of your strategy. What's included? What's out of scope?</p>
                <p><strong>Establish Guiding Principles:</strong> List 3-5 core values or approaches that will guide your decision-making.</p>
                <p><strong>List Activities:</strong> Identify specific actions that will solve your challenges. Connect them to your guiding principles.</p>
                <p><strong>Define Outcomes:</strong> Set measurable metrics for each activity. How will you know you've succeeded?</p>
                <p><strong>Plan Next Steps:</strong> Create concrete action items with deadlines and responsibilities.</p>`
            },
            'canvas-best-practices': {
                title: 'Best Practices',
                text: `<ul>
                    <li><strong>Be Specific:</strong> Avoid vague statements. Instead of "low sales," write "Q3 sales down 15% due to increased competition."</li>
                    <li><strong>Connect Elements:</strong> Ensure your aspirations address your challenges, and your activities align with your principles.</li>
                    <li><strong>Make Outcomes Measurable:</strong> Use numbers, percentages, or clear success criteria.</li>
                    <li><strong>Keep It Focused:</strong> Don't try to solve everything at once. Focus on 3-5 key challenges.</li>
                    <li><strong>Review Regularly:</strong> Update your canvas quarterly or when circumstances change.</li>
                    <li><strong>Get Input:</strong> Share your canvas with team members for feedback and alignment.</li>
                </ul>`
            },
            'canvas-common-mistakes': {
                title: 'Common Mistakes to Avoid',
                text: `<ul>
                    <li><strong>Too Vague:</strong> "Improve customer service" ‚Üí Better: "Reduce customer complaint resolution time from 5 days to 24 hours"</li>
                    <li><strong>Disconnected Elements:</strong> Activities that don't relate to challenges or principles</li>
                    <li><strong>Too Many Items:</strong> Trying to address 10+ challenges at once dilutes focus</li>
                    <li><strong>No Metrics:</strong> Outcomes without measurable criteria</li>
                    <li><strong>Missing Context:</strong> Challenges without explaining why they matter</li>
                    <li><strong>Static Canvas:</strong> Not updating as circumstances change</li>
                </ul>`
            },
            'action-goals': {
                title: 'Creating Effective Goals',
                text: `<p>Effective goals are:</p>
                <ul>
                    <li><strong>Specific:</strong> Clear and unambiguous</li>
                    <li><strong>Measurable:</strong> Include metrics or success criteria</li>
                    <li><strong>Achievable:</strong> Realistic given your resources</li>
                    <li><strong>Relevant:</strong> Aligned with your strategic priorities</li>
                    <li><strong>Time-bound:</strong> Include deadlines or timelines</li>
                </ul>
                <p><strong>Example:</strong> "Increase customer retention rate from 75% to 90% within 12 months by implementing a loyalty program and improving customer service response times."</p>`
            },
            'action-steps': {
                title: 'Defining Action Steps',
                text: `<p>Each action step should include:</p>
                <ul>
                    <li><strong>Responsible Person:</strong> Who will lead this step?</li>
                    <li><strong>Resources Needed:</strong> Budget, tools, team members, etc.</li>
                    <li><strong>Progress Benchmarks:</strong> Milestones to track progress</li>
                    <li><strong>Completion Date:</strong> When should this be finished?</li>
                    <li><strong>Evidence of Success:</strong> How will you know it's complete?</li>
                </ul>
                <p>Break large goals into 4-8 manageable action steps. Each step should be completable within 1-3 months.</p>`
            },
            'action-responsibilities': {
                title: 'Assigning Responsibilities',
                text: `<p>When assigning responsibilities:</p>
                <ul>
                    <li>Choose someone with the right skills and authority</li>
                    <li>Ensure they have capacity to complete the task</li>
                    <li>Provide clear expectations and deadlines</li>
                    <li>Set up regular check-ins for progress updates</li>
                    <li>Ensure accountability but offer support</li>
                </ul>
                <p><strong>Tip:</strong> One person should be primarily responsible, but they can delegate parts of the work.</p>`
            },
            'action-tracking': {
                title: 'Tracking Progress',
                text: `<p>Effective progress tracking includes:</p>
                <ul>
                    <li><strong>Regular Updates:</strong> Weekly or bi-weekly status checks</li>
                    <li><strong>Milestone Reviews:</strong> Celebrate progress at key points</li>
                    <li><strong>Issue Identification:</strong> Quickly identify and address blockers</li>
                    <li><strong>Adjustment:</strong> Be willing to adjust timelines or approaches</li>
                    <li><strong>Documentation:</strong> Keep records of what's working and what's not</li>
                </ul>
                <p>Use your progress column to note current status, and update completion dates as needed.</p>`
            },
            'fundamentals': {
                title: 'Strategic Planning Fundamentals',
                text: `<p>Strategic planning is the process of defining your organization's direction and making decisions on allocating resources to pursue this direction.</p>
                <p><strong>Key Principles:</strong></p>
                <ul>
                    <li>Start with a clear understanding of your current situation</li>
                    <li>Define where you want to go (vision/aspirations)</li>
                    <li>Identify the gap between current and desired state</li>
                    <li>Develop a plan to bridge that gap</li>
                    <li>Execute, monitor, and adjust as needed</li>
                </ul>
                <p>Effective strategic planning is iterative, not a one-time event. Regular review and adjustment are essential.</p>`
            },
            'frameworks': {
                title: 'Common Strategic Planning Frameworks',
                text: `<p><strong>SWOT Analysis:</strong> Strengths, Weaknesses, Opportunities, Threats - helps assess internal and external factors</p>
                <p><strong>Porter's Five Forces:</strong> Analyzes competitive intensity and industry attractiveness through five forces</p>
                <p><strong>OKRs (Objectives and Key Results):</strong> Set ambitious objectives with measurable key results</p>
                <p><strong>Balanced Scorecard:</strong> Measures performance across financial, customer, internal processes, and learning perspectives</p>
                <p><strong>Strategy Maps:</strong> Visual representation of how value is created through strategic objectives</p>
                <p><strong>Hoshin Kanri:</strong> Policy deployment method that aligns strategic goals throughout the organization</p>
                <p>These frameworks can be used together to create a comprehensive strategic planning approach.</p>`
            },
            'expert-tips': {
                title: 'Expert Tips',
                text: `<ul>
                    <li><strong>Start Small:</strong> Don't try to plan everything at once. Focus on 3-5 key priorities.</li>
                    <li><strong>Involve Your Team:</strong> Get input from people who will execute the plan.</li>
                    <li><strong>Be Realistic:</strong> Set ambitious but achievable goals. Unrealistic plans demotivate teams.</li>
                    <li><strong>Review Regularly:</strong> Quarterly reviews keep your strategy relevant and actionable.</li>
                    <li><strong>Celebrate Wins:</strong> Acknowledge progress to maintain momentum.</li>
                    <li><strong>Learn from Failures:</strong> When things don't go as planned, analyze why and adjust.</li>
                    <li><strong>Keep It Simple:</strong> Complex plans are hard to execute. Clarity beats complexity.</li>
                    <li><strong>Communicate:</strong> Share your strategy with stakeholders to ensure alignment.</li>
                </ul>`
            }
        };

        function showLearnContent(topic) {
            const content = learnContent[topic];
            if (!content) return;
            
            const display = document.getElementById('learnContentDisplay');
            const text = document.getElementById('learnContentText');
            
            let htmlContent = `<h3>${content.title}</h3>${content.text}`;
            // Add video link if available
            htmlContent += renderVideoLink(topic);
            text.innerHTML = htmlContent;
            display.style.display = 'block';
            display.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function hideLearnContent() {
            document.getElementById('learnContentDisplay').style.display = 'none';
        }

        // Real-time Validation
        function validateCard(section, cardId, text) {
            const issues = [];
            
            if (text.length < 10) {
                issues.push({
                    type: 'too-short',
                    message: 'Consider being more specific. Good entries are detailed and actionable.',
                    severity: 'suggestion'
                });
            }
            
            if (text.length > 0 && !text.match(/\d+/) && !text.toLowerCase().includes('high') && !text.toLowerCase().includes('low') && !text.toLowerCase().includes('moderate')) {
                issues.push({
                    type: 'missing-intensity',
                    message: 'Consider indicating the intensity level (high, moderate, low) of this force.',
                    severity: 'tip'
                });
            }
            
            return issues;
        }

        function updateCardValidation(section, cardId) {
            const cardElement = document.querySelector(`[data-card-id="${cardId}"]`);
            if (!cardElement) return;
            
            const card = forcesData[section].find(c => c.id === cardId);
            if (!card) return;
            
            const issues = validateCard(section, cardId, card.text);
            let indicator = cardElement.querySelector('.validation-indicator');
            
            if (issues.length > 0 && card.text.length > 0) {
                if (!indicator) {
                    indicator = document.createElement('div');
                    indicator.className = 'validation-indicator';
                    cardElement.appendChild(indicator);
                }
                
                const hasWarning = issues.some(i => i.severity === 'suggestion');
                indicator.className = `validation-indicator ${hasWarning ? 'warning' : 'suggestion'}`;
                indicator.textContent = hasWarning ? '‚ö†' : 'üí°';
                indicator.title = issues.map(i => i.message).join('\n');
            } else if (indicator && card.text.length > 0) {
                indicator.className = 'validation-indicator valid';
                indicator.textContent = '‚úì';
                indicator.title = 'Looks good!';
            } else if (indicator && card.text.length === 0) {
                indicator.remove();
            }
        }

        // Initialize on page load
        // Don't load saved data on initial load - start with blank form
        renderAllCards(); // Render empty forces grid

        // Auto-save on any input change
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('card-input')) {
                const cardElement = e.target.closest('[data-card-id]');
                if (cardElement) {
                    const cardId = cardElement.getAttribute('data-card-id');
                    const section = cardElement.closest('[data-section]')?.getAttribute('data-section');
                    if (section && cardId) {
                        updateCardText(section, cardId, e.target.value);
                        saveData(); // Auto-save on input
                        // Trigger validation
                        setTimeout(() => updateCardValidation(section, cardId), 300);
                    }
                }
            }
        });
        
        // Load user data on page load
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadSavedData);
        } else {
            loadSavedData();
        }

        // Export functionality
        function showExportOptions() {
            const dropdown = document.getElementById('exportDropdown');
            if (dropdown) {
                dropdown.classList.toggle('show');
            }
        }

        // Close export dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('exportDropdown');
            const exportBtn = event.target.closest('.btn-export');
            if (dropdown && !dropdown.contains(event.target) && !exportBtn) {
                dropdown.classList.remove('show');
            }
        });

        // Check if device is mobile
        function isMobileDevice() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // Check if Web Share API is available
        function isWebShareAvailable() {
            return navigator.share && navigator.canShare;
        }

        // Export Porter's Five Forces with mobile support
        function exportPortersFiveForces(format) {
            saveData();
            
            // Close dropdown
            const dropdown = document.getElementById('exportDropdown');
            if (dropdown) {
                dropdown.classList.remove('show');
            }
            
            const filename = 'Porters_Five_Forces_' + new Date().toISOString().split('T')[0];
            let blob, mimeType, extension, content;
            
            if (format === 'docx') {
                content = generatePortersWordDocument();
                blob = new Blob([content], { type: 'application/msword' });
                mimeType = 'application/msword';
                extension = '.doc';
            } else if (format === 'xlsx') {
                content = generatePortersExcelDocument();
                blob = new Blob([content], { type: 'application/vnd.ms-excel' });
                mimeType = 'application/vnd.ms-excel';
                extension = '.xls';
            } else {
                content = generatePortersTextDocument();
                blob = new Blob([content], { type: 'text/plain' });
                mimeType = 'text/plain';
                extension = '.txt';
            }
            
            const fullFilename = filename + extension;
            
            // For text files on mobile, always show options (better for iPhone)
            if (isMobileDevice() && format === 'txt') {
                shareFileMobileFallback(blob, fullFilename, mimeType, content);
            } else if (isMobileDevice() && isWebShareAvailable()) {
                shareFileMobile(blob, fullFilename, mimeType);
            } else if (isMobileDevice()) {
                shareFileMobileFallback(blob, fullFilename, mimeType, content);
            } else {
                downloadFile(blob, fullFilename);
            }
        }

        // Generate text document
        function generatePortersTextDocument() {
            const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            let text = "PORTER'S FIVE FORCES ANALYSIS\n";
            text += 'Generated: ' + date + '\n';
            text += '='.repeat(50) + '\n\n';
            
            const sectionNames = {
                'new-entrants': '1. THREAT OF NEW ENTRANTS',
                'suppliers': '2. BARGAINING POWER OF SUPPLIERS',
                'rivalry': '3. RIVALRY AMONG EXISTING COMPETITORS',
                'buyers': '4. BARGAINING POWER OF BUYERS',
                'substitutes': '5. THREAT OF SUBSTITUTE PRODUCTS OR SERVICES'
            };
            
            Object.keys(forcesData).forEach(section => {
                const cards = forcesData[section];
                if (cards && cards.length > 0 && cards.some(c => c.text && c.text.trim())) {
                    text += sectionNames[section] || section.toUpperCase() + '\n';
                    text += '-'.repeat(50) + '\n';
                    cards.forEach((card, index) => {
                        if (card.text && card.text.trim()) {
                            text += (index + 1) + '. ' + card.text.trim() + '\n';
                        }
                    });
                    text += '\n';
                }
            });
            
            return text;
        }

        // Generate Word document
        function generatePortersWordDocument() {
            const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            let html = '<!DOCTYPE html>\n';
            html += '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">\n';
            html += '<head>\n<meta charset="utf-8">\n';
            html += '<meta name="ProgId" content="Word.Document">\n';
            html += '<meta name="Generator" content="Microsoft Word">\n';
            html += '<meta name="Originator" content="Microsoft Word">\n';
            html += '<title>Porter\'s Five Forces Analysis</title>\n';
            html += '<!--[if gte mso 9]><xml>\n';
            html += '<w:WordDocument>\n';
            html += '<w:View>Print</w:View>\n';
            html += '<w:Zoom>100</w:Zoom>\n';
            html += '<w:DoNotOptimizeForBrowser/>\n';
            html += '</w:WordDocument>\n';
            html += '</xml><![endif]-->\n';
            html += '<style>\n';
            html += '@page { size: 8.5in 11in; margin: 1in; }\n';
            html += 'body { font-family: "Calibri", "Arial", sans-serif; font-size: 11pt; margin: 0; padding: 0; line-height: 1.6; color: #333; }\n';
            html += 'h1 { color: #0f4c75; font-size: 24pt; font-weight: bold; margin-top: 24pt; margin-bottom: 12pt; page-break-after: avoid; }\n';
            html += 'h2 { color: #0f4c75; font-size: 18pt; font-weight: bold; margin-top: 18pt; margin-bottom: 12pt; border-bottom: 2px solid #0f4c75; padding-bottom: 6pt; page-break-after: avoid; }\n';
            html += '.meta { color: #666; font-size: 10pt; margin-bottom: 30px; }\n';
            html += 'ul { margin-left: 20px; margin-bottom: 20px; page-break-inside: avoid; }\n';
            html += 'li { margin-bottom: 8px; line-height: 1.6; }\n';
            html += '.section { page-break-inside: avoid; margin-bottom: 24pt; }\n';
            html += '.page-break { page-break-before: always; }\n';
            html += '.no-break { page-break-inside: avoid; }\n';
            html += '@media print { .section { page-break-inside: avoid; } }\n';
            html += '</style>\n</head>\n<body>\n';
            
            html += '<h1>PORTER\'S FIVE FORCES ANALYSIS</h1>\n';
            html += '<div class="meta">Generated: ' + date + '</div>\n';
            
            const sectionNames = {
                'new-entrants': '1. Threat of New Entrants',
                'suppliers': '2. Bargaining Power of Suppliers',
                'rivalry': '3. Rivalry Among Existing Competitors',
                'buyers': '4. Bargaining Power of Buyers',
                'substitutes': '5. Threat of Substitute Products or Services'
            };
            
            Object.keys(forcesData).forEach(section => {
                const cards = forcesData[section];
                if (cards && cards.length > 0 && cards.some(c => c.text && c.text.trim())) {
                    html += '<h2>' + (sectionNames[section] || section) + '</h2>\n';
                    html += '<ul>\n';
                    cards.forEach(card => {
                        if (card.text && card.text.trim()) {
                            html += '<li>' + escapeHtml(card.text.trim()) + '</li>\n';
                        }
                    });
                    html += '</ul>\n';
                }
            });
            
            html += '</body>\n</html>\n';
            return html;
        }

        // Generate Excel document
        function generatePortersExcelDocument() {
            const date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            let html = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">\n';
            html += '<head>\n<meta charset="utf-8">\n';
            html += '<!--[if gte mso 9]><xml>\n';
            html += '<x:ExcelWorkbook>\n';
            html += '<x:ExcelWorksheets>\n';
            html += '<x:ExcelWorksheet>\n';
            html += '<x:Name>Porter\'s Five Forces</x:Name>\n';
            html += '<x:WorksheetOptions>\n';
            html += '<x:PrintGridlines/>\n';
            html += '<x:FitToPage/>\n';
            html += '<x:FitWidth>1</x:FitWidth>\n';
            html += '<x:FitHeight>1</x:FitHeight>\n';
            html += '<x:PageSetup>\n';
            html += '<x:Header x:Margin="0.3"/>\n';
            html += '<x:Footer x:Margin="0.3"/>\n';
            html += '<x:PageMargins x:Bottom="0.75" x:Left="0.7" x:Right="0.7" x:Top="0.75"/>\n';
            html += '</x:PageSetup>\n';
            html += '<x:FreezePanes/>\n';
            html += '<x:FrozenNoSplit/>\n';
            html += '<x:SplitHorizontal>2</x:SplitHorizontal>\n';
            html += '<x:TopRowBottomPane>2</x:TopRowBottomPane>\n';
            html += '<x:ActivePane>2</x:ActivePane>\n';
            html += '</x:WorksheetOptions>\n';
            html += '</x:ExcelWorksheet>\n';
            html += '</x:ExcelWorksheets>\n';
            html += '</x:ExcelWorkbook>\n';
            html += '</xml><![endif]-->\n';
            html += '<style>\n';
            html += 'table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }\n';
            html += 'td, th { border: 1px solid #000000; padding: 8px; vertical-align: top; font-family: Calibri, Arial, sans-serif; font-size: 11pt; line-height: 1.5; }\n';
            html += 'th { background-color: #0f4c75; color: white; font-weight: bold; text-align: center; }\n';
            html += 'td { background-color: #ffffff; white-space: normal; word-wrap: break-word; }\n';
            html += 'tr:nth-child(even) td { background-color: #f8f9fa; }\n';
            html += '.header-cell { background-color: #0f4c75; color: white; font-weight: bold; font-size: 14pt; text-align: center; padding: 15px; border: 2px solid #000000; }\n';
            html += '.section-header { background-color: #764ba2; color: white; font-weight: bold; font-size: 12pt; padding: 12px; border: 1px solid #000000; }\n';
            html += '.data-cell { background-color: #ffffff; border: 1px solid #000000; }\n';
            html += '.meta-row { background-color: #f5f5f5; font-size: 9pt; color: #666; border: 1px solid #000000; }\n';
            html += '</style>\n</head>\n<body>\n';
            html += '<table>\n';
            
            html += '<tr><td colspan="2" class="header-cell">PORTER\'S FIVE FORCES ANALYSIS</td></tr>\n';
            html += '<tr class="meta-row"><td colspan="2" style="text-align: center; padding: 5px;">Generated: ' + date + '</td></tr>\n';
            html += '<tr><td colspan="2" style="height: 10px; border: none;"></td></tr>\n';
            
            const sectionNames = {
                'new-entrants': '1. Threat of New Entrants',
                'suppliers': '2. Bargaining Power of Suppliers',
                'rivalry': '3. Rivalry Among Existing Competitors',
                'buyers': '4. Bargaining Power of Buyers',
                'substitutes': '5. Threat of Substitute Products or Services'
            };
            
            Object.keys(forcesData).forEach(section => {
                const cards = forcesData[section];
                if (cards && cards.length > 0 && cards.some(c => c.text && c.text.trim())) {
                    html += '<tr><td colspan="2" class="section-header">' + (sectionNames[section] || section) + '</td></tr>\n';
                    cards.forEach((card, index) => {
                        if (card.text && card.text.trim()) {
                            html += '<tr><td style="width: 30px; text-align: center; font-weight: bold;">' + (index + 1) + '</td><td class="data-cell">' + formatTextForExcel(card.text.trim()) + '</td></tr>\n';
                        }
                    });
                    html += '<tr><td colspan="2" style="height: 10px; border: none;"></td></tr>\n';
                }
            });
            
            html += '</table>\n</body>\n</html>\n';
            return html;
        }

        // Format text for Excel (preserve line breaks)
        function formatTextForExcel(text) {
            if (!text) return '';
            const escaped = escapeHtml(text);
            return escaped.replace(/\n/g, '&#10;');
        }

        // Escape HTML
        function escapeHtml(text) {
            if (!text) return '';
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Download file
        function downloadFile(blob, filename) {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Share file on mobile using Web Share API
        function shareFileMobile(blob, filename, mimeType) {
            const file = new File([blob], filename, { type: mimeType });
            
            if (navigator.canShare && navigator.canShare({ files: [file] })) {
                navigator.share({
                    files: [file],
                    title: 'Porter\'s Five Forces Analysis',
                    text: 'My Porter\'s Five Forces Analysis - ' + filename
                }).catch(error => {
                    console.log('Error sharing file:', error);
                    shareFileMobileFallback(blob, filename, mimeType, null);
                });
            } else {
                if (mimeType === 'text/plain') {
                    blob.text().then(text => {
                        if (navigator.share) {
                            navigator.share({
                                title: 'Porter\'s Five Forces Analysis',
                                text: text
                            }).catch(error => {
                                console.log('Error sharing text:', error);
                                shareFileMobileFallback(blob, filename, mimeType, text);
                            });
                        } else {
                            shareFileMobileFallback(blob, filename, mimeType, text);
                        }
                    }).catch(error => {
                        console.log('Error reading blob:', error);
                        shareFileMobileFallback(blob, filename, mimeType, null);
                    });
                } else {
                    shareFileMobileFallback(blob, filename, mimeType, null);
                }
            }
        }

        // Fallback method for mobile devices
        function shareFileMobileFallback(blob, filename, mimeType, content) {
            const url = window.URL.createObjectURL(blob);
            const isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
            
            if (isIOS) {
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                setTimeout(() => {
                    document.body.removeChild(a);
                    window.URL.revokeObjectURL(url);
                }, 300);
            } else {
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.style.display = 'none';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                window.URL.revokeObjectURL(url);
            }
        }
    </script>
    <script>
    </script>

    <input id="importWordExportInput" type="file" accept=".doc,.docx,.html,.htm,text/html,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" style="display:none" />

</body>
</html>

