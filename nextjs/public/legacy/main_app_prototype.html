<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="description" content="A step-by-step guide to building your strategic plan. Complete your vision, values, mission, SWOT analysis, and execution plan in one interactive workflow.">
    <meta name="keywords" content="strategic planning, business planning, SWOT analysis, strategic workflow, business strategy">
    <meta name="author" content="Strategic Planning Guide">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="Strategic Planning Guide">
    <meta property="og:description" content="A step-by-step guide to building your strategic plan. Complete your vision, values, mission, SWOT analysis, and execution plan in one interactive workflow.">
    
    <!-- Twitter -->
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Strategic Planning Guide">
    <meta name="twitter:description" content="A step-by-step guide to building your strategic plan. Complete your vision, values, mission, SWOT analysis, and execution plan in one interactive workflow.">
    
    <title>Strategic Planning Guide - Prototype</title>
    <!-- Google Fonts - Inter for modern, readable typography -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
</head>
<body>
    <div class="container">
        <header>
            <h1>Strategic Planning Guide</h1>
            <p class="subtitle">A step-by-step guide to building your strategic plan</p>
            <!-- Navigation Buttons -->
            <div class="nav-buttons">
                <a href="prototypes_home.html" class="nav-btn secondary">üè† Home</a>
                <a href="goal_setting_template_prototype.html" class="nav-btn">üéØ Goal Setting</a>
                <a href="porters_five_forces_prototype.html" class="nav-btn">‚öîÔ∏è Five Forces</a>
                <a href="strategic_canvas_prototype.html" class="nav-btn">üé® Strategic Canvas</a>
                <a href="strategic_action_plan_prototype.html" class="nav-btn">üìã Action Plan</a>
                <a href="contingency_plan_prototype.html" class="nav-btn">üõ°Ô∏è Contingency Plan</a>
                <a href="product_canvas_prototype.html" class="nav-btn">üìä Product Canvas</a>
            </div>

            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text" id="progressText">Step 1 of 7</div>
            <!-- Step Navigation Dots -->
            <div class="step-nav-dots" id="stepNavDots">
                <span class="step-dot active" data-step="1" onclick="goToStep(1)" title="Step 1: Purpose"></span>
                <span class="step-dot" data-step="2" onclick="goToStep(2)" title="Step 2: Business Proponents"></span>
                <span class="step-dot" data-step="3" onclick="goToStep(3)" title="Step 3: Mind Map"></span>
                <span class="step-dot" data-step="4" onclick="goToStep(4)" title="Step 4: SWOT Analysis"></span>
                <span class="step-dot" data-step="5" onclick="goToStep(5)" title="Step 5: Strategy"></span>
                <span class="step-dot" data-step="6" onclick="goToStep(6)" title="Step 6: Execution"></span>
                <span class="step-dot" data-step="7" onclick="goToStep(7)" title="Step 7: Review"></span>
            </div>
            <!-- Save Indicator -->
            <div class="save-indicator" id="saveIndicator">Saved</div>
            <!-- Control Buttons (Phase 1 & 2 Features) -->
            <div style="text-align: center; margin-top: 15px; margin-bottom: 20px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                <button class="btn-control" onclick="showTemplateLibrary()" style="background: #17a2b8; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                    üìö Load Template
                </button>
                <button class="btn-control" onclick="showLearnMenu()" style="background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                    üìñ Learn
                </button>
                <button class="btn-control" onclick="triggerImportWordExport()" style="background: #9c27b0; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                    üì• Import Plan
                </button>
                <button class="btn-control" onclick="toggleExamplesMode()" id="examplesModeBtn" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">
                    üëÅÔ∏è View Examples
                </button>
            </div>
            <div id="yourDataButtonContainer" style="text-align: center; margin-top: 10px; display: none;"></div>
        </header>

        <main>
            <!-- Step 1: Purpose (Vision, Values, Mission) -->
            <section class="step active" id="step1">
                <div class="education-section">
                    <h2>Step 1: Define Your Purpose <span class="step-complete-indicator" id="step1Complete"></span></h2>
                    <div class="education-box collapsible">
                        <div class="education-header">
                            <h3>Why This Step Matters</h3>
                            <button class="toggle-btn" onclick="toggleEducation(this)" aria-label="Toggle section">‚àí</button>
                        </div>
                        <div class="education-content">
                            <p>Your purpose is the foundation of everything you do. It answers the basic questions: <strong>Where are you going?</strong> (Vision), <strong>What matters to you?</strong> (Values), and <strong>Why do you exist?</strong> (Mission). Without a clear purpose, your business lacks direction and your team lacks motivation. This clarity helps you make better decisions, attract the right people, and stay focused when challenges come up.</p>
                            <p><strong>Here's what I mean:</strong> If you don't know where you're going, any road will take you there. Your purpose is your destination and your compass.</p>
                            <div class="video-link-section collapsible collapsed">
                                <div class="video-link-header" onclick="toggleVideoSection(this)">
                                    <h4>
                                        <span>üìπ</span> Video Tutorials
                                    </h4>
                                    <button class="video-toggle-btn" aria-label="Toggle video section">+</button>
                                </div>
                                <div class="video-link-content">
                                <div style="margin-bottom: 15px;">
                                    <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">üéì Harvard Business Review (Recommended):</p>
                                    <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">Harvard Business Review: "Use Strategic Thinking to Create the Life You Want" - Learn how to apply strategic thinking to define your vision and purpose.</p>
                                    <a href="https://www.youtube.com/watch?v=dbiNhAZlXZk" target="_blank" rel="noopener noreferrer" 
                                       class="video-link-btn" 
                                       style="display: inline-flex; align-items: center; gap: 8px; background: #FF0000; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(255, 0, 0, 0.3); margin-bottom: 10px;">
                                        <span>‚ñ∂Ô∏è</span> Watch HBR Video
                                    </a>
                                    <div style="margin-top: 8px; font-size: 0.8em; color: var(--text-tertiary); font-style: italic;">
                                        <p style="margin: 0;"><strong>Video Credit:</strong> Harvard Business Review</p>
                                    </div>
                                </div>
                                <div style="padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1);">
                                    <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">üìö Basic Tutorial (For Beginners):</p>
                                    <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">Basic tutorial on defining your purpose (vision, mission, and values).</p>
                                    <a href="https://www.youtube.com/watch?v=NcWzeUNobks" target="_blank" rel="noopener noreferrer" 
                                       class="video-link-btn" 
                                       style="display: inline-flex; align-items: center; gap: 8px; background: #6B7280; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3); margin-bottom: 10px;">
                                        <span>‚ñ∂Ô∏è</span> Watch Basic Tutorial
                                    </a>
                                    <div style="margin-top: 8px; font-size: 0.8em; color: var(--text-tertiary); font-style: italic;">
                                        <p style="margin: 0;"><strong>Video Credit:</strong> YouTube Creator</p>
                                    </div>
                                </div>
                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1); font-size: 0.75em; color: var(--text-tertiary); font-style: italic;">
                                    <p style="margin: 0;">These are external links to YouTube videos. We do not own this content; it is linked for educational purposes only. Content is subject to YouTube's terms and may change or be removed by the original creators.</p>
                                </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <div class="form-group">
                        <label for="business-name">Business Name <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>
                        <p class="field-help">What's your business or organization called? Put it here.</p>
                        <input type="text" id="business-name" placeholder="Enter your business name..." data-char-count>
                        <span class="char-count" id="business-name-count"></span>
                    </div>
                    <div class="form-group">
                        <label for="user-name">Your Name <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>
                        <p class="field-help">Who's creating this strategic plan? That's you - put your name here.</p>
                        <input type="text" id="user-name" placeholder="Enter your name..." data-char-count>
                        <span class="char-count" id="user-name-count"></span>
                    </div>
                    <div class="form-group">
                        <label for="vision">Vision Statement <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>
                        <p class="field-help">Where do you see your company in the future? Million-dollar business? Market leader? Public company? Paint the picture of what success looks like.</p>
                        <textarea id="vision" placeholder="Describe your long-term vision - where you want to be in 5-10 years..." data-char-count></textarea>
                        <span class="char-count" id="vision-count"></span>
                    </div>
                    <div class="form-group">
                        <label for="values">Core Values <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>
                        <p class="field-help">What really matters to your company? Family values? Hard work? Honesty? These guide your decisions and define your company culture.</p>
                        <textarea id="values" placeholder="List your organization's core values (one per line)..." data-char-count></textarea>
                        <span class="char-count" id="values-count"></span>
                    </div>
                    <div class="form-group">
                        <label for="mission">Mission Statement <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>
                        <p class="field-help">Why does your company exist? To make money? To help others? To solve a problem? Your mission explains your reason for being.</p>
                        <textarea id="mission" placeholder="Describe your organization's purpose and why it exists..." data-char-count></textarea>
                        <span class="char-count" id="mission-count"></span>
                    </div>
                </div>
                <button class="btn-next" onclick="nextStep()">Next: Understand Your Business</button>
            </section>

            <!-- Step 2: Proponents of Business (Educational) -->
            <section class="step" id="step2">
                <div class="education-section">
                    <h2>Step 2: Understand Your Business Proponents <span class="step-complete-indicator" id="step2Complete"></span></h2>
                    <div class="education-box collapsible">
                        <div class="education-header">
                            <h3>Why This Step Matters</h3>
                            <button class="toggle-btn" onclick="toggleEducation(this)" aria-label="Toggle section">‚àí</button>
                        </div>
                        <div class="education-content">
                            <p>Every business has four key parts that must work together: Marketing, Sales, Operations, and Administration. Understanding how each one operates and what each needs to succeed is essential for strategic planning. You'll need to consider all aspects of your business and make sure each part has what it needs to work together to achieve your mission.</p>
                            <p><strong>Important questions:</strong> If you were gone, could the business run itself? Could it grow without you? Your job is to plan and decide where the business needs to go, then communicate that plan to your team.</p>
                            <p><strong>Keep this in mind:</strong> You'll need this information when you start strategic planning. Understanding your business structure helps you identify strengths, weaknesses, and opportunities in your SWOT analysis.</p>
                        </div>
                    </div>
                </div>
                
                <div class="proponents-education">
                    <div class="proponent-education-item" data-proponent="marketing">
                        <h3>Marketing</h3>
                        <p class="proponent-note"><strong>Key rule:</strong> DON'T OVERCOMPLICATE IT. GET HELP IF YOU NEED TO</p>
                        <p>Get and keep customer attention. Get your brand in front of customers 8 times. Generate leads. Pass them to the sales team. Marketing includes branding, advertising, market research, email and social media.</p>
                    </div>
                    
                    <div class="proponent-education-item" data-proponent="sales">
                        <h3>Sales</h3>
                        <p class="proponent-note"><strong>Key rule:</strong> DON'T COMPETE ON PRICE. COMPETE ON QUALITY!</p>
                        <p>Check if customers are serious before talking sales. Follow up. Reach out. Build relationships. Don't try to close the sale on the first call. The main job of Sales is to turn leads into customers. Bring in the money.</p>
                    </div>
                    
                    <div class="proponent-education-item" data-proponent="operations">
                        <h3>Operations</h3>
                        <p class="proponent-note"><strong>Key rule:</strong> TAKE TIME TO MAKE SURE OPERATIONS IS EFFICIENT</p>
                        <p>Responsible for delivering your product or service to customers. Operations should be ready to react to market changes. Don't be afraid to outsource parts of operations.</p>
                    </div>
                    
                    <div class="proponent-education-item" data-proponent="administration">
                        <h3>Administration</h3>
                        <p class="proponent-note"><strong>Key question:</strong> If YOU WERE GONE, COULD THE BUSINESS RUN ITSELF? COULD IT GROW WITHOUT YOU?</p>
                        <p>Administration is everything in the back end of the business that isn't Marketing, Sales, or Operations. Examples are Accounting, IT, HR, Payroll, etc.</p>
                        <p>Your job is to lead Administration by planning and deciding where the business needs to go. You must create a strategic plan and communicate it to the team so they can execute it. You must build a system that will operate and even grow without you there. Don't micromanage - communicate the plan and trust your team to execute it.</p>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn-prev" onclick="prevStep()">Previous</button>
                    <button class="btn-next" onclick="nextStep()">Next: Mind Map</button>
                </div>
            </section>

            <!-- Step 3: Mind Map (Input Form) -->
            <section class="step" id="step3">
                <div class="education-section">
                    <h2>Step 3: Create Your Business Mind Map <span class="step-complete-indicator" id="step3Complete"></span></h2>
                    <div class="education-box collapsible">
                        <div class="education-header">
                            <h3>Why This Step Matters</h3>
                            <button class="toggle-btn" onclick="toggleEducation(this)" aria-label="Toggle section">‚àí</button>
                        </div>
                        <div class="education-content">
                            <p>A mind map helps you visualize how your business operates by mapping out each part and how they connect. This doesn't have to be perfect - don't overthink it, just get it down. You'll need this information when you start strategic planning because you must consider all aspects of your business and what each part needs to succeed and work together to achieve your mission.</p>
                            <p><strong>Keep this in mind:</strong> You'll improve this over time, but for now, just get the basics down. This visual representation helps you see the big picture and identify connections you might have missed. This information will be crucial for your SWOT analysis in the next step.</p>
                            <p><strong>Example:</strong> Marketing: Business to Business. Target market is local entrepreneurs between ages 21 and 45. Advertise via social media. Outreach through email. Jeff is responsible for all marketing.</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <div class="proponent-item">
                        <h3>Marketing <button class="proponent-help" onclick="showProponentPopup('marketing')" aria-label="Show marketing help">?</button></h3>
                        <p class="field-help">Show how your marketing works by writing down how it operates and who is responsible for the tasks.</p>
                        <div class="form-group">
                            <label>Marketing Details</label>
                            <textarea class="proponent-marketing" placeholder="Describe your marketing approach, target market, channels, and who is responsible..." data-char-count></textarea>
                            <span class="char-count" id="marketing-count"></span>
                        </div>
                    </div>
                    
                    <div class="proponent-item">
                        <h3>Sales <button class="proponent-help" onclick="showProponentPopup('sales')" aria-label="Show sales help">?</button></h3>
                        <p class="field-help">Visualize your sales by writing down how it operates and who is responsible for carrying out the tasks.</p>
                        <div class="form-group">
                            <label>Sales Details</label>
                            <textarea class="proponent-sales" placeholder="Describe your sales process, approach, and who is responsible..." data-char-count></textarea>
                            <span class="char-count" id="sales-count"></span>
                        </div>
                    </div>
                    
                    <div class="proponent-item">
                        <h3>Operations <button class="proponent-help" onclick="showProponentPopup('operations')" aria-label="Show operations help">?</button></h3>
                        <p class="field-help">Visualize your operations by writing down how it operates and who is responsible for carrying out the tasks.</p>
                        <div class="form-group">
                            <label>Operations Details</label>
                            <textarea class="proponent-operations" placeholder="Describe how you deliver products/services, operational processes, and who is responsible..." data-char-count></textarea>
                            <span class="char-count" id="operations-count"></span>
                        </div>
                    </div>
                    
                    <div class="proponent-item">
                        <h3>Administration <button class="proponent-help" onclick="showProponentPopup('administration')" aria-label="Show administration help">?</button></h3>
                        <p class="field-help">Visualize your administration by writing down how it operates and who is responsible for carrying out the tasks.</p>
                        <div class="form-group">
                            <label>Administration Details</label>
                            <textarea class="proponent-administration" placeholder="Describe administrative systems, processes, and how the business can run without you..." data-char-count></textarea>
                            <span class="char-count" id="administration-count"></span>
                        </div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn-prev" onclick="prevStep()">Previous</button>
                    <button class="btn-next" onclick="nextStep()">Next: SWOT Analysis</button>
                </div>
            </section>

            <!-- Step 4: SWOT Analysis -->
            <section class="step" id="step4">
                <div class="education-section">
                    <h2>Step 4: SWOT Analysis <span class="step-complete-indicator" id="step4Complete"></span></h2>
                    <div class="education-box collapsible">
                        <div class="education-header">
                            <h3>Why This Step Matters</h3>
                            <button class="toggle-btn" onclick="toggleEducation(this)" aria-label="Toggle section">‚àí</button>
                        </div>
                        <div class="education-content">
                            <p>SWOT analysis helps you understand your current position before you plan your next steps. It forces you to be honest about what you're good at, what needs improvement, what opportunities exist, and what threats you face. This honest assessment is crucial because <strong>you can't create effective strategies without knowing where you stand</strong>. Your SWOT findings will directly inform your strategic intent and help you align your goals with reality.</p>
                            <p><strong>Keep this in mind:</strong> These need to be identified and addressed. They need to align with your goals. This is where you create your strategies. Use the business structure you mapped out in the previous step to help identify your strengths and weaknesses.</p>
                            <div class="video-link-section collapsible collapsed">
                                <div class="video-link-header" onclick="toggleVideoSection(this)">
                                    <h4>
                                        <span>üìπ</span> Video Tutorials
                                    </h4>
                                    <button class="video-toggle-btn" aria-label="Toggle video section">+</button>
                                </div>
                                <div class="video-link-content">
                                <div style="padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1);">
                                    <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">üìö Basic Tutorial (For Beginners):</p>
                                    <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">Simple step-by-step guide to performing a SWOT analysis for beginners.</p>
                                    <a href="https://www.youtube.com/watch?v=I_6AVRGLXGA" target="_blank" rel="noopener noreferrer" 
                                       class="video-link-btn" 
                                       style="display: inline-flex; align-items: center; gap: 8px; background: #6B7280; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3); margin-bottom: 10px;">
                                        <span>‚ñ∂Ô∏è</span> Watch Basic Tutorial
                                    </a>
                                    <div style="margin-top: 8px; font-size: 0.8em; color: var(--text-tertiary); font-style: italic;">
                                        <p style="margin: 0;"><strong>Video Credit:</strong> B2U - Business To You</p>
                                    </div>
                                </div>
                                <div style="padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1);">
                                    <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">üìä Additional SWOT Tutorial:</p>
                                    <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">Learn how to conduct a comprehensive SWOT analysis with practical examples and step-by-step guidance.</p>
                                    <a href="https://www.youtube.com/watch?v=mR9eICQJLXA" target="_blank" rel="noopener noreferrer" 
                                       class="video-link-btn" 
                                       style="display: inline-flex; align-items: center; gap: 8px; background: #9333EA; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(147, 51, 234, 0.3); margin-bottom: 10px;">
                                        <span>‚ñ∂Ô∏è</span> Watch SWOT Tutorial
                                    </a>
                                    <div style="margin-top: 8px; font-size: 0.8em; color: var(--text-tertiary); font-style: italic;">
                                        <p style="margin: 0;"><strong>Video Credit:</strong> Virtual Strategist</p>
                                    </div>
                                </div>
                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1); font-size: 0.75em; color: var(--text-tertiary); font-style: italic;">
                                    <p style="margin: 0;">These are external links to YouTube videos. We do not own this content; it is linked for educational purposes only. Content is subject to YouTube's terms and may change or be removed by the original creators.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <div class="swot-grid">
                        <div class="swot-item">
                            <h3>Strengths</h3>
                            <p class="swot-help">What do you do better than others? What unique capabilities and resources do you have? What do others see as your strengths?</p>
                            <textarea id="strengths" placeholder="Internal positive attributes..." data-char-count></textarea>
                            <span class="char-count" id="strengths-count"></span>
                        </div>
                        <div class="swot-item">
                            <h3>Weaknesses</h3>
                            <p class="swot-help">What do others do better than you? What can you improve? What do others see as your weaknesses?</p>
                            <textarea id="weaknesses" placeholder="Internal areas for improvement..." data-char-count></textarea>
                            <span class="char-count" id="weaknesses-count"></span>
                        </div>
                        <div class="swot-item">
                            <h3>Opportunities</h3>
                            <p class="swot-help">What opportunities are you not taking advantage of? What are others doing that you are not? Is there technology that can help you?</p>
                            <textarea id="opportunities" placeholder="External positive factors..." data-char-count></textarea>
                            <span class="char-count" id="opportunities-count"></span>
                        </div>
                        <div class="swot-item">
                            <h3>Threats</h3>
                            <p class="swot-help">What trends or conditions may hurt you? What are others doing that may hurt you? Do you have solid finances? What impact do your weaknesses have on you?</p>
                            <textarea id="threats" placeholder="External challenges..." data-char-count></textarea>
                            <span class="char-count" id="threats-count"></span>
                        </div>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn-prev" onclick="prevStep()">Previous</button>
                    <button class="btn-next" onclick="nextStep()">Next: Strategy</button>
                </div>
            </section>

            <!-- Step 5: Strategy (Goals, Strategic Intent, Drivers, Enablers) -->
            <section class="step" id="step5">
                <div class="education-section">
                    <h2>Step 5: Develop Your Strategy <span class="step-complete-indicator" id="step5Complete"></span></h2>
                    <div class="education-box collapsible">
                        <div class="education-header">
                            <h3>Why This Step Matters</h3>
                            <button class="toggle-btn" onclick="toggleEducation(this)" aria-label="Toggle section">‚àí</button>
                        </div>
                        <div class="education-content">
                            <p>Strategy is your roadmap from where you are (SWOT) to where you want to be (Vision). Without a clear strategy, you'll waste resources and effort on activities that don't move you forward. Your strategy translates your vision into actionable plans by setting goals at different time horizons, defining how you'll achieve them (Strategic Intent), identifying what you'll focus on (Drivers), and determining what capabilities you need (Enablers).</p>
                            <p><strong>Key principle:</strong> Your strategic intent should reference your SWOT analysis - use your strengths and opportunities while addressing weaknesses and threats.</p>
                            <div class="video-link-section" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid var(--primary-color);">
                                <h4 style="color: var(--primary-color); margin-bottom: 15px; display: flex; align-items: center; gap: 8px;">
                                    <span>üìπ</span> Video Tutorials
                                </h4>
                                <div style="margin-bottom: 15px;">
                                    <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">üéì Harvard Business Review (Recommended):</p>
                                    <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">Harvard Business Review: Learn how to develop effective strategies and make integrative choices for competitive advantage.</p>
                                    <a href="https://www.youtube.com/watch?v=iuYlGRnC7J8" target="_blank" rel="noopener noreferrer" 
                                       class="video-link-btn" 
                                       style="display: inline-flex; align-items: center; gap: 8px; background: #FF0000; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(255, 0, 0, 0.3); margin-bottom: 10px;">
                                        <span>‚ñ∂Ô∏è</span> Watch HBR Video
                                    </a>
                                    <div style="margin-top: 8px; font-size: 0.8em; color: var(--text-tertiary); font-style: italic;">
                                        <p style="margin: 0;"><strong>Video Credit:</strong> Harvard Business Review</p>
                                    </div>
                                </div>
                                <div style="padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1);">
                                    <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">üìö Basic Tutorial (For Beginners):</p>
                                    <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">How to translate your SWOT analysis into actionable strategic goals - a beginner-friendly guide.</p>
                                    <a href="https://www.youtube.com/watch?v=HQ6348u6o08" target="_blank" rel="noopener noreferrer" 
                                       class="video-link-btn" 
                                       style="display: inline-flex; align-items: center; gap: 8px; background: #6B7280; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3); margin-bottom: 10px;">
                                        <span>‚ñ∂Ô∏è</span> Watch Basic Tutorial
                                    </a>
                                    <div style="margin-top: 8px; font-size: 0.8em; color: var(--text-tertiary); font-style: italic;">
                                        <p style="margin: 0;"><strong>Video Credit:</strong> GreggU</p>
                                    </div>
                                </div>
                                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1); font-size: 0.75em; color: var(--text-tertiary); font-style: italic;">
                                    <p style="margin: 0;">These are external links to YouTube videos. We do not own this content; it is linked for educational purposes only. Content is subject to YouTube's terms and may change or be removed by the original creators.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="education-box collapsible" style="margin-top: 20px;">
                        <div class="education-header">
                            <h3>Is Your Goal SMART? <button class="help-toggle" onclick="showSMARTGoalInfo()" aria-label="Learn about SMART goals" style="margin-left: 10px; background: #0f4c75; color: white; border: none; padding: 4px 10px; border-radius: 50%; font-size: 0.9em; cursor: pointer; font-weight: bold;">‚ÑπÔ∏è</button></h3>
                            <button class="toggle-btn" onclick="toggleEducation(this)" aria-label="Toggle section">‚àí</button>
                        </div>
                        <div class="education-content">
                            <p><strong>Before working on any goal, ensure it meets required SMART criteria (Specific, Measurable, Attainable, Relevant). Time-specific is optional.</strong></p>
                            <ul style="margin-left: 20px; margin-top: 10px;">
                                <li><strong>Specific:</strong> Your goal must be clearly defined and unambiguous. Vague goals lead to confusion and wasted effort.</li>
                                <li><strong>Measurable:</strong> You must be able to track progress and know when the goal is achieved. Without metrics, you can't determine success.</li>
                                <li><strong>Attainable:</strong> The goal must be realistic given your resources, constraints, and current situation. Unrealistic goals set you up for failure.</li>
                                <li><strong>Relevant:</strong> The goal must align with your vision, values, and strategic priorities. Irrelevant goals waste time and resources.</li>
                            </ul>
                            <div style="background: #e7f3ff; border-left: 4px solid #0f4c75; padding: 15px; margin: 15px 0; border-radius: 6px;">
                                <p style="margin: 0 0 10px 0; font-weight: 600; color: #0f4c75; font-size: 1.05em;">‚è∞ Time-Specific: Optional but Valuable</p>
                                <p style="margin: 0; line-height: 1.7; color: #333;">For small business owners, not all goals need to be time-bound‚Äîespecially when first getting started. Early-stage businesses often require flexibility to adapt to changing conditions and opportunities. Time-specific goals become more important as your business grows and you have employees to manage. Deadlines help create accountability and ensure team alignment, but when you're the sole decision-maker, allowing goals to evolve naturally can be more valuable than forcing artificial deadlines.</p>
                            </div>
                            <p style="margin-top: 15px;"><strong>Why this matters:</strong> Goals that don't meet all required SMART criteria are more likely to fail, waste resources, and create frustration. Research shows that well-defined SMART goals significantly increase the likelihood of success. By ensuring your goals are Specific, Measurable, Attainable, and Relevant before you begin working on them, you set yourself up for success from the start.</p>
                            <p><strong>Use the Goal Setting Template:</strong> When you click on a goal field, the Goal Setting Template will help you refine your goal to meet all required SMART criteria before you proceed with strategic planning.</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <div class="goals-tabs" id="strategyGoalsTabs"></div>
                    <div id="goalsContainer"></div>
                    <div style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
                        <button class="btn-add" onclick="addGoal()">+ Add Goal</button>
                        <button class="btn-add" onclick="openCurrentGoalInActionPlan()" style="background:#2563EB;">üìã Open in Action Plan</button>
                            </div>
                </div>
                <div class="button-group">
                    <button class="btn-prev" onclick="prevStep()">Previous</button>
                    <button class="btn-next" onclick="nextStep()">Next: Execution</button>
                </div>
            </section>

            <!-- Step 6: Execution (Targets, KPIs, Strategy Map) -->
            <section class="step" id="step6">
                <div class="education-section">
                    <h2>Step 6: Plan Your Execution <span class="step-complete-indicator" id="step6Complete"></span></h2>
                    <div class="education-box collapsible">
                        <div class="education-header">
                            <h3>Why This Step Matters</h3>
                            <button class="toggle-btn" onclick="toggleEducation(this)" aria-label="Toggle section">‚àí</button>
                        </div>
                        <div class="education-content">
                            <p>A great strategy is worthless without execution. This step transforms your strategy into concrete actions and measurable outcomes. Setting targets and initiatives gives you specific things to do. Performance indicators (KPIs) tell you if you're succeeding. A strategy map helps you test and communicate your strategy to your team. Without clear execution plans, your strategy remains just a wish list.</p>
                            <p><strong>Keep this in mind:</strong> You must create a system that will operate and even grow without you present. Don't micromanage - communicate the plan and trust your team to execute it.</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <div class="form-group">
                        <label for="targets-initiatives">Targets & Initiatives <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>
                        <p class="field-help">What will you need to do? Set specific targets and plan projects that support your goals.</p>
                        <textarea id="targets-initiatives" placeholder="List specific targets and initiatives..." data-char-count></textarea>
                        <span class="char-count" id="targets-count"></span>
                    </div>
                    <div class="form-group">
                        <label for="kpis">Performance Indicators (KPIs) <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>
                        <p class="field-help">How will you know you are succeeding? These metrics help you track progress and make informed decisions.</p>
                        <textarea id="kpis" placeholder="List key performance indicators to track..." data-char-count></textarea>
                        <span class="char-count" id="kpis-count"></span>
                    </div>
                    <div class="form-group">
                        <label for="strategy-map">Strategy Map <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>
                        <p class="field-help">How will you test and communicate the strategy? This helps ensure everyone understands and can execute the plan.</p>
                        <textarea id="strategy-map" placeholder="Describe how you will communicate and test your strategy..." data-char-count></textarea>
                        <span class="char-count" id="strategy-map-count"></span>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn-prev" onclick="prevStep()">Previous</button>
                    <button class="btn-next" onclick="nextStep()">Next: Review & Complete</button>
                </div>
            </section>

            <!-- Step 7: Review & Complete -->
            <section class="step" id="step7">
                <div class="education-section">
                    <h2>Step 7: Review & Complete Your Plan <span class="step-complete-indicator" id="step7Complete"></span></h2>
                    <div class="education-box collapsible">
                        <div class="education-header">
                            <h3>Why This Step Matters</h3>
                            <button class="toggle-btn" onclick="toggleEducation(this)" aria-label="Toggle section">‚àí</button>
                        </div>
                        <div class="education-content">
                            <p>Strategic planning is not a one-time event - it's an ongoing process. Setting up review frequencies and success criteria ensures your plan stays relevant and you can track progress. Regular reviews help you adjust course when needed and celebrate wins along the way. This final step makes your plan actionable and measurable.</p>
                            <p><strong>Keep this in mind:</strong> A plan that isn't reviewed is just a document. Make time to regularly review and adjust your strategic plan.</p>
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <div class="form-group">
                        <label for="review-frequency">Review Frequency <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>
                        <p class="field-help">How often will you review your strategic plan? Regular reviews keep your plan relevant and help you stay on track.</p>
                        <select id="review-frequency">
                            <option value="weekly">Weekly</option>
                            <option value="monthly">Monthly</option>
                            <option value="quarterly" selected>Quarterly</option>
                            <option value="semi-annually">Semi-Annually</option>
                            <option value="annually">Annually</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="success-criteria">Success Criteria <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>
                        <p class="field-help">How will you measure success? What does achieving your vision look like?</p>
                        <textarea id="success-criteria" placeholder="Describe how you will measure success..." data-char-count></textarea>
                        <span class="char-count" id="success-criteria-count"></span>
                    </div>
                    <div class="form-group">
                        <label for="notes">Additional Notes & Considerations <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>
                        <p class="field-help">Any additional thoughts, considerations, or important reminders for your strategic plan.</p>
                        <textarea id="notes" placeholder="Any additional considerations..." data-char-count></textarea>
                        <span class="char-count" id="notes-count"></span>
                    </div>
                </div>
                <div class="button-group">
                    <button class="btn-prev" onclick="prevStep()">Previous</button>
                    <div class="export-options">
                        <button class="btn-export" onclick="showExportOptions()">Export Strategic Plan</button>
                        <div class="export-dropdown" id="exportDropdown">
                            <button class="export-option" onclick="exportPlan('txt')">Export as Text (.txt)</button>
                            <button class="export-option" onclick="exportPlan('docx')">Export as Word (.docx)</button>
                            <button class="export-option" onclick="exportPlan('xlsx')">Export as Excel (.xlsx)</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Hidden file input for importing previously exported Word document -->
    <input id="importWordExportInput" type="file" accept=".doc,.docx,.html,.htm,text/html,application/msword,application/vnd.openxmlformats-officedocument.wordprocessingml.document" style="display:none" />

    <!-- Proponent Popup Modal -->
    <div class="popup-overlay" id="proponentPopup" onclick="closeProponentPopup(event)">
        <div class="popup-content" onclick="event.stopPropagation()">
            <button class="popup-close" onclick="closeProponentPopup(event)">&times;</button>
            <h3 id="popupTitle"></h3>
            <div id="popupContent"></div>
        </div>
    </div>

    <!-- Goal Setting Template Modal -->
    <div class="goal-setting-modal" id="goalSettingModal" onclick="closeGoalSettingModal(event)">
        <div class="goal-setting-modal-content" onclick="event.stopPropagation()">
            <button class="goal-setting-modal-close" onclick="closeGoalSettingModal()">&times;</button>
            <iframe id="goalSettingIframe" src="goal_setting_template_prototype.html?modal=true" style="width: 100%; height: 100%; border: none;"></iframe>
        </div>
    </div>

    
    <style>
/* ============================================
   MODERN DESIGN SYSTEM - BRIGHT & PROFESSIONAL
   ============================================ */

/* Color Palette - Bright, Futuristic, Professional */
:root {
    /* Primary Colors - Vibrant Blues & Cyans (Solid Colors) */
    --primary-color: #5B8DEF;
    --primary-dark: #4A7BC8;
    --primary-light: #7BA3F5;
    --primary-purple: #9333EA;
    --primary-cyan: #00D4FF;
    
    /* Accent Colors */
    --accent-cyan: #00F0FF;
    --accent-purple: #A855F7;
    --accent-blue: #3B82F6;
    --accent-pink: #EC4899;
    
    /* Background Colors */
    --bg-primary: #FFFFFF;
    --bg-secondary: #F8FAFC;
    --bg-tertiary: #F1F5F9;
    --bg-main: #E8F4F8;
    
    /* Text Colors - High Contrast for Readability */
    --text-primary: #0F172A;
    --text-secondary: #475569;
    --text-tertiary: #64748B;
    --text-light: #94A3B8;
    --text-white: #FFFFFF;
    
    /* Status Colors */
    --success: #10B981;
    --success-light: #D1FAE5;
    --warning: #F59E0B;
    --warning-light: #FEF3C7;
    --error: #EF4444;
    --error-light: #FEE2E2;
    --info: #3B82F6;
    --info-light: #DBEAFE;
    
    /* Shadows - Modern, Soft */
    --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
    --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    --shadow-glow: 0 0 20px rgba(147, 51, 234, 0.3);
    
    /* Spacing */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    --spacing-xl: 2rem;
    --spacing-2xl: 3rem;
    
    /* Border Radius */
    --radius-sm: 0.375rem;
    --radius-md: 0.5rem;
    --radius-lg: 0.75rem;
    --radius-xl: 1rem;
    --radius-2xl: 1.5rem;
    --radius-full: 9999px;
    
    /* Transitions */
    --transition-fast: 150ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-base: 300ms cubic-bezier(0.4, 0, 0.2, 1);
    --transition-slow: 500ms cubic-bezier(0.4, 0, 0.2, 1);
}

/* Reset & Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
    background: var(--bg-main);
    min-height: 100vh;
    padding: 20px;
    color: var(--text-primary);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    line-height: 1.6;
    font-weight: 400;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    background: transparent;
    border-radius: var(--radius-2xl);
    box-shadow: none;
    overflow: hidden;
}

header {
    background: var(--primary-color);
    color: var(--text-white);
    padding: 40px 30px;
    padding-top: 100px;
    text-align: center;
    position: relative;
    overflow: hidden;
    box-shadow: var(--shadow-lg);
}

header h1 {
    font-size: 2.75em;
    margin-bottom: 12px;
    font-weight: 800;
    letter-spacing: -0.02em;
    text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
    position: relative;
    z-index: 1;
}

.subtitle {
    font-size: 1.15em;
    opacity: 0.95;
    margin-bottom: 24px;
    font-weight: 400;
    position: relative;
    z-index: 1;
}

.progress-bar {
    width: 100%;
    height: 10px;
    background: rgba(255, 255, 255, 0.2);
    border-radius: var(--radius-full);
    overflow: hidden;
    margin-bottom: 12px;
    position: relative;
    z-index: 1;
}

.progress-fill {
    height: 100%;
    background: var(--accent-purple);
    width: 14.28%;
    transition: width var(--transition-base);
    border-radius: var(--radius-full);
    box-shadow: 0 0 10px rgba(147, 51, 234, 0.5);
    position: relative;
    overflow: hidden;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    animation: shimmer 2s infinite;
}

@keyframes shimmer {
    0% { left: -100%; }
    100% { left: 100%; }
}

.progress-text {
    font-size: 0.95em;
    opacity: 0.95;
    margin-bottom: 16px;
    font-weight: 500;
    position: relative;
    z-index: 1;
}

/* Step Navigation Dots */
.step-nav-dots {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 15px;
    flex-wrap: wrap;
}

.step-dot {
    width: 14px;
    height: 14px;
    border-radius: var(--radius-full);
    background: rgba(255, 255, 255, 0.4);
    cursor: pointer;
    transition: all var(--transition-base);
    border: 2px solid rgba(255, 255, 255, 0.6);
    position: relative;
}

.step-dot:hover {
    background: rgba(255, 255, 255, 0.7);
    transform: scale(1.3);
    box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
}

.step-dot.active {
    background: var(--text-white);
    border-color: var(--text-white);
    box-shadow: 0 0 15px rgba(255, 255, 255, 0.8);
    transform: scale(1.2);
}

.step-dot.complete {
    background: var(--success);
    border-color: var(--success);
    box-shadow: 0 0 10px rgba(16, 185, 129, 0.5);
}

/* Save Indicator */
.save-indicator {
    position: fixed;
    top: 24px;
    right: 24px;
    background: var(--success);
    color: var(--text-white);
    padding: 14px 24px;
    border-radius: var(--radius-full);
    font-size: 0.95em;
    font-weight: 600;
    box-shadow: var(--shadow-lg);
    opacity: 0;
    transform: translateY(-20px) scale(0.9);
    transition: all var(--transition-base);
    z-index: 1000;
    pointer-events: none;
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.save-indicator.show {
    opacity: 1;
    transform: translateY(0) scale(1);
}

/* Step Completion Indicator */
.step-complete-indicator {
    display: inline-block;
    margin-left: 12px;
    color: var(--success);
    font-size: 0.85em;
    opacity: 0;
    transition: opacity var(--transition-base);
    font-weight: 600;
}

.step-complete-indicator.show {
    opacity: 1;
}

.step-complete-indicator::before {
    content: "‚úì ";
    font-weight: bold;
}

main {
    padding: 40px;
    display: flex;
    flex-direction: column;
    min-height: calc(100vh - 300px);
}

.step {
    display: none;
    animation: fadeIn 0.3s ease;
    flex: 1;
    flex-direction: column;
}

.step.active {
    display: flex;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.education-section {
    margin-bottom: 30px;
}

.step h2 {
    color: var(--primary-purple);
    margin-bottom: 24px;
    font-size: 2.25em;
    font-weight: 700;
    border-bottom: 3px solid var(--primary-purple);
    padding-bottom: 12px;
    letter-spacing: -0.01em;
}

.education-box {
    background: var(--bg-secondary);
    border-left: 4px solid var(--primary-purple);
    padding: 24px;
    border-radius: var(--radius-xl);
    margin-bottom: 28px;
    box-shadow: var(--shadow-md);
    transition: all var(--transition-base);
}

.education-box:hover {
    box-shadow: var(--shadow-lg);
    transform: translateY(-2px);
}

.education-box.collapsible {
    padding: 0;
}

.education-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 20px;
    cursor: pointer;
}

.education-header h3 {
    color: #0f4c75;
    margin: 0;
    font-size: 1.3em;
}

.toggle-btn {
    background: #0f4c75;
    color: white;
    border: none;
    border-radius: 50%;
    width: 28px;
    height: 28px;
    font-size: 1.2em;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    flex-shrink: 0;
}

.toggle-btn:hover {
    background: #3282b8;
    transform: scale(1.1);
}

.education-content {
    padding: 0 20px 20px 20px;
    transition: max-height 0.3s ease, opacity 0.3s ease;
    overflow: hidden;
}

.video-link-btn:hover {
    background: #CC0000 !important;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(255, 0, 0, 0.4) !important;
}

.video-link-btn[style*="background: #6B7280"]:hover {
    background: #4B5563 !important;
    box-shadow: 0 4px 12px rgba(107, 114, 128, 0.4) !important;
}

.video-link-btn:active {
    transform: translateY(0);
}

.education-box.collapsed .education-content {
    max-height: 0;
    padding: 0 20px;
    opacity: 0;
}

.education-box.collapsed .toggle-btn {
    transform: rotate(180deg);
}

/* Collapsible Video Sections */
.video-link-section.collapsible {
    margin-top: 20px;
    padding: 0;
    border-top: none;
}

.video-link-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 0;
    cursor: pointer;
    border-top: 2px solid var(--primary-color);
    margin-top: 20px;
}

.video-link-header h4 {
    color: var(--primary-color);
    margin: 0;
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 1em;
}

.video-link-header .video-toggle-btn {
    background: transparent;
    border: 2px solid var(--primary-color);
    color: var(--primary-color);
    width: 28px;
    height: 28px;
    border-radius: 50%;
    font-size: 1em;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s ease;
    font-weight: bold;
    line-height: 1;
}

.video-link-header .video-toggle-btn:hover {
    background: var(--primary-color);
    color: white;
}

.video-link-content {
    padding-top: 15px;
    transition: max-height 0.3s ease, opacity 0.3s ease;
    overflow: hidden;
}

.video-link-section.collapsed .video-link-content {
    max-height: 0;
    padding-top: 0;
    opacity: 0;
    overflow: hidden;
}

.education-box p {
    line-height: 1.8;
    color: #555;
    margin-bottom: 12px;
}

.education-box p {
    line-height: 1.8;
    color: #555;
    margin-bottom: 12px;
}

.education-box p:last-child {
    margin-bottom: 0;
}

.education-box strong {
    color: #333;
    font-weight: 600;
}

.form-section {
    margin-top: 30px;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.form-group {
    margin-bottom: 25px;
}

.form-group label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #555;
    font-size: 1.1em;
}

.field-help {
    font-size: 0.9em;
    color: #666;
    margin-bottom: 8px;
    font-style: italic;
    line-height: 1.5;
    transition: opacity 0.3s ease, max-height 0.3s ease;
    overflow: hidden;
}

.field-help.hidden {
    opacity: 0;
    max-height: 0;
    margin: 0;
}

/* Help Toggle Button */
.help-toggle {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 22px;
    height: 22px;
    border-radius: var(--radius-full);
    background: var(--primary-color);
    color: var(--text-white);
    border: none;
    font-size: 0.85em;
    font-weight: 700;
    cursor: pointer;
    margin-left: 8px;
    vertical-align: middle;
    line-height: 1;
    transition: all var(--transition-base);
    box-shadow: var(--shadow-sm);
}

.help-toggle:hover {
    transform: scale(1.15) rotate(180deg);
    box-shadow: var(--shadow-md);
}

.help-toggle:active {
    transform: scale(0.9);
}

/* Proponent Help Button */
.proponent-help {
    display: inline-block;
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: #0f4c75;
    color: white;
    border: none;
    font-size: 0.9em;
    font-weight: bold;
    cursor: pointer;
    margin-left: 10px;
    vertical-align: middle;
    line-height: 1;
    transition: all 0.3s ease;
}

.proponent-help:hover {
    background: #3282b8;
    transform: scale(1.15);
}

/* Character Count */
.char-count {
    display: block;
    text-align: right;
    font-size: 0.85em;
    color: #999;
    margin-top: 5px;
}

/* Goal Setting Modal */
.goal-setting-modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.9);
    z-index: 5000;
    overflow: hidden;
}

.goal-setting-modal.show {
    display: block;
}

.goal-setting-modal-content {
    position: relative;
    width: 100%;
    height: 100%;
    background: white;
    display: flex;
    flex-direction: column;
}

.goal-setting-modal-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #dc3545;
    color: white;
    border: none;
    padding: 12px 20px;
    border-radius: 6px;
    cursor: pointer;
    font-weight: 600;
    font-size: 1.1em;
    z-index: 5001;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.goal-setting-modal-close:hover {
    background: #c82333;
}

.goal-setting-modal-content iframe {
    flex: 1;
    border: none;
}

/* Popup Modal */
.popup-overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    z-index: 2000;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s ease;
}

.popup-overlay.show {
    display: flex;
}

.popup-content {
    background: white;
    border-radius: 12px;
    padding: 30px;
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    animation: slideUp 0.3s ease;
}

@keyframes slideUp {
    from {
        transform: translateY(20px);
        opacity: 0;
    }
    to {
        transform: translateY(0);
        opacity: 1;
    }
}

.popup-close {
    position: absolute;
    top: 15px;
    right: 15px;
    background: #dc3545;
    color: white;
    border: none;
    border-radius: 50%;
    width: 30px;
    height: 30px;
    font-size: 1.5em;
    cursor: pointer;
    line-height: 1;
    transition: all 0.3s ease;
}

.popup-close:hover {
    background: #c82333;
    transform: scale(1.1);
}

.popup-content h3 {
    color: #0f4c75;
    margin-bottom: 15px;
    font-size: 1.5em;
    padding-right: 40px;
}

.popup-content .proponent-note {
    background: #fff3cd;
    border-left: 3px solid #ffc107;
    padding: 10px 15px;
    margin-bottom: 15px;
    border-radius: 4px;
    font-size: 0.95em;
    color: #856404;
}

.popup-content p {
    line-height: 1.8;
    color: #555;
    margin-bottom: 12px;
}

.form-group input[type="text"],
.form-group input[type="date"],
.form-group select,
.form-group textarea {
    width: 100%;
    padding: 14px 16px;
    border: 2px solid var(--bg-tertiary);
    border-radius: var(--radius-lg);
    font-size: 1em;
    font-family: 'Inter', sans-serif;
    transition: all var(--transition-base);
    -webkit-appearance: none;
    appearance: none;
    background: var(--bg-primary);
    color: var(--text-primary);
    font-weight: 400;
}

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none;
    border-color: var(--primary-purple);
    box-shadow: 0 0 0 3px rgba(147, 51, 234, 0.1);
    transform: translateY(-1px);
}

.form-group textarea {
    min-height: 130px;
    resize: vertical;
    line-height: 1.6;
}

.swot-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 24px;
    margin-bottom: 36px;
    align-items: stretch;
    flex: 1;
}

.swot-item {
    padding: 28px;
    border-radius: var(--radius-xl);
    border: 2px solid transparent;
    display: flex;
    flex-direction: column;
    height: 100%;
    min-height: 500px;
    transition: all var(--transition-base);
    box-shadow: var(--shadow-md);
}

.swot-item:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
}

.swot-item h3 {
    margin-bottom: 12px;
    font-size: 1.4em;
    font-weight: 700;
    flex-shrink: 0;
    letter-spacing: -0.01em;
}

.swot-help {
    font-size: 0.9em;
    color: var(--text-secondary);
    margin-bottom: 16px;
    font-style: italic;
    line-height: 1.5;
    flex-shrink: 0;
}

.swot-item:nth-child(1) {
    background: #D1FAE5;
    border-color: var(--success);
}

.swot-item:nth-child(1) h3 {
    color: #047857;
}

.swot-item:nth-child(2) {
    background: #FEF3C7;
    border-color: var(--warning);
}

.swot-item:nth-child(2) h3 {
    color: #B45309;
}

.swot-item:nth-child(3) {
    background: #DBEAFE;
    border-color: var(--info);
}

.swot-item:nth-child(3) h3 {
    color: #1E40AF;
}

.swot-item:nth-child(4) {
    background: #FCE7F3;
    border-color: var(--accent-pink);
}

.swot-item:nth-child(4) h3 {
    color: #BE185D;
}

.swot-item textarea {
    min-height: 320px;
    flex: 1 1 auto;
    width: 100%;
    resize: vertical;
    background: rgba(255, 255, 255, 0.7);
    border: 2px solid rgba(255, 255, 255, 0.5);
}

.swot-item textarea:focus {
    background: rgba(255, 255, 255, 0.9);
    border-color: rgba(255, 255, 255, 0.8);
}

.swot-item .char-count {
    flex-shrink: 0;
    margin-top: 8px;
}

.goal-item,
.proponent-item {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid #0f4c75;
}

/* Step 5 Goal Tabs (like Strategic Action Plan) */
.goals-tabs {
    display: flex;
    gap: 10px;
    margin-bottom: 18px;
    flex-wrap: wrap;
}

.goal-tab {
    background: #f8f9fa;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    padding: 10px 14px;
    cursor: pointer;
    font-weight: 600;
    font-size: 0.95em;
    transition: all 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
}

.goal-tab:hover {
    background: #e9ecef;
    border-color: #0f4c75;
}

.goal-tab.active {
    background: #0f4c75;
    color: white;
    border-color: #0f4c75;
}

.goal-tab-close {
    background: rgba(0, 0, 0, 0.2);
    border: none;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    line-height: 1;
    color: inherit;
    transition: all 0.2s ease;
}

.goal-tab.active .goal-tab-close {
    background: rgba(255, 255, 255, 0.3);
}

.goal-tab-close:hover {
    background: rgba(255, 0, 0, 0.6);
    transform: scale(1.1);
}

.proponents-education {
    margin-top: 30px;
}

.proponent-education-item {
    background: #f8f9fa;
    padding: 25px;
    border-radius: 8px;
    margin-bottom: 20px;
    border-left: 4px solid #0f4c75;
}

.proponent-education-item h3 {
    color: #0f4c75;
    margin-bottom: 10px;
    font-size: 1.4em;
}

.proponent-education-item p {
    line-height: 1.8;
    color: #555;
    margin-bottom: 12px;
}

.proponent-education-item p:last-child {
    margin-bottom: 0;
}

.proponent-item h3 {
    color: #0f4c75;
    margin-bottom: 10px;
    font-size: 1.4em;
    display: flex;
    align-items: center;
}

.proponent-note {
    background: #fff3cd;
    border-left: 3px solid #ffc107;
    padding: 10px 15px;
    margin-bottom: 15px;
    border-radius: 4px;
    font-size: 0.95em;
    color: #856404;
}

.button-group {
    display: flex;
    gap: 15px;
    justify-content: space-between;
    margin-top: 30px;
}

.btn-next,
.btn-prev,
.btn-add,
.btn-export,
.btn-edit,
.btn-control {
    padding: 14px 32px;
    border: none;
    border-radius: var(--radius-full);
    font-size: 1.05em;
    font-weight: 600;
    cursor: pointer;
    transition: all var(--transition-base);
    -webkit-tap-highlight-color: transparent;
    font-family: 'Inter', sans-serif;
    letter-spacing: -0.01em;
    position: relative;
    overflow: hidden;
}

.btn-next::before,
.btn-export::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: var(--radius-full);
    background: rgba(255, 255, 255, 0.3);
    transform: translate(-50%, -50%);
    transition: width var(--transition-base), height var(--transition-base);
}

.btn-next:hover::before,
.btn-export:hover::before {
    width: 300px;
    height: 300px;
}

.btn-next,
.btn-export {
    background: var(--primary-color);
    color: var(--text-white);
    box-shadow: var(--shadow-md);
}

.btn-next:hover,
.btn-export:hover {
    background: var(--primary-dark);
}

.btn-next:hover,
.btn-export:hover {
    transform: translateY(-3px) scale(1.02);
    box-shadow: var(--shadow-xl), var(--shadow-glow);
}

.btn-next:active,
.btn-export:active {
    transform: translateY(-1px) scale(1);
}

.btn-prev {
    background: var(--text-tertiary);
    color: var(--text-white);
    box-shadow: var(--shadow-md);
}

.btn-prev:hover {
    background: var(--text-secondary);
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.btn-prev:active {
    transform: translateY(0);
}

.btn-add {
    background: var(--success);
    color: var(--text-white);
    margin-bottom: 24px;
    box-shadow: var(--shadow-md);
}

.btn-add:hover {
    background: #059669;
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.btn-edit {
    background: var(--info);
    color: var(--text-white);
    box-shadow: var(--shadow-md);
}

.btn-edit:hover {
    background: #2563EB;
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.btn-control {
    background: var(--primary-color);
    color: var(--text-white);
    box-shadow: var(--shadow-md);
    padding: 12px 24px;
    font-size: 1em;
}

.btn-control:hover {
    background: var(--primary-dark);
}

.btn-control:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: var(--shadow-lg), var(--shadow-glow);
}

/* Export Options */
.export-options {
    position: relative;
    display: inline-block;
}

.export-dropdown {
    display: none;
    position: absolute;
    bottom: 100%;
    right: 0;
    margin-bottom: 10px;
    background: white;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    min-width: 200px;
    z-index: 1000;
    overflow: hidden;
}

.export-dropdown.show {
    display: block;
    animation: slideDown 0.3s ease;
}

@keyframes slideDown {
    from {
        opacity: 0;
        transform: translateY(-10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.export-option {
    display: block;
    width: 100%;
    padding: 12px 20px;
    border: none;
    background: white;
    color: #333;
    text-align: left;
    cursor: pointer;
    transition: background 0.2s ease;
    font-size: 0.95em;
}

.export-option:hover {
    background: #f8f9fa;
}

.export-option:first-child {
    border-bottom: 1px solid #e0e0e0;
}

.summary {
    padding: 30px;
}

.summary h2 {
    color: #0f4c75;
    margin-bottom: 30px;
    font-size: 2em;
}

.summary-section {
    margin-bottom: 30px;
    padding: 20px;
    background: #f8f9fa;
    border-radius: 8px;
}

.summary-section h3 {
    color: #0f4c75;
    margin-bottom: 15px;
}

.summary-section p {
    line-height: 1.8;
    color: #555;
}

@media (max-width: 768px) {
    .swot-grid {
        grid-template-columns: 1fr;
    }
    
    header h1 {
        font-size: 1.8em;
    }
    
    .subtitle {
        font-size: 1em;
    }
    
    main {
        padding: 20px;
    }
    
    .step h2 {
        font-size: 1.6em;
    }
    
    .button-group {
        flex-direction: column;
    }
    
    .btn-next,
    .btn-prev,
    .btn-export {
        width: 100%;
    }
    
    .education-box {
        padding: 15px;
    }
    
    .education-header {
        padding: 15px;
    }
    
    .education-content {
        padding: 0 15px 15px 15px;
    }
    
    .education-box.collapsed .education-content {
        padding: 0 15px;
    }
    
    .education-header h3 {
        font-size: 1.1em;
    }
    
    .education-box p {
        font-size: 0.95em;
    }
    
    .step-nav-dots {
        gap: 8px;
    }
    
    .step-dot {
        width: 10px;
        height: 10px;
    }
    
    .save-indicator {
        top: 10px;
        right: 10px;
        padding: 8px 15px;
        font-size: 0.85em;
    }
    
    .popup-content {
        padding: 20px;
        width: 95%;
    }
    
    .export-dropdown {
        right: auto;
        left: 0;
        min-width: 180px;
    }
    
    .export-options {
        width: 100%;
    }
    
    .btn-export {
        width: 100%;
    }
}


        /* Navigation Styles */
        .nav-buttons {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            z-index: 10;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.5);
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.8);
            transform: translateY(-2px);
        }

        .nav-btn.secondary {
            background: rgba(255, 255, 255, 0.15);
        }

        @media (max-width: 768px) {
            .save-button-container {
                position: static;
                text-align: center;
                margin-bottom: 10px;
            }
            
            .nav-buttons {
                position: static;
                justify-content: center;
                margin-bottom: 15px;
            }
            
            header {
                position: relative;
                padding-top: 30px;
            }
        }

        /* Phase 1 & 2: Educational Features CSS */
        
        /* Template Library Modal */
        .template-library {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .template-library.show {
            display: flex;
        }

        .template-library-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .template-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .template-item {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .template-item:hover {
            border-color: #0f4c75;
            background: #f8f9fa;
            transform: translateY(-2px);
        }

        .template-item h5 {
            color: #0f4c75;
            margin-bottom: 8px;
            font-size: 1.2em;
        }

        .template-item p {
            color: #666;
            margin: 0;
        }

        /* Learn Menu Modal */
        .learn-menu {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .learn-menu.show {
            display: flex;
        }

        .learn-menu-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .learn-menu-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #666;
            line-height: 1;
        }

        .learn-menu-close:hover {
            color: #0f4c75;
        }

        .learn-menu h2 {
            color: #0f4c75;
            margin-bottom: 20px;
        }

        .learn-section {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }

        .learn-section:last-child {
            border-bottom: none;
        }

        .learn-section h3 {
            color: #0f4c75;
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .learn-section ul {
            list-style: none;
            padding-left: 0;
        }

        .learn-section li {
            padding: 8px 0;
            cursor: pointer;
            color: #333;
            transition: color 0.2s;
        }

        .learn-section li:hover {
            color: #0f4c75;
        }

        .learn-section li:before {
            content: "‚Üí ";
            color: #0f4c75;
            font-weight: bold;
        }

        /* Examples Mode Overlay */
        .examples-mode-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.98);
            z-index: 1500;
            display: none;
            overflow-y: auto;
            padding: 40px 20px;
        }

        .examples-mode-overlay.show {
            display: block;
        }

        .examples-mode-overlay h3 {
            color: #0f4c75;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2em;
            margin-top: 50px;
        }

        .examples-close-btn {
            position: fixed !important;
            top: 20px !important;
            right: 20px !important;
            background: #0f4c75 !important;
            color: white !important;
            border: none !important;
            padding: 12px 24px !important;
            border-radius: 6px !important;
            cursor: pointer !important;
            font-weight: 600 !important;
            font-size: 1em !important;
            z-index: 1600 !important;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            transition: all 0.3s ease !important;
        }

        .examples-close-btn:hover {
            background: #3282b8 !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2) !important;
        }

        .example-section {
            margin-bottom: 40px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid #0f4c75;
        }

        .example-section h4 {
            color: #0f4c75;
            margin-bottom: 15px;
        }

        .example-card {
            background: white;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }

        /* Contextual Help Modal */
        .contextual-help-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .contextual-help-modal.show {
            display: flex;
        }

        .contextual-help-content {
            background: white;
            border-radius: 12px;
            padding: 30px;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
        }

        .contextual-help-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 2em;
            cursor: pointer;
            color: #666;
            line-height: 1;
        }

        .contextual-help-close:hover {
            color: #0f4c75;
        }

        .example-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            margin-top: 15px;
        }

        .example-box strong {
            color: #0f4c75;
            display: block;
            margin-bottom: 10px;
        }

        .example-box ul {
            margin-left: 20px;
            margin-top: 10px;
        }

        .example-box li {
            margin-bottom: 8px;
            color: var(--text-secondary);
            line-height: 1.6;
        }
    </style>
    <script src="guide.js"></script>
    <script>
// Strategic Planning Workflow Script

var currentStep = 1;
var totalSteps = 7;
var planData = {
        businessName: '',
        userName: '',
        vision: '',
        values: '',
        mission: '',
        strengths: '',
        weaknesses: '',
        opportunities: '',
        threats: '',
        goals: [],
        currentGoalId: null,
        targetsInitiatives: '',
        kpis: '',
        strategyMap: '',
        marketing: '',
        sales: '',
        operations: '',
        administration: '',
    mindMap: '',
        reviewFrequency: 'quarterly',
        successCriteria: '',
        notes: ''
    };
var userDataBackup = null; // Store user's data when loading sample data

// Authentication has been moved to prototypes_home.html

// Clear all form fields
function clearForm() {
    // Reset planData to initial state
    planData = {
        businessName: '',
        userName: '',
        vision: '',
        values: '',
        mission: '',
        strengths: '',
        weaknesses: '',
        opportunities: '',
        threats: '',
        goals: [],
        currentGoalId: null,
        targetsInitiatives: '',
        kpis: '',
        strategyMap: '',
        marketing: '',
        sales: '',
        operations: '',
        administration: '',
        mindMap: '',
        reviewFrequency: 'quarterly',
        successCriteria: '',
        notes: ''
    };
    
    // Clear all form fields
    populateForm();
    
    // Reset goals UI
    var tabs = document.getElementById('strategyGoalsTabs');
    if (tabs) tabs.innerHTML = '';
    var container = document.getElementById('goalsContainer');
    if (container) container.innerHTML = '';
    ensureAtLeastOneGoal();
    renderGoalTabs();
    renderCurrentGoalForm();
    
    // Update UI
    setupCharacterCounts();
    updateStepCompletion();
}

// Initialize on page load
function init() {
    // Authentication has been moved to prototypes_home.html
    
    // Load any saved data (user-specific if logged in; otherwise guest save)
    loadSavedData();
    updateProgress();
    setupEventListeners();
    setupCharacterCounts();
    setupKeyboardNavigation();
    updateStepCompletion();

    // Step 5 goals: ensure at least one goal exists and render tabs/form.
    ensureAtLeastOneGoal();
    renderGoalTabs();
    renderCurrentGoalForm();

    // If linked in with a step param, jump there
    try {
        var urlParams = new URLSearchParams(window.location.search);
        var stepParam = parseInt(urlParams.get('step'), 10);
        if (stepParam && stepParam >= 1 && stepParam <= totalSteps) {
            goToStep(stepParam);
        }
    } catch (e) { /* ignore */ }

    // Consume cross-tool handoffs (e.g., Action Plan -> Step 5)
    handleIncomingHandoff();
    
    // Save data before page unload (important for iPhone Safari)
    window.addEventListener('beforeunload', function() {
        saveData();
    });
    
    // Also save on page visibility change (when user switches tabs/apps on mobile)
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            saveData();
        }
    });

    // Guided workflow panel (lightweight, in-page)
    try {
        if (window.Guide) {
            window.Guide.addGuidePanel({
                title: 'Guided Workflow',
                steps: [
                    {
                        label: 'Back: Home Progress',
                        cta: 'Home',
                        onClick: function() { window.location.href = 'prototypes_home.html?guide=1'; }
                    },
                    {
                        label: 'Next: Refine a Goal',
                        cta: 'Continue',
                        onClick: function() {
                            window.Guide.startHandoff({ type: 'import_goal_from_strategic_plan' });
                            window.location.href = 'goal_setting_template_prototype.html?guide=1&handoff=1';
                        }
                    }
                ]
            });
        }
    } catch (e) {
        // ignore
    }
}

function handleIncomingHandoff() {
    try {
        var urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('handoff') !== '1') return;

        var handoff = null;
        if (window.Guide && typeof window.Guide.consumeHandoff === 'function') {
            handoff = window.Guide.consumeHandoff();
        } else {
            var raw = sessionStorage.getItem('prototype_handoff');
            if (raw) {
                sessionStorage.removeItem('prototype_handoff');
                handoff = JSON.parse(raw);
            }
        }

        if (!handoff || !handoff.type) return;

        if (handoff.type === 'import_goal_from_action_plan_to_step5' && handoff.goal) {
            importGoalIntoStep5FromActionPlan(handoff.goal);
        }
    } catch (e) {
        // ignore
    }
}

function importGoalIntoStep5FromActionPlan(incoming) {
    if (!incoming) return;

    ensureAtLeastOneGoal();

    var goalText = (incoming.title || '').trim();
    if (!goalText) return;

    // If we have a goalSettingData id, update that existing goal if present; otherwise create new.
    var incomingId = incoming.goalSettingData && incoming.goalSettingData.id ? incoming.goalSettingData.id : null;
    var match = null;
    if (incomingId) {
        match = planData.goals.find(function(g) {
            return g && g.goalSettingData && g.goalSettingData.id === incomingId;
        }) || null;
    }

    var target = match || createNewStrategicGoal();
    target.title = goalText;
    target.goalSettingData = incoming.goalSettingData || target.goalSettingData || null;

    // Carry strategy context back if provided
    target.timeline = incoming.timeline || target.timeline || '';
    target.strategicIntent = incoming.strategicIntent || target.strategicIntent || '';
    target.drivers = incoming.drivers || target.drivers || '';
    target.enablers = incoming.enablers || target.enablers || '';

    if (!match) {
        planData.goals.push(target);
    }

    planData.currentGoalId = target.id;
    renderGoalTabs();
    renderCurrentGoalForm();
    saveData();
    updateStepCompletion();
}

// Goal Setting Modal Functions
var currentGoalInput = null;
var currentGoalItem = null;

function openGoalSettingModal(goalInput, goalItem) {
    currentGoalInput = goalInput;
    currentGoalItem = goalItem;
    var modal = document.getElementById('goalSettingModal');
    var iframe = document.getElementById('goalSettingIframe');
    var currentStrategicGoal = null;
    try { currentStrategicGoal = getCurrentStrategicGoal(); } catch (e) { /* ignore */ }
    
    // Check if there's existing goal text
    var existingGoalText = goalInput.value.trim();
    var goalToLoad = null;
    
    // Prefer the full saved goal object if we already have it on this Step 5 goal
    if (currentStrategicGoal && currentStrategicGoal.goalSettingData) {
        goalToLoad = currentStrategicGoal.goalSettingData;
    }
    
    if (existingGoalText) {
        // Try to find the goal in saved goals library (user-specific)
        try {
            var username = getCurrentUsername();
            var savedGoalsKey = username ? 'goalSetting_savedGoals_' + username : 'goalSetting_savedGoals';
            var savedGoals = JSON.parse(localStorage.getItem(savedGoalsKey) || '[]');
            goalToLoad = savedGoals.find(function(g) {
                return g.goal && g.goal.trim() === existingGoalText;
            });
            
            // If goal found, ensure it has all required fields
            if (goalToLoad) {
                goalToLoad = {
                    id: goalToLoad.id || null,
                    createdAt: goalToLoad.createdAt || null,
                    updatedAt: goalToLoad.updatedAt || null,
                    goal: goalToLoad.goal || existingGoalText,
                    importance: goalToLoad.importance || '',
                    smart: goalToLoad.smart || {
                        specific: false,
                        measurable: false,
                        attainable: false,
                        relevant: false,
                        'time-specific': false
                    },
                    blockers: goalToLoad.blockers || '',
                    actionPlan: goalToLoad.actionPlan || ''
                };
            }
        } catch (e) {
            console.log('Could not load saved goals:', e);
        }
        
        // If goal not found in saved goals, create a basic goal object with just the text
        if (!goalToLoad) {
            goalToLoad = {
                id: null,
                createdAt: null,
                updatedAt: null,
                goal: existingGoalText,
                importance: '',
                smart: {
                    specific: false,
                    measurable: false,
                    attainable: false,
                    relevant: false,
                    'time-specific': false
                },
                blockers: '',
                actionPlan: ''
            };
        }
    }
    
    // Pass goal data via URL parameter
    var url = 'goal_setting_template_prototype.html?modal=true';
    if (goalToLoad) {
        url += '&loadGoal=' + encodeURIComponent(JSON.stringify(goalToLoad));
    }
    
    iframe.src = url;
    modal.classList.add('show');
    
    // Listen for messages from iframe
    window.addEventListener('message', handleGoalSettingMessage);
}

function closeGoalSettingModal(event) {
    if (!event || event.target.id === 'goalSettingModal' || event.target.classList.contains('goal-setting-modal-close')) {
        var modal = document.getElementById('goalSettingModal');
        modal.classList.remove('show');
        window.removeEventListener('message', handleGoalSettingMessage);
        currentGoalInput = null;
        currentGoalItem = null;
    }
}

function handleGoalSettingMessage(event) {
    // Only accept messages from the goal setting template
    if (event.data && event.data.type === 'goalCreated') {
        var goal = event.data.goal;
        if (currentGoalInput && goal) {
            // Only populate the goal name - don't populate other fields
            currentGoalInput.value = goal.goal;

            // Persist full goal details on the current Step 5 goal so reopening restores everything
            try {
                var g = getCurrentStrategicGoal();
                if (g) {
                    g.title = goal.goal;
                    g.goalSettingData = goal;
                }
            } catch (e) { /* ignore */ }
            
            saveData();
            updateStepCompletion();
            renderGoalTabs(); // keep tab label in sync
        }
        closeGoalSettingModal();
    }
}

// ============================
// Step 5: Goals Tabs + Editor
// ============================
function createNewStrategicGoal() {
    return {
        id: Date.now().toString() + Math.random().toString(16).slice(2),
        name: 'Goal ' + ((planData.goals ? planData.goals.length : 0) + 1),
        title: '',
        timeline: '',
        strategicIntent: '',
        drivers: '',
        enablers: ''
    };
}

function ensureAtLeastOneGoal() {
    if (!planData.goals) planData.goals = [];
    if (!planData.goals.length) {
        var g = createNewStrategicGoal();
        planData.goals.push(g);
        planData.currentGoalId = g.id;
    }
    if (!planData.currentGoalId) {
        planData.currentGoalId = planData.goals[0].id;
    }
}

function getCurrentStrategicGoal() {
    ensureAtLeastOneGoal();
    return planData.goals.find(function(g) { return g.id === planData.currentGoalId; }) || planData.goals[0];
}

function syncCurrentGoalFromForm() {
    var goal = getCurrentStrategicGoal();
    if (!goal) return;
    var container = document.getElementById('goalsContainer');
    if (!container) return;
    var title = container.querySelector('.goal-title');
    var timeline = container.querySelector('.goal-timeline');
    var strategicIntent = container.querySelector('.goal-strategic-intent');
    var drivers = container.querySelector('.goal-drivers');
    var enablers = container.querySelector('.goal-enablers');

    goal.title = title ? title.value : '';
    goal.timeline = timeline ? timeline.value : '';
    goal.strategicIntent = strategicIntent ? strategicIntent.value : '';
    goal.drivers = drivers ? drivers.value : '';
    goal.enablers = enablers ? enablers.value : '';
}

function renderGoalTabs() {
    var tabsEl = document.getElementById('strategyGoalsTabs');
    if (!tabsEl) return;
    ensureAtLeastOneGoal();

    tabsEl.innerHTML = '';
    planData.goals.forEach(function(goal) {
        var tab = document.createElement('button');
        tab.type = 'button';
        tab.className = 'goal-tab' + (goal.id === planData.currentGoalId ? ' active' : '');
        tab.setAttribute('data-goal-id', goal.id);

        var label = (goal.title && goal.title.trim()) ? goal.title.trim() : (goal.name || 'Goal');
        tab.textContent = label;

        // Close button (don‚Äôt allow deleting the last goal)
        if (planData.goals.length > 1) {
            var closeBtn = document.createElement('button');
            closeBtn.type = 'button';
            closeBtn.className = 'goal-tab-close';
            closeBtn.setAttribute('aria-label', 'Remove goal');
            closeBtn.textContent = '√ó';
            closeBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                deleteGoal(goal.id);
            });
            tab.appendChild(closeBtn);
        }

        tab.addEventListener('click', function() {
            selectGoal(goal.id);
        });

        tabsEl.appendChild(tab);
    });
}

function renderCurrentGoalForm() {
    var container = document.getElementById('goalsContainer');
    if (!container) return;
    ensureAtLeastOneGoal();

    var goal = getCurrentStrategicGoal();
    container.innerHTML =
        '<div class="goal-item">' +
        '  <div class="form-group">' +
        '    <label>Goal <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>' +
        '    <p class="field-help">Set goals for different time horizons: 6 Month, 1 Year, 10 Year, etc. What do you want to achieve in each timeframe?</p>' +
        '    <input type="text" class="goal-title" placeholder="Enter a strategic goal..." value="' + escapeHtml(goal.title || '') + '">' +
        '  </div>' +
        '  <div class="form-group">' +
        '    <label>Time Horizon <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>' +
        '    <p class="field-help">Select the timeframe for achieving this goal. Different goals may have different time horizons - some are short-term (6 months), others are long-term (10 years).</p>' +
        '    <select class="goal-timeline">' +
        '      <option value="">Select timeframe...</option>' +
        '      <option value="6-month"' + (goal.timeline === '6-month' ? ' selected' : '') + '>6 Months</option>' +
        '      <option value="1-year"' + (goal.timeline === '1-year' ? ' selected' : '') + '>1 Year</option>' +
        '      <option value="3-year"' + (goal.timeline === '3-year' ? ' selected' : '') + '>3 Years</option>' +
        '      <option value="5-year"' + (goal.timeline === '5-year' ? ' selected' : '') + '>5 Years</option>' +
        '      <option value="10-year"' + (goal.timeline === '10-year' ? ' selected' : '') + '>10 Years</option>' +
        '    </select>' +
        '  </div>' +
        '  <div class="form-group">' +
        '    <label>Strategic Intent <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>' +
        '    <p class="field-help">How will you get there? Refer to your SWOT analysis when formulating this.</p>' +
        '    <textarea class="goal-strategic-intent" placeholder="Describe how you will achieve this goal...">' + escapeHtml(goal.strategicIntent || '') + '</textarea>' +
        '  </div>' +
        '  <div class="form-group">' +
        '    <label>Drivers (Elephant Projects) <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>' +
        '    <p class="field-help">What will you focus on? These are your major initiatives or "elephant projects" that drive progress.</p>' +
        '    <textarea class="goal-drivers" placeholder="List the key focus areas or major projects...">' + escapeHtml(goal.drivers || '') + '</textarea>' +
        '  </div>' +
        '  <div class="form-group">' +
        '    <label>Enablers <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label>' +
        '    <p class="field-help">What frameworks, resources, and skills will you use? What capabilities do you need to develop?</p>' +
        '    <textarea class="goal-enablers" placeholder="List frameworks, resources, and skills needed...">' + escapeHtml(goal.enablers || '') + '</textarea>' +
        '  </div>' +
        '</div>';

    // Make goal title click open the Goal Setting Template (same UX as before)
    var goalTitleInput = container.querySelector('.goal-title');
    if (goalTitleInput) {
        goalTitleInput.readOnly = true;
        goalTitleInput.style.cursor = 'pointer';
        goalTitleInput.title = 'Click to create goal using Goal Setting Template';
        goalTitleInput.addEventListener('click', function(e) {
            openGoalSettingModal(e.target, e.target.closest('.goal-item'));
        });
    }

    // Bind save behavior for the dynamic form
    var inputs = container.querySelectorAll('input, textarea, select');
    inputs.forEach(function(el) {
        el.addEventListener('input', function() {
            syncCurrentGoalFromForm();
            renderGoalTabs();
            saveData();
            updateStepCompletion();
        });
        el.addEventListener('change', function() {
            syncCurrentGoalFromForm();
            renderGoalTabs();
            saveData();
            updateStepCompletion();
        });
    });
}

function selectGoal(goalId) {
    syncCurrentGoalFromForm();
    planData.currentGoalId = goalId;
    renderGoalTabs();
    renderCurrentGoalForm();
    saveData();
}

function addGoal() {
    syncCurrentGoalFromForm();
    var newGoal = createNewStrategicGoal();
    planData.goals.push(newGoal);
    planData.currentGoalId = newGoal.id;
    renderGoalTabs();
    renderCurrentGoalForm();
    saveData();
    updateStepCompletion();
    // Scroll into view for better UX
    var tabsEl = document.getElementById('strategyGoalsTabs');
    if (tabsEl) tabsEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function deleteGoal(goalId) {
    if (!planData.goals || planData.goals.length <= 1) return;
    syncCurrentGoalFromForm();
    planData.goals = planData.goals.filter(function(g) { return g.id !== goalId; });
    if (!planData.goals.length) {
        ensureAtLeastOneGoal();
    }
    if (!planData.goals.find(function(g) { return g.id === planData.currentGoalId; })) {
        planData.currentGoalId = planData.goals[0].id;
    }
    renderGoalTabs();
    renderCurrentGoalForm();
    saveData();
    updateStepCompletion();
}

// Send the currently selected Step 5 goal into Strategic Action Plan and auto-create a goal there
function openCurrentGoalInActionPlan() {
    // Make sure planData reflects the latest UI edits
    syncCurrentGoalFromForm();

    var goal = getCurrentStrategicGoal();
    if (!goal) return;

    if (!goal.title || !String(goal.title).trim()) {
        alert('Please create/select a goal first (click the Goal field to create it), then try again.');
        return;
    }

    // Build a lightweight payload for the Action Plan
    var payload = {
        title: goal.title || '',
        timeline: goal.timeline || '',
        strategicIntent: goal.strategicIntent || '',
        drivers: goal.drivers || '',
        enablers: goal.enablers || '',
        goalSettingData: goal.goalSettingData || null
    };

    if (window.Guide && typeof window.Guide.startHandoff === 'function') {
        window.Guide.startHandoff({
            type: 'import_goal_from_strategic_plan_step5',
            goal: payload
        });
    } else {
        // Fallback (shouldn't happen because guide.js is loaded)
        try {
            sessionStorage.setItem('prototype_handoff', JSON.stringify({
                type: 'import_goal_from_strategic_plan_step5',
                goal: payload,
                ts: new Date().toISOString()
            }));
        } catch (e) {
            // ignore
        }
    }

    // Navigate to the Strategic Action Plan; it will consume the handoff and auto-create a goal
    window.location.href = 'strategic_action_plan_prototype.html?handoff=1';
}

// Setup event listeners for auto-save
function setupEventListeners() {
    var inputs = document.querySelectorAll('input, textarea, select');
    for (var i = 0; i < inputs.length; i++) {
        inputs[i].addEventListener('input', function() {
            saveData();
            updateCharacterCount(this);
            updateStepCompletion();
        });
        inputs[i].addEventListener('change', function() {
            saveData();
            updateStepCompletion();
        });
    }
    
    // Add click handlers for goal title inputs
    var goalTitles = document.querySelectorAll('.goal-title');
    for (var j = 0; j < goalTitles.length; j++) {
        goalTitles[j].addEventListener('click', function(e) {
            var goalItem = e.target.closest('.goal-item');
            openGoalSettingModal(e.target, goalItem);
        });
        goalTitles[j].readOnly = true;
        goalTitles[j].style.cursor = 'pointer';
        goalTitles[j].title = 'Click to create goal using Goal Setting Template';
    }
}

// Setup character counts
function setupCharacterCounts() {
    var elements = document.querySelectorAll('[data-char-count]');
    for (var i = 0; i < elements.length; i++) {
        updateCharacterCount(elements[i]);
    }
}

// Update character count for a textarea or input
function updateCharacterCount(element) {
    var countEl = null;
    if (element.id) {
        countEl = document.getElementById(element.id + '-count');
    } else {
        // Handle class-based elements
        var className = element.className.split(' ')[0];
        if (className === 'proponent-marketing') {
            countEl = document.getElementById('marketing-count');
        } else if (className === 'proponent-sales') {
            countEl = document.getElementById('sales-count');
        } else if (className === 'proponent-operations') {
            countEl = document.getElementById('operations-count');
        } else if (className === 'proponent-administration') {
            countEl = document.getElementById('administration-count');
        }
    }
    if (countEl) {
        var count = element.value.length;
        countEl.textContent = count + ' characters';
    }
}

// Setup keyboard navigation
function setupKeyboardNavigation() {
    document.addEventListener('keydown', function(e) {
        // Only navigate if not typing in an input
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
            return;
        }
        
        if (e.key === 'ArrowRight' && currentStep < totalSteps) {
            nextStep();
        } else if (e.key === 'ArrowLeft' && currentStep > 1) {
            prevStep();
        }
    });
}

// Check if storage is available (handles iPhone Safari private browsing)
function isStorageAvailable(type) {
    try {
        var storage = window[type];
        var x = '__storage_test__';
        storage.setItem(x, x);
        storage.removeItem(x);
        return true;
    } catch (e) {
        return false;
    }
}

// Get current username from session
function getCurrentUsername() {
    try {
        var session = sessionStorage.getItem('prototype_userSession');
        if (session) {
            var sessionData = JSON.parse(session);
            return (sessionData && sessionData.user && sessionData.user.username) || sessionData.username || null;
        }
    } catch (e) {
        console.log('Could not get username from session');
    }
    return null;
}

// Save data to localStorage with iPhone Safari compatibility (user-specific or guest)
function saveData() {
    // If we're in the middle of a logout/reset flow, don't overwrite saved data with blanks
    if (window.__suppressStrategicPlanAutosave) return;

    var username = getCurrentUsername();
    // Save step 1 data (Purpose)
    planData.businessName = document.getElementById('business-name') ? document.getElementById('business-name').value : '';
    planData.userName = document.getElementById('user-name') ? document.getElementById('user-name').value : '';
    planData.vision = document.getElementById('vision') ? document.getElementById('vision').value : '';
    planData.values = document.getElementById('values') ? document.getElementById('values').value : '';
    planData.mission = document.getElementById('mission') ? document.getElementById('mission').value : '';
    
    // Save step 2 data is educational only, no data to save
    
    // Save step 3 data (Mind Map - Proponents)
    var marketingEl = document.querySelector('.proponent-marketing');
    planData.marketing = marketingEl ? marketingEl.value : '';
    var salesEl = document.querySelector('.proponent-sales');
    planData.sales = salesEl ? salesEl.value : '';
    var operationsEl = document.querySelector('.proponent-operations');
    planData.operations = operationsEl ? operationsEl.value : '';
    var administrationEl = document.querySelector('.proponent-administration');
    planData.administration = administrationEl ? administrationEl.value : '';
    
    // Save step 4 data (SWOT)
    planData.strengths = document.getElementById('strengths') ? document.getElementById('strengths').value : '';
    planData.weaknesses = document.getElementById('weaknesses') ? document.getElementById('weaknesses').value : '';
    planData.opportunities = document.getElementById('opportunities') ? document.getElementById('opportunities').value : '';
    planData.threats = document.getElementById('threats') ? document.getElementById('threats').value : '';
    
    // Save step 5 data (Strategy - Goals)
    saveGoals();
    
    // Save step 6 data (Execution)
    planData.targetsInitiatives = document.getElementById('targets-initiatives') ? document.getElementById('targets-initiatives').value : '';
    planData.kpis = document.getElementById('kpis') ? document.getElementById('kpis').value : '';
    planData.strategyMap = document.getElementById('strategy-map') ? document.getElementById('strategy-map').value : '';
    
    // Save step 7 data (Review)
    planData.reviewFrequency = document.getElementById('review-frequency') ? document.getElementById('review-frequency').value : 'quarterly';
    planData.successCriteria = document.getElementById('success-criteria') ? document.getElementById('success-criteria').value : '';
    planData.notes = document.getElementById('notes') ? document.getElementById('notes').value : '';
    
    // Stamp last-saved time so we can reliably choose the newest save (guest vs user)
    planData._lastSavedISO = new Date().toISOString();

    // Save to user-specific key (and always keep a guest backup)
    var dataString = JSON.stringify(planData);
    var saved = false;
    var userKey = username ? ('prototype_strategicPlan_' + username) : null;
    var guestKey = 'prototype_strategicPlan';
    
    if (isStorageAvailable('localStorage')) {
    try {
            // Always write guest backup
            localStorage.setItem(guestKey, dataString);
            saved = true;

            // Also write to user key if logged in
            if (userKey) {
                localStorage.setItem(userKey, dataString);
            }
    } catch (e) {
            console.log('localStorage setItem failed');
        }
    } else {
        // Surface this (once) because without localStorage nothing will persist after closing the browser.
        try {
            if (!window.__warnedNoLocalStorage) {
                window.__warnedNoLocalStorage = true;
                alert('Local saving is blocked in this browser/session (localStorage unavailable). Try disabling Private/Incognito mode or opening the app via http(s) instead of a local file.');
            }
        } catch (e) { /* ignore */ }
    }
    
    if (saved) {
        showSaveIndicator();
    }
}

// Show save indicator
function showSaveIndicator() {
    var indicator = document.getElementById('saveIndicator');
    if (indicator) {
        indicator.classList.add('show');
        setTimeout(function() {
            indicator.classList.remove('show');
        }, 2000);
    }
}

// Load saved data from localStorage (user-specific ONLY - no guest fallback)
function loadSavedData() {
    var username = getCurrentUsername();

    // ONLY load data if user is logged in - never load guest data
    if (!username) {
        console.log('No user logged in - starting with blank form');
        return;
    }
    
    var saved = null;
    var userKey = 'prototype_strategicPlan_' + username;
    
    if (isStorageAvailable('localStorage')) {
        try {
            saved = localStorage.getItem(userKey);
        } catch (e) {
            console.log('localStorage getItem failed');
        }
    }
    
        if (saved) {
        try {
            planData = JSON.parse(saved);
            populateForm();
            console.log('Loaded user-specific data for:', username);
    } catch (e) {
            console.log('Could not parse saved data for user:', username);
        }
    } else {
        console.log('No saved data found for user:', username);
    }
}

// Populate form with saved data
function populateForm() {
    if (document.getElementById('business-name')) document.getElementById('business-name').value = planData.businessName || '';
    if (document.getElementById('user-name')) document.getElementById('user-name').value = planData.userName || '';
    if (document.getElementById('vision')) document.getElementById('vision').value = planData.vision || '';
    if (document.getElementById('values')) document.getElementById('values').value = planData.values || '';
    if (document.getElementById('mission')) document.getElementById('mission').value = planData.mission || '';
    if (document.getElementById('strengths')) document.getElementById('strengths').value = planData.strengths || '';
    if (document.getElementById('weaknesses')) document.getElementById('weaknesses').value = planData.weaknesses || '';
    if (document.getElementById('opportunities')) document.getElementById('opportunities').value = planData.opportunities || '';
    if (document.getElementById('threats')) document.getElementById('threats').value = planData.threats || '';
    if (document.getElementById('targets-initiatives')) document.getElementById('targets-initiatives').value = planData.targetsInitiatives || '';
    if (document.getElementById('kpis')) document.getElementById('kpis').value = planData.kpis || '';
    if (document.getElementById('strategy-map')) document.getElementById('strategy-map').value = planData.strategyMap || '';
    if (document.getElementById('review-frequency')) document.getElementById('review-frequency').value = planData.reviewFrequency || 'quarterly';
    if (document.getElementById('success-criteria')) document.getElementById('success-criteria').value = planData.successCriteria || '';
    if (document.getElementById('notes')) document.getElementById('notes').value = planData.notes || '';
    
    var marketingEl = document.querySelector('.proponent-marketing');
    if (marketingEl) marketingEl.value = planData.marketing || '';
    var salesEl = document.querySelector('.proponent-sales');
    if (salesEl) salesEl.value = planData.sales || '';
    var operationsEl = document.querySelector('.proponent-operations');
    if (operationsEl) operationsEl.value = planData.operations || '';
    var administrationEl = document.querySelector('.proponent-administration');
    if (administrationEl) administrationEl.value = planData.administration || '';
    
    loadGoals();
    setupCharacterCounts();
    updateStepCompletion();
}

// Navigate to next step
function nextStep() {
    if (currentStep < totalSteps) {
        hideStep(currentStep);
        currentStep++;
        showStep(currentStep);
        updateProgress();
        saveData();
        // Scroll to top of step
        window.scrollTo(0, 0);
    }
}

// Navigate to previous step
function prevStep() {
    if (currentStep > 1) {
        hideStep(currentStep);
        currentStep--;
        showStep(currentStep);
        updateProgress();
        saveData();
        // Scroll to top of step
        window.scrollTo(0, 0);
    }
}

// Show step
function showStep(step) {
    var stepElement = document.getElementById('step' + step);
    if (stepElement) {
        stepElement.classList.add('active');
    }
}

// Hide step
function hideStep(step) {
    var stepElement = document.getElementById('step' + step);
    if (stepElement) {
        stepElement.classList.remove('active');
    }
}

// Update progress bar
function updateProgress() {
    var progressFill = document.getElementById('progressFill');
    var progressText = document.getElementById('progressText');
    var percentage = (currentStep / totalSteps) * 100;
    
    if (progressFill) {
        progressFill.style.width = percentage + '%';
    }
    
    if (progressText) {
        progressText.textContent = 'Step ' + currentStep + ' of ' + totalSteps;
    }
    
    // Update step navigation dots
    updateStepDots();
}

// Update step navigation dots
function updateStepDots() {
    var dots = document.querySelectorAll('.step-dot');
    for (var i = 0; i < dots.length; i++) {
        var stepNum = parseInt(dots[i].getAttribute('data-step'));
        dots[i].classList.remove('active', 'complete');
        
        if (stepNum === currentStep) {
            dots[i].classList.add('active');
        } else if (stepNum < currentStep || isStepComplete(stepNum)) {
            dots[i].classList.add('complete');
        }
    }
}

// Check if a step is complete
function isStepComplete(step) {
    switch(step) {
        case 1:
            var businessName = document.getElementById('business-name');
            var userName = document.getElementById('user-name');
            var vision = document.getElementById('vision');
            var values = document.getElementById('values');
            var mission = document.getElementById('mission');
            return (businessName && businessName.value.trim()) || (userName && userName.value.trim()) || 
                   (vision && vision.value.trim()) || (values && values.value.trim()) || (mission && mission.value.trim());
        case 2:
            return true; // Educational step, always complete
        case 3:
            var marketing = document.querySelector('.proponent-marketing');
            var sales = document.querySelector('.proponent-sales');
            var operations = document.querySelector('.proponent-operations');
            var administration = document.querySelector('.proponent-administration');
            return (marketing && marketing.value.trim()) || (sales && sales.value.trim()) || 
                   (operations && operations.value.trim()) || (administration && administration.value.trim());
        case 4:
            var strengths = document.getElementById('strengths');
            var weaknesses = document.getElementById('weaknesses');
            var opportunities = document.getElementById('opportunities');
            var threats = document.getElementById('threats');
            return (strengths && strengths.value.trim()) || (weaknesses && weaknesses.value.trim()) || 
                   (opportunities && opportunities.value.trim()) || (threats && threats.value.trim());
        case 5:
            return !!(planData.goals && planData.goals.some(function(g) { return g && g.title && String(g.title).trim(); }));
        case 6:
            var targets = document.getElementById('targets-initiatives');
            var kpis = document.getElementById('kpis');
            var strategyMap = document.getElementById('strategy-map');
            return (targets && targets.value.trim()) || (kpis && kpis.value.trim()) || (strategyMap && strategyMap.value.trim());
        case 7:
            var successCriteria = document.getElementById('success-criteria');
            return successCriteria && successCriteria.value.trim();
        default:
            return false;
    }
}

// Update step completion indicators
function updateStepCompletion() {
    for (var i = 1; i <= totalSteps; i++) {
        var indicator = document.getElementById('step' + i + 'Complete');
        if (indicator) {
            if (isStepComplete(i)) {
                indicator.classList.add('show');
            } else {
                indicator.classList.remove('show');
            }
        }
    }
    updateStepDots();
}

// Go to specific step
function goToStep(step) {
    if (step >= 1 && step <= totalSteps) {
        hideStep(currentStep);
        currentStep = step;
        showStep(currentStep);
        updateProgress();
        window.scrollTo(0, 0);
    }
}

// Toggle education section
function toggleEducation(button) {
    var educationBox = button.closest('.education-box');
    if (educationBox) {
        educationBox.classList.toggle('collapsed');
        button.textContent = educationBox.classList.contains('collapsed') ? '+' : '‚àí';
    }
}

function toggleVideoSection(header) {
    const videoSection = header.closest('.video-link-section');
    if (videoSection) {
        videoSection.classList.toggle('collapsed');
        const toggleBtn = header.querySelector('.video-toggle-btn');
        if (toggleBtn) {
            toggleBtn.textContent = videoSection.classList.contains('collapsed') ? '+' : '‚àí';
        }
    }
}

// Toggle help text
function toggleHelp(button) {
    var label = button.closest('label');
    if (label) {
        var helpText = label.nextElementSibling;
        if (helpText && helpText.classList.contains('field-help')) {
            helpText.classList.toggle('hidden');
        }
    }
}

// Show SMART goal info popup
function showSMARTGoalInfo() {
    var popup = document.getElementById('proponentPopup');
    var title = document.getElementById('popupTitle');
    var content = document.getElementById('popupContent');
    
    if (!popup || !title || !content) return;
    
    title.textContent = 'Why SMART Goals Matter';
    content.innerHTML = '<div class="proponent-note"><strong>Before working on any goal, ensure it meets all required SMART criteria (Specific, Measurable, Attainable, Relevant). Time-specific is optional.</strong></div>' +
        '<p><strong>The Importance of Complete SMART Goals:</strong></p>' +
        '<p>Research consistently shows that goals meeting all SMART criteria are significantly more likely to be achieved. Incomplete goals lead to:</p>' +
        '<ul style="margin-left: 20px; margin-top: 10px;">' +
        '<li><strong>Wasted Resources:</strong> Working on vague or unrealistic goals wastes time, money, and effort</li>' +
        '<li><strong>Lack of Direction:</strong> Without specificity and measurability, you can\'t track progress or know when you\'ve succeeded</li>' +
        '<li><strong>Reduced Motivation:</strong> Unattainable or irrelevant goals lead to frustration and abandonment</li>' +
        '<li><strong>Poor Planning:</strong> Without clear criteria, you can\'t properly allocate resources or create effective action plans</li>' +
        '</ul>' +
        '<p style="margin-top: 15px;"><strong>Each SMART Criterion Serves a Critical Purpose:</strong></p>' +
        '<ul style="margin-left: 20px; margin-top: 10px;">' +
        '<li><strong>Specific:</strong> Eliminates ambiguity and ensures everyone understands exactly what needs to be achieved</li>' +
        '<li><strong>Measurable:</strong> Enables progress tracking, accountability, and objective evaluation of success</li>' +
        '<li><strong>Attainable:</strong> Ensures goals are realistic given your current resources, skills, and constraints</li>' +
        '<li><strong>Relevant:</strong> Aligns goals with your vision and strategic priorities, ensuring effort is focused on what truly matters</li>' +
        '</ul>' +
        '<div style="background: #e7f3ff; border-left: 4px solid #0f4c75; padding: 15px; margin: 20px 0; border-radius: 6px;">' +
        '<p style="margin: 0 0 10px 0; font-weight: 600; color: #0f4c75; font-size: 1.1em;">‚è∞ Why Time-Specific is Optional</p>' +
        '<p style="margin: 0; line-height: 1.7; color: #333;">For small business owners and entrepreneurs, not all goals need to be time-bound‚Äîespecially when you\'re first getting started. Early-stage businesses often require flexibility to adapt to changing market conditions, unexpected opportunities, and the organic growth of your venture.</p>' +
        '<p style="margin: 10px 0 0 0; line-height: 1.7; color: #333;">Time-specific goals become increasingly important as your business grows and you have employees to manage and coordinate. Deadlines help create accountability, enable resource planning, and ensure team alignment. However, when you\'re the sole decision-maker or working with a small team, allowing goals to evolve naturally can be more valuable than forcing artificial deadlines.</p>' +
        '<p style="margin: 10px 0 0 0; line-height: 1.7; color: #333;"><strong>Consider making your goal time-specific if:</strong> You have team members who need clear deadlines, you\'re coordinating multiple projects, or you\'re working toward a specific milestone or event. Otherwise, focus on ensuring your goal is Specific, Measurable, Attainable, and Relevant‚Äîthese four criteria are the foundation of effective goal-setting.</p>' +
        '</div>' +
        '<p style="margin-top: 15px;"><strong>Best Practice:</strong> Use the Goal Setting Template (click on any goal field) to refine your goals and ensure they meet all required SMART criteria before proceeding with strategic planning. This upfront investment in goal quality pays dividends in execution success.</p>';
    
    popup.classList.add('show');
}

// Show proponent popup
function showProponentPopup(proponent) {
    var popup = document.getElementById('proponentPopup');
    var title = document.getElementById('popupTitle');
    var content = document.getElementById('popupContent');
    
    if (!popup || !title || !content) return;
    
    var proponentData = {
        marketing: {
            title: 'Marketing',
            principle: 'DO NOT OVER COMPLICATE. OUTSOURCE IF YOU NEED TO',
            description: 'Get and keep attention. Get brand in front of customers 8 times. Lead generation. Convert to sales team. Marketing includes things like branding, advertising, market research, email/social media outreach.'
        },
        sales: {
            title: 'Sales',
            principle: 'DO NOT COMPETE ON PRICE. COMPETE ON QUALITY!',
            description: 'Qualify customers before interacting. Follow up. Outreach. Build relationships. Do not try to get the sale on first call. The main purpose of Sales is to convert leads into customers. Bring money in.'
        },
        operations: {
            title: 'Operations',
            principle: 'TAKE TIME TO MAKE SURE OPERATIONS IS EFFICIENT',
            description: 'Responsible for delivering product or service to customers. Operations should be ready to react to changes in the market. Don\'t be afraid to outsource parts of operations.'
        },
        administration: {
            title: 'Administration',
            principle: 'If YOU WERE ABSENT COULD THE BUSINESS RUN ITSELF? COULD IT SCALE WITHOUT YOU?',
            description: 'Administration is anything in back end of business that isn\'t Marketing, Sales, or Operations. Examples are Accounting, I.T., H.R., Payroll, etc. Your job is to sit at the top of Administration strategizing and deciding where the business needs to go. You must lay out a strategic plan and communicate it to the team, so they can carry it out. You must create a system that will operate and even grow without you present. Never micromanage, communicate the plan, and trust your team to carry it out.'
        }
    };
    
    var data = proponentData[proponent];
    if (data) {
        title.textContent = data.title;
        content.innerHTML = '<p class="proponent-note"><strong>Principle:</strong> ' + escapeHtml(data.principle) + '</p>' +
                           '<p>' + escapeHtml(data.description) + '</p>';
        popup.classList.add('show');
    }
}

// Close proponent popup
function closeProponentPopup(event) {
    if (event) {
        event.stopPropagation();
    }
    var popup = document.getElementById('proponentPopup');
    if (popup) {
        popup.classList.remove('show');
    }
}

// Add goal (legacy - replaced by tabbed goals earlier in this file)
function addGoalLegacy() {
    var container = document.getElementById('goalsContainer');
    if (!container) return;
    
    var goalDiv = document.createElement('div');
    goalDiv.className = 'goal-item';
    goalDiv.innerHTML = '<div class="form-group"><label>Goal <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label><p class="field-help">Set goals for different time horizons: 6 Month, 1 Year, 10 Year, etc. What do you want to achieve in each timeframe?</p><input type="text" class="goal-title" placeholder="Enter a strategic goal..."></div>' +
        '<div class="form-group"><label>Time Horizon <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label><p class="field-help">Select the timeframe for achieving this goal. Different goals may have different time horizons - some are short-term (6 months), others are long-term (10 years).</p><select class="goal-timeline"><option value="">Select timeframe...</option><option value="6-month">6 Months</option><option value="1-year">1 Year</option><option value="3-year">3 Years</option><option value="5-year">5 Years</option><option value="10-year">10 Years</option></select></div>' +
        '<div class="form-group"><label>Strategic Intent <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label><p class="field-help">How will you get there? Refer to your SWOT analysis when formulating this.</p><textarea class="goal-strategic-intent" placeholder="Describe how you will achieve this goal..."></textarea></div>' +
        '<div class="form-group"><label>Drivers (Elephant Projects) <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label><p class="field-help">What will you focus on? These are your major initiatives or "elephant projects" that drive progress.</p><textarea class="goal-drivers" placeholder="List the key focus areas or major projects..."></textarea></div>' +
        '<div class="form-group"><label>Enablers <button class="help-toggle" onclick="toggleHelp(this)" aria-label="Toggle help">?</button></label><p class="field-help">What frameworks, resources, and skills will you use? What capabilities do you need to develop?</p><textarea class="goal-enablers" placeholder="List frameworks, resources, and skills needed..."></textarea></div>' +
        '<button class="btn-remove" onclick="removeGoal(this)" style="background: #dc3545; color: white; padding: 8px 15px; border: none; border-radius: 4px; cursor: pointer; margin-top: 10px;">Remove</button>';
    
    container.appendChild(goalDiv);
    setupEventListeners();
    updateStepCompletion();
}

// Remove goal (legacy - replaced by tabbed goals earlier in this file)
function removeGoalLegacy(button) {
    var goalItem = button.parentElement;
    goalItem.parentElement.removeChild(goalItem);
    saveGoals();
}

// Save goals
function saveGoals() {
    // With tabs, we keep goals in planData and just sync the active one from the form.
    ensureAtLeastOneGoal();
    syncCurrentGoalFromForm();
    // Backwards compat for old saves/templates that didn't include ids/names
    if (planData.goals && planData.goals.length) {
        planData.goals.forEach(function(g, idx) {
            if (!g.id) g.id = Date.now().toString() + idx + Math.random().toString(16).slice(2);
            if (!g.name) g.name = 'Goal ' + (idx + 1);
        });
        if (!planData.currentGoalId) planData.currentGoalId = planData.goals[0].id;
    }
}

// Load goals
function loadGoals() {
    ensureAtLeastOneGoal();
    // Backwards compat: add ids/names if missing (older saves/templates)
    if (planData.goals && planData.goals.length) {
        planData.goals.forEach(function(g, idx) {
            if (!g.id) g.id = Date.now().toString() + idx + Math.random().toString(16).slice(2);
            if (!g.name) g.name = 'Goal ' + (idx + 1);
        });
    }
    if (!planData.currentGoalId) planData.currentGoalId = planData.goals[0].id;
    renderGoalTabs();
    renderCurrentGoalForm();
    updateStepCompletion();
}

// Escape HTML to prevent XSS
function escapeHtml(text) {
    if (!text) return '';
    var map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
    };
    return text.replace(/[&<>"']/g, function(m) { return map[m]; });
}

// Show export options
function showExportOptions() {
    var dropdown = document.getElementById('exportDropdown');
    if (dropdown) {
        dropdown.classList.toggle('show');
    }
}

// Close export dropdown when clicking outside
document.addEventListener('click', function(event) {
    var dropdown = document.getElementById('exportDropdown');
    var exportBtn = event.target.closest('.btn-export');
    if (dropdown && !dropdown.contains(event.target) && !exportBtn) {
        dropdown.classList.remove('show');
    }
});

// Check if device is mobile
function isMobileDevice() {
    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
}

// Check if Web Share API is available
function isWebShareAvailable() {
    return navigator.share && navigator.canShare;
}

// Export plan with mobile support
function exportPlan(format) {
    saveData();
    
    // Close dropdown
    var dropdown = document.getElementById('exportDropdown');
    if (dropdown) {
        dropdown.classList.remove('show');
    }
    
    var filename = 'Strategic_Plan_' + new Date().toISOString().split('T')[0];
    var blob, mimeType, extension, content;
    
    if (format === 'docx') {
        content = generateWordDocument();
        // Create HTML that Word can open
        blob = new Blob([content], { type: 'application/msword' });
        mimeType = 'application/msword';
        extension = '.doc';
        filename += extension;
    } else if (format === 'xlsx') {
        content = generateExcelDocument();
        // Create HTML that Excel can open
        blob = new Blob([content], { type: 'application/vnd.ms-excel' });
        mimeType = 'application/vnd.ms-excel';
        extension = '.xls';
        filename += extension;
    } else {
        content = generatePlanDocument();
        blob = new Blob([content], { type: 'text/plain' });
        mimeType = 'text/plain';
        extension = '.txt';
        filename += extension;
    }
    
    // For text files on mobile, always show options (better for iPhone)
    if (isMobileDevice() && format === 'txt') {
        shareFileMobileFallback(blob, filename, mimeType, content);
    } else if (isMobileDevice() && isWebShareAvailable()) {
        // Use Web Share API for mobile devices if available
        shareFileMobile(blob, filename, mimeType);
    } else if (isMobileDevice()) {
        // Fallback for mobile devices without Web Share API
        shareFileMobileFallback(blob, filename, mimeType, content);
    } else {
        // Standard download for desktop
        downloadFile(blob, filename);
    }
}

// ============================
// Import from Word Export (.doc/.docx produced by this app)
// NOTE: Our "Word export" is HTML saved with a .doc extension for Word compatibility.
// This import supports files created by the export button above (not arbitrary Word DOCX zips).
// ============================
function triggerImportWordExport() {
    // Close dropdown
    var dropdown = document.getElementById('exportDropdown');
    if (dropdown) dropdown.classList.remove('show');

    var input = document.getElementById('importWordExportInput');
    if (!input) return;
    input.value = '';
    input.click();
}

// Hook up import input change (safe if element exists)
try {
    var __importInput = document.getElementById('importWordExportInput');
    if (__importInput) {
        __importInput.addEventListener('change', function(e) {
            var file = e.target.files && e.target.files[0];
            if (file) importStrategicPlanFromWordExport(file);
        });
    }
} catch (e) { /* ignore */ }

function importStrategicPlanFromWordExport(file) {
    if (!file) return;
    if (!confirm('This will replace your current Strategic Plan form with the contents of the uploaded export. Continue?')) {
        return;
    }

    var reader = new FileReader();
    reader.onerror = function() {
        alert('Could not read the file. Please try again.');
    };
    reader.onload = function() {
        try {
            var buf = reader.result;
            var bytes = new Uint8Array(buf);
            // Detect real DOCX zip (PK..). We cannot parse zipped OOXML without a library.
            if (bytes && bytes.length >= 2 && bytes[0] === 0x50 && bytes[1] === 0x4B) {
                alert('That looks like a standard Word .docx (zipped) file. This importer supports the Word export generated by this app (HTML in a .doc/.docx). Please upload the file you downloaded from the Export button in this app.');
                return;
            }

            var text = new TextDecoder('utf-8', { fatal: false }).decode(bytes);
            // Basic sanity check that it's our exported HTML
            if (text.indexOf('class=\"section-title\"') === -1 || text.indexOf('STRATEGIC PLAN') === -1) {
                alert('This file does not look like a Strategic Plan export from this app. Please export using "Export as Word" and upload that file.');
                return;
            }

            var imported = parseStrategicPlanFromExportHtml(text);
            if (!imported) {
                alert('Could not parse the uploaded export. Please try re-exporting and importing again.');
                return;
            }

            // Apply imported data safely
            window.__suppressStrategicPlanAutosave = true;
            planData = imported;
            populateForm();
            renderGoalTabs();
            renderCurrentGoalForm();
            window.__suppressStrategicPlanAutosave = false;
            saveData();
            goToStep(1);
            alert('‚úÖ Imported your Strategic Plan from the Word export.');
        } catch (err) {
            console.error(err);
            try { window.__suppressStrategicPlanAutosave = false; } catch (e) { /* ignore */ }
            alert('Import failed. Please try again with a fresh export from this app.');
        }
    };
    reader.readAsArrayBuffer(file);
}

function parseStrategicPlanFromExportHtml(htmlText) {
    var doc;
    try {
        doc = new DOMParser().parseFromString(htmlText, 'text/html');
    } catch (e) {
        return null;
    }
    if (!doc) return null;

    function norm(s) {
        if (!s) return '';
        return String(s)
            .replace(/\r\n/g, '\n')
            .replace(/\r/g, '\n')
            .replace(/[ \t]+\n/g, '\n')
            .replace(/\n{3,}/g, '\n\n')
            .trim();
    }

    function textOf(el) {
        if (!el) return '';
        // innerText preserves line breaks from <p>/<br> reasonably well.
        return norm(el.innerText || el.textContent || '');
    }

    function findSection(title) {
        var titles = doc.querySelectorAll('.section-title');
        for (var i = 0; i < titles.length; i++) {
            var t = norm(titles[i].textContent || '');
            if (t.toUpperCase() === title.toUpperCase()) {
                return titles[i].closest('.section');
            }
        }
        return null;
    }

    function getSubsectionContent(sectionEl, subsectionTitle) {
        if (!sectionEl) return '';
        var subs = sectionEl.querySelectorAll('.subsection');
        for (var i = 0; i < subs.length; i++) {
            var h = subs[i].querySelector('.subsection-title');
            if (!h) continue;
            if (norm(h.textContent || '').toUpperCase() === subsectionTitle.toUpperCase()) {
                var c = subs[i].querySelector('.content');
                return textOf(c);
            }
        }
        return '';
    }

    // Header
    var businessName = textOf(doc.querySelector('.header .business-name'));
    var meta = textOf(doc.querySelector('.header .meta'));
    var userName = '';
    if (meta) {
        // "Prepared by: X | Generated: Y"
        var m = meta.match(/Prepared by:\s*([^|]+)\s*\|/i);
        if (m && m[1]) userName = norm(m[1]);
    }

    // PURPOSE
    var purpose = findSection('PURPOSE');
    var vision = getSubsectionContent(purpose, 'Vision Statement');
    var values = getSubsectionContent(purpose, 'Core Values');
    var mission = getSubsectionContent(purpose, 'Mission Statement');

    // MIND MAP
    var mindMapSec = findSection('BUSINESS MIND MAP');
    var marketing = '', sales = '', operations = '', administration = '';
    if (mindMapSec) {
        var items = mindMapSec.querySelectorAll('.proponent-item');
        for (var i = 0; i < items.length; i++) {
            var titleEl = items[i].querySelector('.proponent-title');
            var contentEl = items[i].querySelector('.content');
            var key = norm((titleEl && titleEl.textContent) || '').toLowerCase();
            var val = textOf(contentEl);
            if (key === 'marketing') marketing = val;
            if (key === 'sales') sales = val;
            if (key === 'operations') operations = val;
            if (key === 'administration') administration = val;
        }
    }

    // SWOT
    var swotSec = findSection('SWOT ANALYSIS');
    var strengths = '', weaknesses = '', opportunities = '', threats = '';
    if (swotSec) {
        var swotItems = swotSec.querySelectorAll('.swot-item');
        for (var i = 0; i < swotItems.length; i++) {
            var h4 = swotItems[i].querySelector('h4');
            var c = swotItems[i].querySelector('.content');
            var k = norm((h4 && h4.textContent) || '').toLowerCase();
            var v = textOf(c);
            if (k === 'strengths') strengths = v;
            if (k === 'weaknesses') weaknesses = v;
            if (k === 'opportunities') opportunities = v;
            if (k === 'threats') threats = v;
        }
    }

    // STRATEGY - GOALS
    var goalsSec = findSection('STRATEGY - GOALS');
    var goals = [];
    if (goalsSec) {
        var goalEls = goalsSec.querySelectorAll('.goal-item');
        for (var gi = 0; gi < goalEls.length; gi++) {
            var titleNode = goalEls[gi].querySelector('.goal-title');
            var rawTitle = norm((titleNode && titleNode.textContent) || '');
            rawTitle = rawTitle.replace(/^\d+\.\s*/, '').trim();
            if (!rawTitle) continue;

            var goal = {
                id: Date.now().toString() + Math.random().toString(16).slice(2),
                name: 'Goal ' + (goals.length + 1),
                title: rawTitle,
                timeline: '',
                strategicIntent: '',
                drivers: '',
                enablers: '',
                goalSettingData: null
            };

            var details = goalEls[gi].querySelectorAll('.goal-detail');
            for (var di = 0; di < details.length; di++) {
                var labelEl = details[di].querySelector('.goal-label');
                var label = norm((labelEl && labelEl.textContent) || '');

                // Extract value: clone, remove label span, read remaining text
                var clone = details[di].cloneNode(true);
                var cloneLabel = clone.querySelector('.goal-label');
                if (cloneLabel) cloneLabel.remove();
                var value = norm(clone.textContent || '');

                if (/^Time Horizon:/i.test(label)) goal.timeline = value;
                else if (/^Strategic Intent:/i.test(label)) goal.strategicIntent = value;
                else if (/^Drivers/i.test(label)) goal.drivers = value;
                else if (/^Enablers:/i.test(label)) goal.enablers = value;
            }

            goals.push(goal);
        }
    }

    // EXECUTION
    var execSec = findSection('EXECUTION');
    var targetsInitiatives = getSubsectionContent(execSec, 'Targets & Initiatives');
    var kpis = getSubsectionContent(execSec, 'Performance Indicators (KPIs)');
    var strategyMap = getSubsectionContent(execSec, 'Strategy Map');

    // REVIEW
    var reviewSec = findSection('REVIEW & MONITORING');
    var reviewFrequency = norm(getSubsectionContent(reviewSec, 'Review Frequency')) || 'quarterly';
    var successCriteria = getSubsectionContent(reviewSec, 'Success Criteria');
    var notes = getSubsectionContent(reviewSec, 'Additional Notes');

    // Build planData object
    var out = {
        businessName: businessName || '',
        userName: userName || '',
        vision: vision || '',
        values: values || '',
        mission: mission || '',
        strengths: strengths || '',
        weaknesses: weaknesses || '',
        opportunities: opportunities || '',
        threats: threats || '',
        goals: goals,
        currentGoalId: goals.length ? goals[0].id : null,
        targetsInitiatives: targetsInitiatives || '',
        kpis: kpis || '',
        strategyMap: strategyMap || '',
        marketing: marketing || '',
        sales: sales || '',
        operations: operations || '',
        administration: administration || '',
        mindMap: '',
        reviewFrequency: reviewFrequency || 'quarterly',
        successCriteria: successCriteria || '',
        notes: notes || '',
        _lastSavedISO: new Date().toISOString()
    };

    // Ensure at least one goal exists (keeps Step 5 UI stable)
    if (!out.goals || !out.goals.length) {
        out.goals = [{
            id: Date.now().toString() + Math.random().toString(16).slice(2),
            name: 'Goal 1',
            title: '',
            timeline: '',
            strategicIntent: '',
            drivers: '',
            enablers: '',
            goalSettingData: null
        }];
        out.currentGoalId = out.goals[0].id;
    }
    return out;
}

function getNonEmptyGoals() {
    if (!planData.goals || !planData.goals.length) return [];
    return planData.goals.filter(function(g) {
        return g && g.title && String(g.title).trim();
    });
}

// Share file on mobile using Web Share API
function shareFileMobile(blob, filename, mimeType) {
    var file = new File([blob], filename, { type: mimeType });
    
    // Try to share file if supported
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
        navigator.share({
            files: [file],
            title: 'Strategic Plan',
            text: 'My Strategic Plan - ' + filename
        }).catch(function(error) {
            console.log('Error sharing file:', error);
            // Fallback to alternative method
            shareFileMobileFallback(blob, filename, mimeType, null);
        });
    } else {
        // File sharing not supported, try text sharing for text files
        if (mimeType === 'text/plain') {
            blob.text().then(function(text) {
                if (navigator.share) {
                    navigator.share({
                        title: 'Strategic Plan',
                        text: text
                    }).catch(function(error) {
                        console.log('Error sharing text:', error);
                        shareFileMobileFallback(blob, filename, mimeType, text);
                    });
                } else {
                    shareFileMobileFallback(blob, filename, mimeType, text);
                }
            }).catch(function(error) {
                console.log('Error reading blob:', error);
                shareFileMobileFallback(blob, filename, mimeType, null);
            });
        } else {
            // For non-text files, use fallback
            shareFileMobileFallback(blob, filename, mimeType, null);
        }
    }
}

// Fallback method for mobile devices
function shareFileMobileFallback(blob, filename, mimeType, content) {
    // Try to create a download link that works on mobile
    var url = window.URL.createObjectURL(blob);
    
    // For text files, show export options modal
    if (mimeType === 'text/plain' && content) {
        showMobileExportOptions(url, filename, content);
        return;
    }
    
    // For other file types, try to download or show options
    var isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    
    if (isIOS) {
        // iOS: Try download first, then show options
    var a = document.createElement('a');
    a.href = url;
    a.download = filename;
        a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
        
        // Show options after a brief delay
        setTimeout(function() {
            showMobileFileOptions(url, filename, mimeType);
    document.body.removeChild(a);
        }, 300);
    } else {
        // Android: Try download
        var a = document.createElement('a');
        a.href = url;
        a.download = filename;
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        
        // Show options modal for additional methods
        setTimeout(function() {
            showMobileFileOptions(url, filename, mimeType);
        }, 300);
    }
}

// Show file export options for non-text files
function showMobileFileOptions(url, filename, mimeType) {
    var modal = document.createElement('div');
    modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center;';
    
    var modalContent = document.createElement('div');
    modalContent.style.cssText = 'background: white; padding: 20px; border-radius: 8px; max-width: 90%; max-height: 80%; overflow-y: auto;';
    
    var title = document.createElement('h3');
    title.style.cssText = 'margin-top: 0;';
    title.textContent = 'Export Options';
    modalContent.appendChild(title);
    
    var description = document.createElement('p');
    description.textContent = 'If the download didn\'t work, try these options:';
    modalContent.appendChild(description);
    
    // Download file link
    var downloadLink = document.createElement('a');
    downloadLink.href = url;
    downloadLink.download = filename;
    downloadLink.textContent = 'Try Download Again';
    downloadLink.style.cssText = 'display: block; width: 100%; padding: 12px; margin: 8px 0; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; text-align: center; text-decoration: none;';
    downloadLink.onclick = function() {
        setTimeout(function() {
            modal.remove();
            setTimeout(function() {
                window.URL.revokeObjectURL(url);
            }, 100);
        }, 100);
    };
    modalContent.appendChild(downloadLink);
    
    // Open in new tab (for viewing)
    var openLink = document.createElement('a');
    openLink.href = url;
    openLink.target = '_blank';
    openLink.textContent = 'Open in New Tab';
    openLink.style.cssText = 'display: block; width: 100%; padding: 12px; margin: 8px 0; background: #0f4c75; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; text-align: center; text-decoration: none;';
    openLink.onclick = function() {
        setTimeout(function() {
            modal.remove();
            setTimeout(function() {
                window.URL.revokeObjectURL(url);
            }, 1000);
        }, 100);
    };
    modalContent.appendChild(openLink);
    
    // Cancel button
    var cancelBtn = document.createElement('button');
    cancelBtn.textContent = 'Close';
    cancelBtn.style.cssText = 'display: block; width: 100%; padding: 12px; margin: 8px 0; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;';
    cancelBtn.onclick = function() {
        modal.remove();
        window.URL.revokeObjectURL(url);
    };
    modalContent.appendChild(cancelBtn);
    
    modal.appendChild(modalContent);
    document.body.appendChild(modal);
    
    // Close on background click
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            modal.remove();
            window.URL.revokeObjectURL(url);
        }
    });
}

// Show additional export options for mobile
function showMobileExportOptions(url, filename, textContent) {
    var isIOS = /iPhone|iPad|iPod/i.test(navigator.userAgent);
    
    // Create a modal with export options
    var modal = document.createElement('div');
    modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; display: flex; align-items: center; justify-content: center;';
    
    var modalContent = document.createElement('div');
    modalContent.style.cssText = 'background: white; padding: 20px; border-radius: 8px; max-width: 90%; max-height: 80%; overflow-y: auto;';
    
    // Store text content in a data attribute for safe access
    modalContent.setAttribute('data-text-content', textContent);
    modalContent.setAttribute('data-file-url', url);
    
    var title = document.createElement('h3');
    title.style.cssText = 'margin-top: 0;';
    title.textContent = 'Export Options';
    modalContent.appendChild(title);
    
    var description = document.createElement('p');
    description.textContent = 'Choose how you want to save your strategic plan:';
    modalContent.appendChild(description);
    
    // For iOS, add "View & Save" option first (best for iPhone)
    if (isIOS) {
        var viewSaveBtn = document.createElement('button');
        viewSaveBtn.textContent = 'View & Save to Files (Recommended for iPhone)';
        viewSaveBtn.style.cssText = 'display: block; width: 100%; padding: 12px; margin: 8px 0; background: #007AFF; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; font-weight: bold;';
        viewSaveBtn.onclick = function() {
            openTextForIOSSave(textContent, filename);
            modal.remove();
            window.URL.revokeObjectURL(url);
        };
        modalContent.appendChild(viewSaveBtn);
    }
    
    // Copy to clipboard button
    var copyBtn = document.createElement('button');
    copyBtn.textContent = 'Copy Text to Clipboard';
    copyBtn.style.cssText = 'display: block; width: 100%; padding: 12px; margin: 8px 0; background: #0f4c75; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;';
    copyBtn.onclick = function() {
        copyToClipboard(textContent);
        modal.remove();
        window.URL.revokeObjectURL(url);
    };
    modalContent.appendChild(copyBtn);
    
    // Download file link
    var downloadLink = document.createElement('a');
    downloadLink.href = url;
    downloadLink.download = filename;
    downloadLink.textContent = 'Download File';
    downloadLink.style.cssText = 'display: block; width: 100%; padding: 12px; margin: 8px 0; background: #28a745; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; text-align: center; text-decoration: none;';
    downloadLink.onclick = function() {
        setTimeout(function() {
            modal.remove();
            setTimeout(function() {
                window.URL.revokeObjectURL(url);
            }, 100);
        }, 100);
    };
    modalContent.appendChild(downloadLink);
    
    // Email button
    var emailBtn = document.createElement('button');
    emailBtn.textContent = 'Email as Text';
    emailBtn.style.cssText = 'display: block; width: 100%; padding: 12px; margin: 8px 0; background: #17a2b8; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;';
    emailBtn.onclick = function() {
        shareViaEmail(textContent);
        modal.remove();
        window.URL.revokeObjectURL(url);
    };
    modalContent.appendChild(emailBtn);
    
    // Cancel button
    var cancelBtn = document.createElement('button');
    cancelBtn.textContent = 'Cancel';
    cancelBtn.style.cssText = 'display: block; width: 100%; padding: 12px; margin: 8px 0; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 16px;';
    cancelBtn.onclick = function() {
        modal.remove();
        window.URL.revokeObjectURL(url);
    };
    modalContent.appendChild(cancelBtn);
    
    modal.appendChild(modalContent);
    document.body.appendChild(modal);
    
    // Close on background click
    modal.addEventListener('click', function(e) {
        if (e.target === modal) {
            modal.remove();
            window.URL.revokeObjectURL(url);
        }
    });
}

// Open text in a new page that can be saved on iOS
function openTextForIOSSave(textContent, filename) {
    // Create an HTML page with the text content that can be saved
    var htmlContent = '<!DOCTYPE html>\n<html>\n<head>\n<meta charset="UTF-8">\n<meta name="viewport" content="width=device-width, initial-scale=1.0">\n<title>' + escapeHtml(filename) + '</title>\n<style>body{font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 20px; line-height: 1.6; white-space: pre-wrap; word-wrap: break-word;}</style>\n</head>\n<body>\n' + escapeHtml(textContent) + '\n</body>\n</html>';
    
    // Create a blob with the HTML content
    var blob = new Blob([htmlContent], { type: 'text/html' });
    var blobUrl = window.URL.createObjectURL(blob);
    
    // Try to open in new window/tab
    var newWindow = window.open(blobUrl, '_blank');
    
    // If that doesn't work, create a link and click it
    if (!newWindow || newWindow.closed || typeof newWindow.closed == 'undefined') {
        var link = document.createElement('a');
        link.href = blobUrl;
        link.target = '_blank';
        link.style.display = 'none';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
    
    // Also create a plain text version for direct download
    setTimeout(function() {
        var textBlob = new Blob([textContent], { type: 'text/plain' });
        var textBlobUrl = window.URL.createObjectURL(textBlob);
        var textLink = document.createElement('a');
        textLink.href = textBlobUrl;
        textLink.download = filename;
        textLink.style.display = 'none';
        document.body.appendChild(textLink);
        textLink.click();
        document.body.removeChild(textLink);
        
        // Clean up after a delay
        setTimeout(function() {
            window.URL.revokeObjectURL(textBlobUrl);
        }, 1000);
    }, 500);
    
    // Clean up HTML blob URL after a delay
    setTimeout(function() {
        window.URL.revokeObjectURL(blobUrl);
    }, 5000);
    
    // Show instructions
    alert('The document has been opened. On iPhone:\n\n1. Tap the Share button (square with arrow) at the bottom\n2. Scroll and tap "Save to Files"\n3. Choose where to save it\n\nOr use "Copy Text" option to paste into Notes or other apps.');
}

// Copy text to clipboard
function copyToClipboard(text) {
    if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(text).then(function() {
            alert('Text copied to clipboard! You can now paste it into any app.');
        }).catch(function(err) {
            console.error('Failed to copy:', err);
            fallbackCopyToClipboard(text);
        });
    } else {
        fallbackCopyToClipboard(text);
    }
}

// Fallback copy to clipboard for older browsers
function fallbackCopyToClipboard(text) {
    var textArea = document.createElement('textarea');
    textArea.value = text;
    textArea.style.position = 'fixed';
    textArea.style.left = '-999999px';
    textArea.style.top = '-999999px';
    document.body.appendChild(textArea);
    textArea.focus();
    textArea.select();
    
    try {
        document.execCommand('copy');
        alert('Text copied to clipboard! You can now paste it into any app.');
    } catch (err) {
        console.error('Fallback copy failed:', err);
        alert('Could not copy to clipboard. Please select and copy the text manually.');
    }
    
    document.body.removeChild(textArea);
}

// Share via email
function shareViaEmail(text) {
    var subject = encodeURIComponent('Strategic Plan - ' + new Date().toLocaleDateString());
    var body = encodeURIComponent(text);
    var mailtoLink = 'mailto:?subject=' + subject + '&body=' + body;
    window.location.href = mailtoLink;
}

// Standard file download for desktop
function downloadFile(blob, filename) {
    var url = window.URL.createObjectURL(blob);
    var a = document.createElement('a');
    a.href = url;
    a.download = filename;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    window.URL.revokeObjectURL(url);
}

// Generate plan document
function generatePlanDocument() {
    var doc = 'STRATEGIC PLAN\n';
    doc += 'Generated: ' + new Date().toLocaleDateString() + '\n';
    doc += '='.repeat(50) + '\n\n';
    
    doc += 'BUSINESS INFORMATION\n';
    doc += '-'.repeat(50) + '\n';
    doc += 'Business Name: ' + (planData.businessName || 'Not specified') + '\n';
    doc += 'Prepared by: ' + (planData.userName || 'Not specified') + '\n\n';
    
    doc += 'PURPOSE\n';
    doc += '-'.repeat(50) + '\n';
    doc += 'Vision:\n' + planData.vision + '\n\n';
    doc += 'Values:\n' + planData.values + '\n\n';
    doc += 'Mission:\n' + planData.mission + '\n\n';
    
    doc += 'SWOT ANALYSIS\n';
    doc += '-'.repeat(50) + '\n';
    doc += 'Strengths:\n' + planData.strengths + '\n\n';
    doc += 'Weaknesses:\n' + planData.weaknesses + '\n\n';
    doc += 'Opportunities:\n' + planData.opportunities + '\n\n';
    doc += 'Threats:\n' + planData.threats + '\n\n';
    
    var goals = getNonEmptyGoals();
    doc += 'STRATEGY - GOALS\n';
    doc += '-'.repeat(50) + '\n';
    for (var i = 0; i < goals.length; i++) {
        doc += (i + 1) + '. ' + goals[i].title + '\n';
        doc += '   Time Horizon: ' + (goals[i].timeline || '') + '\n';
        doc += '   Strategic Intent: ' + (goals[i].strategicIntent || '') + '\n';
        doc += '   Drivers: ' + (goals[i].drivers || '') + '\n';
        doc += '   Enablers: ' + (goals[i].enablers || '') + '\n\n';
    }
    
    doc += 'EXECUTION\n';
    doc += '-'.repeat(50) + '\n';
    doc += 'Targets & Initiatives:\n' + planData.targetsInitiatives + '\n\n';
    doc += 'Performance Indicators (KPIs):\n' + planData.kpis + '\n\n';
    doc += 'Strategy Map:\n' + planData.strategyMap + '\n\n';
    
    doc += 'MIND MAP - BUSINESS PROPONENTS\n';
    doc += '-'.repeat(50) + '\n';
    doc += 'Marketing:\n' + planData.marketing + '\n\n';
    doc += 'Sales:\n' + planData.sales + '\n\n';
    doc += 'Operations:\n' + planData.operations + '\n\n';
    doc += 'Administration:\n' + planData.administration + '\n\n';
    
    doc += 'REVIEW & MONITORING\n';
    doc += '-'.repeat(50) + '\n';
    doc += 'Review Frequency: ' + planData.reviewFrequency + '\n';
    doc += 'Success Criteria: ' + planData.successCriteria + '\n';
    doc += 'Notes: ' + planData.notes + '\n';
    
    return doc;
}

// Generate Word document (HTML format for Word)
function generateWordDocument() {
    var date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    var businessName = planData.businessName || 'Your Business';
    var userName = planData.userName || 'Strategic Planning Team';
    
    var html = '<!DOCTYPE html>\n';
    html += '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:w="urn:schemas-microsoft-com:office:word" xmlns="http://www.w3.org/TR/REC-html40">\n';
    html += '<head>\n';
    html += '<meta charset="utf-8">\n';
    html += '<meta name="ProgId" content="Word.Document">\n';
    html += '<meta name="Generator" content="Microsoft Word">\n';
    html += '<meta name="Originator" content="Microsoft Word">\n';
    html += '<title>Strategic Plan - ' + escapeHtml(businessName) + '</title>\n';
    html += '<!--[if gte mso 9]><xml>\n';
    html += '<w:WordDocument>\n';
    html += '<w:View>Print</w:View>\n';
    html += '<w:Zoom>100</w:Zoom>\n';
    html += '<w:DoNotOptimizeForBrowser/>\n';
    html += '</w:WordDocument>\n';
    html += '</xml><![endif]-->\n';
    html += '<style>\n';
    html += '@page { size: 8.5in 11in; margin: 1in; }\n';
    html += 'body { font-family: "Calibri", "Arial", sans-serif; font-size: 11pt; margin: 0; padding: 0; line-height: 1.6; color: #333; }\n';
    html += 'h1 { color: #0f4c75; font-size: 24pt; font-weight: bold; margin-top: 24pt; margin-bottom: 12pt; page-break-after: avoid; }\n';
    html += 'h2 { color: #0f4c75; font-size: 18pt; font-weight: bold; margin-top: 18pt; margin-bottom: 12pt; border-bottom: 2px solid #0f4c75; padding-bottom: 6pt; page-break-after: avoid; }\n';
    html += 'h3 { color: #764ba2; font-size: 14pt; font-weight: bold; margin-top: 12pt; margin-bottom: 6pt; }\n';
    html += 'h4 { color: #555; font-size: 12pt; font-weight: bold; margin-top: 10pt; margin-bottom: 6pt; }\n';
    html += '.header { text-align: center; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #0f4c75; page-break-after: avoid; }\n';
    html += '.header h1 { color: #0f4c75; font-size: 24pt; margin: 10px 0 5px 0; font-weight: bold; }\n';
    html += '.header .business-name { color: #333; font-size: 16pt; font-weight: bold; margin: 8px 0; }\n';
    html += '.header .subtitle { color: #666; font-size: 11pt; margin-top: 5px; }\n';
    html += '.header .meta { color: #999; font-size: 9pt; margin-top: 10px; }\n';
    html += '.section { margin-bottom: 24pt; page-break-inside: avoid; }\n';
    html += '.section-title { color: #0f4c75; font-size: 18pt; font-weight: bold; margin-bottom: 12pt; padding-bottom: 6pt; border-bottom: 2px solid #0f4c75; page-break-after: avoid; }\n';
    html += '.subsection { margin-bottom: 15pt; margin-left: 0; page-break-inside: avoid; }\n';
    html += '.subsection-title { color: #764ba2; font-size: 14pt; font-weight: bold; margin-bottom: 8pt; margin-top: 12pt; }\n';
    html += '.content { margin-bottom: 10pt; line-height: 1.6; text-align: left; font-size: 11pt; }\n';
    html += '.content p { margin: 6pt 0; }\n';
    html += '.goal-item { background: #f8f9fa; padding: 12pt; margin-bottom: 12pt; border-left: 4px solid #0f4c75; page-break-inside: avoid; }\n';
    html += '.goal-title { font-weight: bold; color: #0f4c75; font-size: 14pt; margin-bottom: 8pt; }\n';
    html += '.goal-detail { margin-left: 12pt; margin-bottom: 6pt; color: #555; font-size: 11pt; line-height: 1.6; }\n';
    html += '.goal-label { font-weight: bold; color: #333; }\n';
    html += '.swot-grid { display: table; width: 100%; margin: 12pt 0; border-collapse: separate; border-spacing: 10pt; page-break-inside: avoid; }\n';
    html += '.swot-row { display: table-row; }\n';
    html += '.swot-item { display: table-cell; width: 50%; padding: 12pt; vertical-align: top; page-break-inside: avoid; }\n';
    html += '.swot-item h4 { font-weight: bold; margin-bottom: 8pt; font-size: 12pt; color: #333; }\n';
    html += '.swot-item .content { font-size: 11pt; line-height: 1.6; }\n';
    html += '.swot-strengths { background: #e8f5e9; border-left: 4px solid #4caf50; }\n';
    html += '.swot-weaknesses { background: #fff3e0; border-left: 4px solid #ff9800; }\n';
    html += '.swot-opportunities { background: #e3f2fd; border-left: 4px solid #2196f3; }\n';
    html += '.swot-threats { background: #fce4ec; border-left: 4px solid #e91e63; }\n';
    html += '.proponent-item { background: #f8f9fa; padding: 12pt; margin-bottom: 12pt; border-left: 4px solid #0f4c75; page-break-inside: avoid; }\n';
    html += '.proponent-title { font-weight: bold; color: #0f4c75; font-size: 14pt; margin-bottom: 8pt; }\n';
    html += 'table { width: 100%; border-collapse: collapse; margin: 12pt 0; page-break-inside: avoid; }\n';
    html += 'th { background-color: #0f4c75; color: white; font-weight: bold; padding: 8pt; border: 1px solid #000000; text-align: left; }\n';
    html += 'td { padding: 6pt; border: 1px solid #dddddd; font-size: 11pt; }\n';
    html += 'tr:nth-child(even) { background-color: #f8f9fa; }\n';
    // Word's justification often creates huge inter-word gaps (especially with manual line breaks),
    // so keep paragraph text left-aligned in the exported document.
    html += 'p { margin: 6pt 0; text-align: left; word-spacing: normal; }\n';
    html += 'ul { margin: 8pt 0; padding-left: 25pt; }\n';
    html += 'li { margin: 4pt 0; line-height: 1.6; }\n';
    html += '.page-break { page-break-before: always; }\n';
    html += '.no-break { page-break-inside: avoid; }\n';
    html += '@media print { .section { page-break-inside: avoid; } .header { page-break-after: avoid; } }\n';
    html += '</style>\n';
    html += '</head>\n';
    html += '<body>\n';
    
    // Header
    html += '<div class="header">\n';
    html += '<h1>STRATEGIC PLAN</h1>\n';
    html += '<div class="business-name">' + escapeHtml(businessName) + '</div>\n';
    html += '<div class="subtitle">Comprehensive Strategic Planning Document</div>\n';
    html += '<div class="meta">Prepared by: ' + escapeHtml(userName) + ' | Generated: ' + date + '</div>\n';
    html += '</div>\n';
    
    // Purpose Section
    html += '<div class="section">\n';
    html += '<div class="section-title">PURPOSE</div>\n';
    
    if (planData.vision) {
        html += '<div class="subsection">\n';
        html += '<div class="subsection-title">Vision Statement</div>\n';
        html += '<div class="content">' + formatTextForWord(planData.vision) + '</div>\n';
        html += '</div>\n';
    }
    
    if (planData.values) {
        html += '<div class="subsection">\n';
        html += '<div class="subsection-title">Core Values</div>\n';
        html += '<div class="content">' + formatTextForWord(planData.values) + '</div>\n';
        html += '</div>\n';
    }
    
    if (planData.mission) {
        html += '<div class="subsection">\n';
        html += '<div class="subsection-title">Mission Statement</div>\n';
        html += '<div class="content">' + formatTextForWord(planData.mission) + '</div>\n';
        html += '</div>\n';
    }
    
    html += '</div>\n';
    
    // Mind Map Section
    if (planData.marketing || planData.sales || planData.operations || planData.administration) {
        html += '<div class="section">\n';
        html += '<div class="section-title">BUSINESS MIND MAP</div>\n';
        
        if (planData.marketing) {
            html += '<div class="proponent-item">\n';
            html += '<div class="proponent-title">Marketing</div>\n';
            html += '<div class="content">' + formatTextForWord(planData.marketing) + '</div>\n';
            html += '</div>\n';
        }
        
        if (planData.sales) {
            html += '<div class="proponent-item">\n';
            html += '<div class="proponent-title">Sales</div>\n';
            html += '<div class="content">' + formatTextForWord(planData.sales) + '</div>\n';
            html += '</div>\n';
        }
        
        if (planData.operations) {
            html += '<div class="proponent-item">\n';
            html += '<div class="proponent-title">Operations</div>\n';
            html += '<div class="content">' + formatTextForWord(planData.operations) + '</div>\n';
            html += '</div>\n';
        }
        
        if (planData.administration) {
            html += '<div class="proponent-item">\n';
            html += '<div class="proponent-title">Administration</div>\n';
            html += '<div class="content">' + formatTextForWord(planData.administration) + '</div>\n';
            html += '</div>\n';
        }
        
        html += '</div>\n';
    }
    
    // SWOT Analysis
    if (planData.strengths || planData.weaknesses || planData.opportunities || planData.threats) {
        html += '<div class="section">\n';
        html += '<div class="section-title">SWOT ANALYSIS</div>\n';
        html += '<div class="swot-grid">\n';
        html += '<div class="swot-row">\n';
        
        html += '<div class="swot-item swot-strengths">\n';
        html += '<h4>Strengths</h4>\n';
        html += '<div class="content">' + formatTextForWord(planData.strengths || 'Not specified') + '</div>\n';
        html += '</div>\n';
        
        html += '<div class="swot-item swot-weaknesses">\n';
        html += '<h4>Weaknesses</h4>\n';
        html += '<div class="content">' + formatTextForWord(planData.weaknesses || 'Not specified') + '</div>\n';
        html += '</div>\n';
        
        html += '</div>\n';
        html += '<div class="swot-row">\n';
        
        html += '<div class="swot-item swot-opportunities">\n';
        html += '<h4>Opportunities</h4>\n';
        html += '<div class="content">' + formatTextForWord(planData.opportunities || 'Not specified') + '</div>\n';
        html += '</div>\n';
        
        html += '<div class="swot-item swot-threats">\n';
        html += '<h4>Threats</h4>\n';
        html += '<div class="content">' + formatTextForWord(planData.threats || 'Not specified') + '</div>\n';
        html += '</div>\n';
        
        html += '</div>\n';
        html += '</div>\n';
        html += '</div>\n';
    }
    
    // Strategy - Goals
    var goals = getNonEmptyGoals();
    if (goals.length > 0) {
        html += '<div class="section">\n';
        html += '<div class="section-title">STRATEGY - GOALS</div>\n';
        
        for (var i = 0; i < goals.length; i++) {
            var goal = goals[i];
            html += '<div class="goal-item">\n';
            html += '<div class="goal-title">' + (i + 1) + '. ' + escapeHtml(goal.title) + '</div>\n';
            
            if (goal.timeline) {
                html += '<div class="goal-detail"><span class="goal-label">Time Horizon:</span> ' + escapeHtml(goal.timeline) + '</div>\n';
            }
            
            if (goal.strategicIntent) {
                html += '<div class="goal-detail"><span class="goal-label">Strategic Intent:</span> ' + formatTextForWord(goal.strategicIntent) + '</div>\n';
            }
            
            if (goal.drivers) {
                html += '<div class="goal-detail"><span class="goal-label">Drivers (Elephant Projects):</span> ' + formatTextForWord(goal.drivers) + '</div>\n';
            }
            
            if (goal.enablers) {
                html += '<div class="goal-detail"><span class="goal-label">Enablers:</span> ' + formatTextForWord(goal.enablers) + '</div>\n';
            }
            
            html += '</div>\n';
        }
        
        html += '</div>\n';
    }
    
    // Execution
    if (planData.targetsInitiatives || planData.kpis || planData.strategyMap) {
        html += '<div class="section">\n';
        html += '<div class="section-title">EXECUTION</div>\n';
        
        if (planData.targetsInitiatives) {
            html += '<div class="subsection">\n';
            html += '<div class="subsection-title">Targets & Initiatives</div>\n';
            html += '<div class="content">' + formatTextForWord(planData.targetsInitiatives) + '</div>\n';
            html += '</div>\n';
        }
        
        if (planData.kpis) {
            html += '<div class="subsection">\n';
            html += '<div class="subsection-title">Performance Indicators (KPIs)</div>\n';
            html += '<div class="content">' + formatTextForWord(planData.kpis) + '</div>\n';
            html += '</div>\n';
        }
        
        if (planData.strategyMap) {
            html += '<div class="subsection">\n';
            html += '<div class="subsection-title">Strategy Map</div>\n';
            html += '<div class="content">' + formatTextForWord(planData.strategyMap) + '</div>\n';
            html += '</div>\n';
        }
        
        html += '</div>\n';
    }
    
    // Review & Monitoring
    html += '<div class="section">\n';
    html += '<div class="section-title">REVIEW & MONITORING</div>\n';
    
    html += '<div class="subsection">\n';
    html += '<div class="subsection-title">Review Frequency</div>\n';
    html += '<div class="content">' + escapeHtml(planData.reviewFrequency || 'Not specified') + '</div>\n';
    html += '</div>\n';
    
    if (planData.successCriteria) {
        html += '<div class="subsection">\n';
        html += '<div class="subsection-title">Success Criteria</div>\n';
        html += '<div class="content">' + formatTextForWord(planData.successCriteria) + '</div>\n';
        html += '</div>\n';
    }
    
    if (planData.notes) {
        html += '<div class="subsection">\n';
        html += '<div class="subsection-title">Additional Notes</div>\n';
        html += '<div class="content">' + formatTextForWord(planData.notes) + '</div>\n';
        html += '</div>\n';
    }
    
    html += '</div>\n';
    
    html += '</body>\n';
    html += '</html>\n';
    
    return html;
}

// Format text for Word document (preserve line breaks, escape HTML)
function formatTextForWord(text) {
    if (!text) return '';
    var escaped = escapeHtml(text);
    // Convert line breaks to <br> tags
    escaped = escaped.replace(/\n/g, '<br>');
    // Convert double line breaks to paragraphs
    escaped = escaped.replace(/(<br>\s*){2,}/g, '</p><p>');
    return '<p>' + escaped + '</p>';
}

// Generate Excel document (HTML table format for Excel)
function generateExcelDocument() {
    var date = new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
    var businessName = planData.businessName || 'Your Business';
    var userName = planData.userName || 'Strategic Planning Team';
    
    var html = '<html xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40">\n';
    html += '<head>\n';
    html += '<meta charset="utf-8">\n';
    html += '<!--[if gte mso 9]><xml>\n';
    html += '<x:ExcelWorkbook>\n';
    html += '<x:ExcelWorksheets>\n';
    html += '<x:ExcelWorksheet>\n';
    html += '<x:Name>Strategic Plan</x:Name>\n';
    html += '<x:WorksheetOptions>\n';
    html += '<x:PrintGridlines/>\n';
    html += '<x:FitToPage/>\n';
    html += '<x:FitWidth>1</x:FitWidth>\n';
    html += '<x:FitHeight>1</x:FitHeight>\n';
    html += '<x:PageSetup>\n';
    html += '<x:Header x:Margin="0.3"/>\n';
    html += '<x:Footer x:Margin="0.3"/>\n';
    html += '<x:PageMargins x:Bottom="0.75" x:Left="0.7" x:Right="0.7" x:Top="0.75"/>\n';
    html += '</x:PageSetup>\n';
    html += '<x:FreezePanes/>\n';
    html += '<x:FrozenNoSplit/>\n';
    html += '<x:SplitHorizontal>3</x:SplitHorizontal>\n';
    html += '<x:TopRowBottomPane>3</x:TopRowBottomPane>\n';
    html += '<x:ActivePane>2</x:ActivePane>\n';
    html += '</x:WorksheetOptions>\n';
    html += '</x:ExcelWorksheet>\n';
    html += '</x:ExcelWorksheets>\n';
    html += '</x:ExcelWorkbook>\n';
    html += '</xml><![endif]-->\n';
    html += '<style>\n';
    html += 'table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }\n';
    html += 'td, th { border: 1px solid #000000; padding: 8px; vertical-align: top; font-family: Calibri, Arial, sans-serif; font-size: 11pt; line-height: 1.5; }\n';
    html += 'th { background-color: #0f4c75; color: white; font-weight: bold; text-align: center; }\n';
    html += 'td { background-color: #ffffff; white-space: normal; word-wrap: break-word; }\n';
    html += 'tr:nth-child(even) td { background-color: #f8f9fa; }\n';
    html += '.header-cell { background-color: #0f4c75; color: white; font-weight: bold; font-size: 14pt; text-align: center; padding: 15px; border: 2px solid #000000; }\n';
    html += '.section-header { background-color: #764ba2; color: white; font-weight: bold; font-size: 12pt; padding: 12px; border: 1px solid #000000; }\n';
    html += '.subsection-header { background-color: #9b7bb8; color: white; font-weight: bold; font-size: 11pt; padding: 10px; border: 1px solid #000000; }\n';
    html += '.label-cell { background-color: #f0f0f0; font-weight: bold; width: 200px; border: 1px solid #000000; }\n';
    html += '.data-cell { background-color: #ffffff; border: 1px solid #000000; }\n';
    html += '.swot-strengths { background-color: #e8f5e9; border: 1px solid #000000; border-left: 4px solid #4caf50; }\n';
    html += '.swot-weaknesses { background-color: #fff3e0; border: 1px solid #000000; border-left: 4px solid #ff9800; }\n';
    html += '.swot-opportunities { background-color: #e3f2fd; border: 1px solid #000000; border-left: 4px solid #2196f3; }\n';
    html += '.swot-threats { background-color: #fce4ec; border: 1px solid #000000; border-left: 4px solid #e91e63; }\n';
    html += '.goal-row { background-color: #f8f9fa; border: 1px solid #000000; border-left: 4px solid #0f4c75; }\n';
    html += '.proponent-row { background-color: #f8f9fa; border: 1px solid #000000; border-left: 4px solid #0f4c75; }\n';
    html += '.meta-row { background-color: #f5f5f5; font-size: 9pt; color: #666; border: 1px solid #000000; }\n';
    html += '</style>\n';
    html += '</head>\n';
    html += '<body>\n';
    html += '<table>\n';
    
    // Header Row
    html += '<tr>\n';
    html += '<td colspan="2" class="header-cell">STRATEGIC PLAN</td>\n';
    html += '</tr>\n';
    html += '<tr>\n';
    html += '<td colspan="2" style="text-align: center; padding: 10px; background-color: #f8f9fa; font-size: 12pt; font-weight: bold;">' + escapeHtml(businessName) + '</td>\n';
    html += '</tr>\n';
    html += '<tr class="meta-row">\n';
    html += '<td colspan="2" style="text-align: center; padding: 5px;">Prepared by: ' + escapeHtml(userName) + ' | Generated: ' + date + '</td>\n';
    html += '</tr>\n';
    html += '<tr><td colspan="2" style="height: 10px; border: none;"></td></tr>\n';
    
    // Purpose Section
    html += '<tr>\n';
    html += '<td colspan="2" class="section-header">PURPOSE</td>\n';
    html += '</tr>\n';
    
    if (planData.vision) {
        html += '<tr>\n';
        html += '<td class="label-cell">Vision Statement</td>\n';
        html += '<td class="data-cell">' + formatTextForExcel(planData.vision) + '</td>\n';
        html += '</tr>\n';
    }
    
    if (planData.values) {
        html += '<tr>\n';
        html += '<td class="label-cell">Core Values</td>\n';
        html += '<td class="data-cell">' + formatTextForExcel(planData.values) + '</td>\n';
        html += '</tr>\n';
    }
    
    if (planData.mission) {
        html += '<tr>\n';
        html += '<td class="label-cell">Mission Statement</td>\n';
        html += '<td class="data-cell">' + formatTextForExcel(planData.mission) + '</td>\n';
        html += '</tr>\n';
    }
    
    html += '<tr><td colspan="2" style="height: 15px; border: none;"></td></tr>\n';
    
    // Mind Map Section
    if (planData.marketing || planData.sales || planData.operations || planData.administration) {
        html += '<tr>\n';
        html += '<td colspan="2" class="section-header">BUSINESS MIND MAP</td>\n';
        html += '</tr>\n';
        
        if (planData.marketing) {
            html += '<tr class="proponent-row">\n';
            html += '<td class="label-cell" style="font-weight: bold; color: #667eea;">Marketing</td>\n';
            html += '<td class="data-cell">' + formatTextForExcel(planData.marketing) + '</td>\n';
            html += '</tr>\n';
        }
        
        if (planData.sales) {
            html += '<tr class="proponent-row">\n';
            html += '<td class="label-cell" style="font-weight: bold; color: #667eea;">Sales</td>\n';
            html += '<td class="data-cell">' + formatTextForExcel(planData.sales) + '</td>\n';
            html += '</tr>\n';
        }
        
        if (planData.operations) {
            html += '<tr class="proponent-row">\n';
            html += '<td class="label-cell" style="font-weight: bold; color: #667eea;">Operations</td>\n';
            html += '<td class="data-cell">' + formatTextForExcel(planData.operations) + '</td>\n';
            html += '</tr>\n';
        }
        
        if (planData.administration) {
            html += '<tr class="proponent-row">\n';
            html += '<td class="label-cell" style="font-weight: bold; color: #667eea;">Administration</td>\n';
            html += '<td class="data-cell">' + formatTextForExcel(planData.administration) + '</td>\n';
            html += '</tr>\n';
        }
        
        html += '<tr><td colspan="2" style="height: 15px; border: none;"></td></tr>\n';
    }
    
    // SWOT Analysis Section
    if (planData.strengths || planData.weaknesses || planData.opportunities || planData.threats) {
        html += '<tr>\n';
        html += '<td colspan="2" class="section-header">SWOT ANALYSIS</td>\n';
        html += '</tr>\n';
        html += '<tr>\n';
        
        // Strengths and Weaknesses
        html += '<td class="swot-strengths" style="width: 50%;">\n';
        html += '<table style="width: 100%; border: none;">\n';
        html += '<tr><td style="font-weight: bold; font-size: 12pt; padding-bottom: 8px; border: none;">Strengths</td></tr>\n';
        html += '<tr><td style="border: none; padding: 0;">' + formatTextForExcel(planData.strengths || 'Not specified') + '</td></tr>\n';
        html += '</table>\n';
        html += '</td>\n';
        
        html += '<td class="swot-weaknesses" style="width: 50%;">\n';
        html += '<table style="width: 100%; border: none;">\n';
        html += '<tr><td style="font-weight: bold; font-size: 12pt; padding-bottom: 8px; border: none;">Weaknesses</td></tr>\n';
        html += '<tr><td style="border: none; padding: 0;">' + formatTextForExcel(planData.weaknesses || 'Not specified') + '</td></tr>\n';
        html += '</table>\n';
        html += '</td>\n';
        html += '</tr>\n';
        
        html += '<tr>\n';
        // Opportunities and Threats
        html += '<td class="swot-opportunities" style="width: 50%;">\n';
        html += '<table style="width: 100%; border: none;">\n';
        html += '<tr><td style="font-weight: bold; font-size: 12pt; padding-bottom: 8px; border: none;">Opportunities</td></tr>\n';
        html += '<tr><td style="border: none; padding: 0;">' + formatTextForExcel(planData.opportunities || 'Not specified') + '</td></tr>\n';
        html += '</table>\n';
        html += '</td>\n';
        
        html += '<td class="swot-threats" style="width: 50%;">\n';
        html += '<table style="width: 100%; border: none;">\n';
        html += '<tr><td style="font-weight: bold; font-size: 12pt; padding-bottom: 8px; border: none;">Threats</td></tr>\n';
        html += '<tr><td style="border: none; padding: 0;">' + formatTextForExcel(planData.threats || 'Not specified') + '</td></tr>\n';
        html += '</table>\n';
        html += '</td>\n';
        html += '</tr>\n';
        
        html += '<tr><td colspan="2" style="height: 15px; border: none;"></td></tr>\n';
    }
    
    // Strategy - Goals Section
    var goals = getNonEmptyGoals();
    if (goals.length > 0) {
        html += '<tr>\n';
        html += '<td colspan="2" class="section-header">STRATEGY - GOALS</td>\n';
        html += '</tr>\n';
        
        for (var i = 0; i < goals.length; i++) {
            var goal = goals[i];
            html += '<tr class="goal-row">\n';
            html += '<td colspan="2" style="font-weight: bold; color: #667eea; font-size: 12pt; padding: 10px;">Goal ' + (i + 1) + ': ' + escapeHtml(goal.title) + '</td>\n';
            html += '</tr>\n';
            
            if (goal.timeline) {
                html += '<tr class="goal-row">\n';
                html += '<td class="label-cell">Time Horizon</td>\n';
                html += '<td class="data-cell">' + escapeHtml(goal.timeline) + '</td>\n';
                html += '</tr>\n';
            }
            
            if (goal.strategicIntent) {
                html += '<tr class="goal-row">\n';
                html += '<td class="label-cell">Strategic Intent</td>\n';
                html += '<td class="data-cell">' + formatTextForExcel(goal.strategicIntent) + '</td>\n';
                html += '</tr>\n';
            }
            
            if (goal.drivers) {
                html += '<tr class="goal-row">\n';
                html += '<td class="label-cell">Drivers (Elephant Projects)</td>\n';
                html += '<td class="data-cell">' + formatTextForExcel(goal.drivers) + '</td>\n';
                html += '</tr>\n';
            }
            
            if (goal.enablers) {
                html += '<tr class="goal-row">\n';
                html += '<td class="label-cell">Enablers</td>\n';
                html += '<td class="data-cell">' + formatTextForExcel(goal.enablers) + '</td>\n';
                html += '</tr>\n';
            }
            
            html += '<tr><td colspan="2" style="height: 10px; border: none;"></td></tr>\n';
        }
        
        html += '<tr><td colspan="2" style="height: 15px; border: none;"></td></tr>\n';
    }
    
    // Execution Section
    if (planData.targetsInitiatives || planData.kpis || planData.strategyMap) {
        html += '<tr>\n';
        html += '<td colspan="2" class="section-header">EXECUTION</td>\n';
        html += '</tr>\n';
        
        if (planData.targetsInitiatives) {
            html += '<tr>\n';
            html += '<td class="label-cell">Targets & Initiatives</td>\n';
            html += '<td class="data-cell">' + formatTextForExcel(planData.targetsInitiatives) + '</td>\n';
            html += '</tr>\n';
        }
        
        if (planData.kpis) {
            html += '<tr>\n';
            html += '<td class="label-cell">Performance Indicators (KPIs)</td>\n';
            html += '<td class="data-cell">' + formatTextForExcel(planData.kpis) + '</td>\n';
            html += '</tr>\n';
        }
        
        if (planData.strategyMap) {
            html += '<tr>\n';
            html += '<td class="label-cell">Strategy Map</td>\n';
            html += '<td class="data-cell">' + formatTextForExcel(planData.strategyMap) + '</td>\n';
            html += '</tr>\n';
        }
        
        html += '<tr><td colspan="2" style="height: 15px; border: none;"></td></tr>\n';
    }
    
    // Review & Monitoring Section
    html += '<tr>\n';
    html += '<td colspan="2" class="section-header">REVIEW & MONITORING</td>\n';
    html += '</tr>\n';
    
    html += '<tr>\n';
    html += '<td class="label-cell">Review Frequency</td>\n';
    html += '<td class="data-cell">' + escapeHtml(planData.reviewFrequency || 'Not specified') + '</td>\n';
    html += '</tr>\n';
    
    if (planData.successCriteria) {
        html += '<tr>\n';
        html += '<td class="label-cell">Success Criteria</td>\n';
        html += '<td class="data-cell">' + formatTextForExcel(planData.successCriteria) + '</td>\n';
        html += '</tr>\n';
    }
    
    if (planData.notes) {
        html += '<tr>\n';
        html += '<td class="label-cell">Additional Notes</td>\n';
        html += '<td class="data-cell">' + formatTextForExcel(planData.notes) + '</td>\n';
        html += '</tr>\n';
    }
    
    html += '</table>\n';
    html += '</body>\n';
    html += '</html>\n';
    
    return html;
}

// Format text for Excel (preserve line breaks)
function formatTextForExcel(text) {
    if (!text) return '';
    var escaped = escapeHtml(text);
    // Convert line breaks to Excel line breaks (Alt+Enter)
    escaped = escaped.replace(/\n/g, '&#10;');
    return escaped;
}

// Load sample data for testing/demonstration
function loadSampleData() {
    // Save current user data before loading sample data
    saveData(); // Ensure current data is saved
    userDataBackup = JSON.parse(JSON.stringify(planData)); // Deep copy current data
    
    // Step 1: Purpose
    planData.businessName = 'TechFlow Solutions';
    planData.userName = 'Sarah Chen, CEO';
    planData.vision = 'To become the leading provider of digital transformation consulting services in the Pacific Northwest, recognized for innovative solutions that help mid-market companies scale efficiently and compete in the digital economy. By 2030, we aim to serve 500+ clients and achieve $50M in annual revenue.';
    planData.values = 'Innovation\nIntegrity\nClient Success\nContinuous Learning\nWork-Life Balance\nDiversity & Inclusion';
    planData.mission = 'TechFlow Solutions exists to empower mid-market businesses with cutting-edge technology solutions and strategic guidance. We bridge the gap between complex technology and business outcomes, helping our clients achieve sustainable growth through digital transformation, cloud migration, and data-driven decision making.';
    
    // Step 3: Mind Map (Business Proponents)
    planData.marketing = 'Target Market: Mid-market companies (50-500 employees) in manufacturing, healthcare, and professional services.\n\nChannels: LinkedIn advertising, industry conferences, content marketing (blog, whitepapers), referral partnerships with accounting firms and business consultants.\n\nStrategy: Thought leadership positioning, case studies, webinars, and free technology assessments.\n\nResponsible: Jennifer Martinez, Marketing Director\n\nGoal: Generate 50 qualified leads per month, maintain 8+ touchpoints with prospects before sales handoff.';
    planData.sales = 'Process: Inbound lead qualification ‚Üí Discovery call ‚Üí Technical assessment ‚Üí Proposal ‚Üí Negotiation ‚Üí Close\n\nApproach: Consultative selling focused on ROI and business outcomes, not just technology features. Average sales cycle: 60-90 days.\n\nResponsible: Michael Thompson, VP of Sales\n\nTeam: 3 account executives, 1 sales engineer\n\nTarget: $2M ARR by end of year, 30% close rate on qualified opportunities.';
    planData.operations = 'Service Delivery: Agile project management, 2-week sprints, dedicated project managers for each engagement\n\nCore Services: Cloud migration (AWS/Azure), custom software development, data analytics implementation, cybersecurity assessments\n\nQuality Assurance: Code reviews, automated testing, client feedback loops, quarterly service reviews\n\nResponsible: David Kim, Director of Operations\n\nTeam: 12 developers, 4 project managers, 2 DevOps engineers\n\nOutsourcing: UI/UX design, specialized security audits, content writing.';
    planData.administration = 'Finance: QuickBooks Online, monthly P&L reviews, quarterly board meetings, annual budget planning\n\nHR: BambooHR for payroll and benefits, 401(k) matching, professional development budget ($2K per employee annually)\n\nIT Infrastructure: Microsoft 365, Slack, Jira, GitHub Enterprise, AWS for hosting\n\nLegal: Outside counsel for contracts, annual compliance review\n\nResponsible: Operations team with CEO oversight\n\nSystems: All processes documented in Notion, can operate 2+ weeks without CEO presence, scalable to 50 employees without major restructuring.';
    
    // Step 4: SWOT Analysis
    planData.strengths = '‚Ä¢ Deep technical expertise in cloud architecture and modern development practices\n‚Ä¢ Strong client relationships with 95% retention rate\n‚Ä¢ Agile, adaptable team culture that responds quickly to market changes\n‚Ä¢ Proven track record: 50+ successful implementations in past 3 years\n‚Ä¢ Strong brand reputation in local market\n‚Ä¢ Diverse skill set across team (full-stack, DevOps, data, security)';
    planData.weaknesses = '‚Ä¢ Limited brand recognition outside Pacific Northwest\n‚Ä¢ Heavy reliance on key personnel (3 senior engineers handle 60% of complex projects)\n‚Ä¢ Limited marketing budget compared to larger competitors\n‚Ä¢ No dedicated sales team until recently (CEO was primary salesperson)\n‚Ä¢ Limited experience with enterprise clients (500+ employees)\n‚Ä¢ Cash flow challenges during slow months (seasonal business)';
    planData.opportunities = '‚Ä¢ Growing demand for digital transformation post-COVID\n‚Ä¢ Partnership opportunities with Microsoft and AWS (can become certified partner)\n‚Ä¢ Emerging AI/ML market - clients asking about implementation\n‚Ä¢ Remote work trend allows us to serve clients nationwide\n‚Ä¢ Government contracts (small business set-asides)\n‚Ä¢ Acquisition of smaller consulting firms in adjacent markets\n‚Ä¢ Industry-specific solutions (healthcare compliance, manufacturing automation)';
    planData.threats = '‚Ä¢ Large consulting firms (Deloitte, Accenture) entering mid-market space with lower prices\n‚Ä¢ Economic downturn could reduce client IT budgets\n‚Ä¢ Talent shortage in tech industry - difficult to hire senior engineers\n‚Ä¢ Rapid technology changes require constant training investment\n‚Ä¢ Client concentration risk (top 3 clients = 40% of revenue)\n‚Ä¢ Cybersecurity threats to our own infrastructure and client systems';
    
    // Step 5: Strategy - Goals
    planData.goals = [
        {
            title: 'Achieve $5M Annual Recurring Revenue',
            timeline: '3-year',
            strategicIntent: 'Leverage our strengths in cloud migration and client relationships while addressing weaknesses in sales capacity and geographic reach. Focus on expanding service offerings (AI/ML, cybersecurity) and building strategic partnerships to access new markets.',
            drivers: '1. Hire 2 additional senior sales executives\n2. Launch AI/ML consulting practice\n3. Establish AWS and Microsoft partner status\n4. Develop 3 industry-specific solution packages\n5. Expand marketing budget by 150%',
            enablers: '‚Ä¢ Salesforce CRM implementation\n‚Ä¢ Marketing automation platform (HubSpot)\n‚Ä¢ Enhanced project management tools\n‚Ä¢ Employee training program for AI/ML\n‚Ä¢ Strategic partnership framework\n‚Ä¢ $2M working capital line of credit'
        },
        {
            title: 'Build Scalable Operations Infrastructure',
            timeline: '1-year',
            strategicIntent: 'Address operational weaknesses by creating systems and processes that reduce dependency on key personnel. Implement standardized methodologies, knowledge management systems, and cross-training programs.',
            drivers: '1. Document all service delivery processes\n2. Implement knowledge base and internal wiki\n3. Cross-train team members on critical skills\n4. Establish quality assurance checkpoints\n5. Create client onboarding playbook',
            enablers: '‚Ä¢ Notion for documentation\n‚Ä¢ Standardized project templates\n‚Ä¢ Weekly team training sessions\n‚Ä¢ Quality metrics dashboard\n‚Ä¢ Client feedback system'
        },
        {
            title: 'Expand Geographic Reach',
            timeline: '2-year',
            strategicIntent: 'Capitalize on remote work trend and partnership opportunities to serve clients beyond Pacific Northwest. Use virtual delivery model and strategic partnerships to enter new markets without physical presence.',
            drivers: '1. Develop remote delivery capabilities\n2. Partner with regional business consultants\n3. Create virtual workshop and assessment offerings\n4. Target 3 new geographic markets\n5. Build case studies from remote engagements',
            enablers: '‚Ä¢ Video conferencing infrastructure\n‚Ä¢ Remote collaboration tools\n‚Ä¢ Partnership agreement templates\n‚Ä¢ Marketing materials for new markets\n‚Ä¢ Virtual delivery methodology'
        }
    ];
    
    // Step 6: Execution
    planData.targetsInitiatives = 'Q1 Targets:\n‚Ä¢ Hire 1 senior sales executive\n‚Ä¢ Complete AWS partner application\n‚Ä¢ Launch 2 new service offerings (AI assessment, security audit)\n‚Ä¢ Achieve $400K quarterly revenue\n‚Ä¢ Onboard 8 new clients\n\nQ2 Targets:\n‚Ä¢ Hire second sales executive\n‚Ä¢ Complete Microsoft partner application\n‚Ä¢ Develop healthcare industry solution package\n‚Ä¢ Achieve $500K quarterly revenue\n‚Ä¢ Implement Salesforce CRM\n\nQ3-Q4 Targets:\n‚Ä¢ Launch AI/ML consulting practice\n‚Ä¢ Establish 2 strategic partnerships\n‚Ä¢ Enter 1 new geographic market\n‚Ä¢ Achieve $600K+ quarterly revenue\n‚Ä¢ Reduce client concentration risk (top 3 clients < 30% of revenue)';
    planData.kpis = 'Revenue Metrics:\n‚Ä¢ Monthly Recurring Revenue (MRR)\n‚Ä¢ Annual Recurring Revenue (ARR)\n‚Ä¢ Revenue per client\n‚Ä¢ Revenue growth rate (target: 40% YoY)\n\nSales Metrics:\n‚Ä¢ Lead conversion rate (target: 30%)\n‚Ä¢ Average sales cycle length (target: 60 days)\n‚Ä¢ Sales pipeline value\n‚Ä¢ New client acquisition rate (target: 8-10 per quarter)\n\nOperational Metrics:\n‚Ä¢ Project delivery on-time rate (target: 90%)\n‚Ä¢ Client satisfaction score (target: 4.5/5)\n‚Ä¢ Employee utilization rate (target: 75%)\n‚Ä¢ Billable hours per employee\n\nFinancial Metrics:\n‚Ä¢ Gross margin (target: 65%)\n‚Ä¢ Operating margin (target: 20%)\n‚Ä¢ Cash runway (target: 6+ months)\n‚Ä¢ Days sales outstanding (target: < 45 days)';
    planData.strategyMap = 'Communication Strategy:\n‚Ä¢ Monthly all-hands meeting to review progress on strategic goals\n‚Ä¢ Quarterly board meetings with key stakeholders\n‚Ä¢ Weekly leadership team check-ins\n‚Ä¢ Client quarterly business reviews\n‚Ä¢ Annual strategic planning retreat\n\nTesting & Validation:\n‚Ä¢ Monthly KPI dashboard review\n‚Ä¢ Quarterly strategy review and adjustment\n‚Ä¢ Annual comprehensive strategic plan update\n‚Ä¢ Client feedback surveys (quarterly)\n‚Ä¢ Employee engagement surveys (biannually)\n‚Ä¢ Competitive analysis (quarterly)\n\nSuccess Metrics:\n‚Ä¢ Track progress against KPIs monthly\n‚Ä¢ Review goal achievement quarterly\n‚Ä¢ Adjust tactics based on market feedback\n‚Ä¢ Celebrate wins and learn from failures';
    
    // Step 7: Review & Monitoring
    planData.reviewFrequency = 'quarterly';
    planData.successCriteria = 'Year 1 Success Criteria:\n‚Ä¢ Achieve $2M ARR\n‚Ä¢ Maintain 95%+ client retention\n‚Ä¢ Hire 5 new team members\n‚Ä¢ Launch 2 new service offerings\n‚Ä¢ Establish 1 strategic partnership\n‚Ä¢ Achieve 4.5+ client satisfaction score\n\nYear 2-3 Success Criteria:\n‚Ä¢ Achieve $5M ARR\n‚Ä¢ Serve 100+ active clients\n‚Ä¢ Expand to 2 new geographic markets\n‚Ä¢ Build team to 30+ employees\n‚Ä¢ Achieve 20%+ operating margin\n‚Ä¢ Establish thought leadership in 2 industry verticals';
    planData.notes = 'Key Considerations:\n‚Ä¢ Monitor economic indicators closely - be prepared to pivot if recession impacts client budgets\n‚Ä¢ Invest in employee retention - competitive salaries and strong culture are critical in tight labor market\n‚Ä¢ Maintain focus on quality over quantity - better to have fewer high-value clients than many low-margin ones\n‚Ä¢ Build cash reserves during strong quarters to weather slow periods\n‚Ä¢ Stay current on technology trends - allocate 10% of time to learning and experimentation\n‚Ä¢ Consider acquisition opportunities if they accelerate strategic goals\n\nRisk Mitigation:\n‚Ä¢ Diversify client base to reduce concentration risk\n‚Ä¢ Build bench strength to reduce key person dependency\n‚Ä¢ Maintain strong banking relationships for working capital access\n‚Ä¢ Invest in cybersecurity to protect client data and our reputation';
    
    // Populate the form
    populateForm();
    
    // Update UI
    updateStepCompletion();
    updateProgress();
    setupCharacterCounts();
    
    // Show "Your Data" button
    showYourDataButton();
    
    // Show confirmation
    alert('Sample data loaded! This demonstrates a complete strategic plan for TechFlow Solutions, a tech consulting business.');
}

// Restore user's original data
function restoreUserData() {
    if (!userDataBackup) {
        // No backup means user hasn't entered anything, so clear the form
        clearForm();
    } else {
        // Restore the user's data
        planData = JSON.parse(JSON.stringify(userDataBackup)); // Deep copy backup
        userDataBackup = null; // Clear backup
        
        // Populate the form with user's data
        populateForm();
    }
    
    // Update UI
    updateStepCompletion();
    updateProgress();
    setupCharacterCounts();
    
    // Hide "Your data" button and show "Load Sample Data" button
    var sampleDataBtn = document.querySelector('button[onclick="loadSampleData()"]');
    var yourDataBtnContainer = document.getElementById('yourDataButtonContainer');
    
    if (sampleDataBtn) {
        sampleDataBtn.style.display = 'inline-block';
    }
    
    if (yourDataBtnContainer) {
        yourDataBtnContainer.style.display = 'none';
    }
    
    // Save restored/cleared data
    saveData();
}

// ============================================
// PHASE 1 & 2: EDUCATIONAL FEATURES
// ============================================

// Template Library Data
const templates = [
    {
        name: 'Tech Consulting Business',
        description: 'Complete strategic plan for a technology consulting company',
        data: null // Will use loadSampleData function
    },
    {
        name: 'E-commerce Startup',
        description: 'Strategic plan for an online retail business',
        data: {
            businessName: 'ShopSmart Online',
            userName: 'Alex Johnson, Founder',
            vision: 'To become the leading online marketplace for sustainable consumer products in North America, serving 1 million customers by 2027.',
            values: 'Sustainability\nCustomer First\nInnovation\nTransparency\nCommunity Impact',
            mission: 'ShopSmart Online exists to make sustainable shopping accessible and affordable for everyone. We connect conscious consumers with ethical brands, making it easy to make a positive impact with every purchase.',
            marketing: 'Target Market: Environmentally conscious consumers aged 25-45, primarily in urban areas.\n\nChannels: Social media marketing (Instagram, TikTok), influencer partnerships, content marketing, SEO.\n\nStrategy: Build brand through storytelling, showcase impact, leverage user-generated content.\n\nResponsible: Marketing Team\n\nGoal: 50,000 active customers by end of year.',
            sales: 'Process: Website traffic ‚Üí Product discovery ‚Üí Add to cart ‚Üí Checkout\n\nApproach: Low-friction shopping experience, subscription model for repeat customers.\n\nResponsible: E-commerce Team\n\nTarget: $5M revenue in first year, 20% repeat customer rate.',
            operations: 'Service Delivery: Direct-to-consumer e-commerce, fulfillment through third-party logistics.\n\nCore Services: Online marketplace, product curation, customer support.\n\nQuality Assurance: Product quality checks, customer reviews, return policy.\n\nResponsible: Operations Manager\n\nTeam: 5 employees, outsourced fulfillment.',
            administration: 'Finance: QuickBooks, monthly financial reviews.\n\nHR: Basic payroll, benefits for full-time employees.\n\nIT Infrastructure: Shopify, Stripe, email marketing platform.\n\nResponsible: Founder with support from advisors.',
            strengths: '‚Ä¢ Strong brand positioning in sustainability market\n‚Ä¢ Curated product selection\n‚Ä¢ Growing consumer demand for sustainable products\n‚Ä¢ Efficient fulfillment partnerships',
            weaknesses: '‚Ä¢ Limited brand awareness\n‚Ä¢ Small team with limited resources\n‚Ä¢ Competition from established e-commerce platforms\n‚Ä¢ High customer acquisition costs',
            opportunities: '‚Ä¢ Growing sustainability trend\n‚Ä¢ Partnership opportunities with eco-brands\n‚Ä¢ Expansion into new product categories\n‚Ä¢ B2B sales to corporate clients',
            threats: '‚Ä¢ Large e-commerce players entering market\n‚Ä¢ Economic downturn affecting discretionary spending\n‚Ä¢ Supply chain disruptions\n‚Ä¢ Changing consumer preferences',
            goals: [
                {
                    title: 'Achieve $5M Annual Revenue',
                    timeline: '1-year',
                    strategicIntent: 'Build brand awareness and customer base through marketing and partnerships.',
                    drivers: '1. Launch marketing campaign\n2. Partner with 50 sustainable brands\n3. Optimize conversion funnel\n4. Implement subscription model',
                    enablers: '‚Ä¢ Marketing budget\n‚Ä¢ E-commerce platform\n‚Ä¢ Fulfillment partnerships\n‚Ä¢ Customer service tools'
                }
            ],
            targetsInitiatives: 'Q1: Launch marketing campaign, onboard 20 brands\nQ2: Reach 10,000 customers, optimize conversion\nQ3: Launch subscription program, expand product categories\nQ4: Achieve profitability, plan expansion',
            kpis: 'Revenue: Monthly revenue, revenue per customer\nSales: Conversion rate, average order value\nOperations: Order fulfillment time, customer satisfaction\nMarketing: Customer acquisition cost, lifetime value',
            strategyMap: 'Monthly team meetings\nQuarterly strategy reviews\nAnnual planning session\nCustomer feedback surveys',
            reviewFrequency: 'monthly',
            successCriteria: 'Year 1: $5M revenue, 50K customers, profitability\nYear 2: $15M revenue, 150K customers, expand to new markets',
            notes: 'Focus on building brand and customer loyalty. Monitor cash flow closely.'
        }
    },
    {
        name: 'Healthcare Practice',
        description: 'Strategic plan for a medical practice',
        data: {
            businessName: 'Wellness Medical Group',
            userName: 'Dr. Sarah Martinez, Medical Director',
            vision: 'To be the premier primary care practice in our community, known for exceptional patient care, innovative treatment approaches, and comprehensive wellness programs.',
            values: 'Patient-Centered Care\nExcellence\nCompassion\nInnovation\nCommunity Health',
            mission: 'Wellness Medical Group provides comprehensive, compassionate healthcare that empowers patients to achieve optimal health and wellness. We combine evidence-based medicine with personalized care to improve lives.',
            marketing: 'Target Market: Families and individuals in local community, ages 0-65+\n\nChannels: Community events, local advertising, patient referrals, online presence.\n\nStrategy: Build reputation through excellent care, community involvement, patient testimonials.\n\nResponsible: Practice Manager\n\nGoal: 2,000 active patients by end of year.',
            sales: 'Process: Patient inquiry ‚Üí Appointment scheduling ‚Üí Initial visit ‚Üí Treatment plan\n\nApproach: Patient-focused, relationship-based care.\n\nResponsible: Front office staff\n\nTarget: 50 new patients per month.',
            operations: 'Service Delivery: In-person and telehealth appointments, preventive care, chronic disease management.\n\nCore Services: Primary care, wellness programs, health screenings.\n\nQuality Assurance: Clinical protocols, patient satisfaction surveys, quality metrics.\n\nResponsible: Medical Director\n\nTeam: 3 physicians, 2 nurse practitioners, support staff.',
            administration: 'Finance: Medical billing system, insurance processing.\n\nHR: Employee benefits, credentialing, compliance.\n\nIT Infrastructure: Electronic health records, patient portal, scheduling system.\n\nResponsible: Practice Administrator',
            strengths: '‚Ä¢ Experienced medical team\n‚Ä¢ Strong community reputation\n‚Ä¢ Comprehensive services\n‚Ä¢ Modern facilities and technology',
            weaknesses: '‚Ä¢ Limited appointment availability\n‚Ä¢ High overhead costs\n‚Ä¢ Insurance reimbursement challenges\n‚Ä¢ Staffing shortages in healthcare',
            opportunities: '‚Ä¢ Growing patient population\n‚Ä¢ Telehealth expansion\n‚Ä¢ Wellness program development\n‚Ä¢ Partnership with specialists',
            threats: '‚Ä¢ Healthcare policy changes\n‚Ä¢ Competition from larger health systems\n‚Ä¢ Rising costs\n‚Ä¢ Regulatory compliance requirements',
            goals: [
                {
                    title: 'Expand Patient Capacity',
                    timeline: '1-year',
                    strategicIntent: 'Increase access to care while maintaining quality.',
                    drivers: '1. Hire additional providers\n2. Optimize scheduling\n3. Expand telehealth services\n4. Improve patient flow',
                    enablers: '‚Ä¢ Recruitment budget\n‚Ä¢ Technology upgrades\n‚Ä¢ Staff training\n‚Ä¢ Facility expansion if needed'
                }
            ],
            targetsInitiatives: 'Q1: Hire 1 additional provider, optimize scheduling\nQ2: Launch telehealth program, improve patient flow\nQ3: Expand wellness programs, community outreach\nQ4: Evaluate expansion opportunities',
            kpis: 'Patient Care: Patient satisfaction, appointment availability\nOperations: Patient volume, revenue per patient\nQuality: Clinical outcomes, preventive care metrics\nFinancial: Revenue, collections rate',
            strategyMap: 'Monthly provider meetings\nQuarterly quality reviews\nAnnual strategic planning\nPatient satisfaction surveys',
            reviewFrequency: 'monthly',
            successCriteria: 'Year 1: 2,000 active patients, 4.5+ satisfaction, financial stability\nYear 2: Expand services, improve outcomes, community impact',
            notes: 'Focus on patient care quality and satisfaction. Monitor regulatory changes.'
        }
    }
];

// Examples Mode Data
let examplesModeActive = false;
const examplePlanData = {
    businessName: 'TechFlow Solutions',
    userName: 'Sarah Chen, CEO',
    vision: 'To become the leading provider of digital transformation consulting services in the Pacific Northwest, recognized for innovative solutions that help mid-market companies scale efficiently and compete in the digital economy. By 2030, we aim to serve 500+ clients and achieve $50M in annual revenue.',
    values: 'Innovation\nIntegrity\nClient Success\nContinuous Learning\nWork-Life Balance\nDiversity & Inclusion',
    mission: 'TechFlow Solutions exists to empower mid-market businesses with cutting-edge technology solutions and strategic guidance. We bridge the gap between complex technology and business outcomes, helping our clients achieve sustainable growth through digital transformation, cloud migration, and data-driven decision making.',
    marketing: 'Target Market: Mid-market companies (50-500 employees) in manufacturing, healthcare, and professional services.\n\nChannels: LinkedIn advertising, industry conferences, content marketing (blog, whitepapers), referral partnerships with accounting firms and business consultants.\n\nStrategy: Thought leadership positioning, case studies, webinars, and free technology assessments.\n\nResponsible: Jennifer Martinez, Marketing Director\n\nGoal: Generate 50 qualified leads per month, maintain 8+ touchpoints with prospects before sales handoff.',
    sales: 'Process: Inbound lead qualification ‚Üí Discovery call ‚Üí Technical assessment ‚Üí Proposal ‚Üí Negotiation ‚Üí Close\n\nApproach: Consultative selling focused on ROI and business outcomes, not just technology features. Average sales cycle: 60-90 days.\n\nResponsible: Michael Thompson, VP of Sales\n\nTeam: 3 account executives, 1 sales engineer\n\nTarget: $2M ARR by end of year, 30% close rate on qualified opportunities.',
    operations: 'Service Delivery: Agile project management, 2-week sprints, dedicated project managers for each engagement\n\nCore Services: Cloud migration (AWS/Azure), custom software development, data analytics implementation, cybersecurity assessments\n\nQuality Assurance: Code reviews, automated testing, client feedback loops, quarterly service reviews\n\nResponsible: David Kim, Director of Operations\n\nTeam: 12 developers, 4 project managers, 2 DevOps engineers\n\nOutsourcing: UI/UX design, specialized security audits, content writing.',
    administration: 'Finance: QuickBooks Online, monthly P&L reviews, quarterly board meetings, annual budget planning\n\nHR: BambooHR for payroll and benefits, 401(k) matching, professional development budget ($2K per employee annually)\n\nIT Infrastructure: Microsoft 365, Slack, Jira, GitHub Enterprise, AWS for hosting\n\nLegal: Outside counsel for contracts, annual compliance review\n\nResponsible: Operations team with CEO oversight\n\nSystems: All processes documented in Notion, can operate 2+ weeks without CEO presence, scalable to 50 employees without major restructuring.',
    strengths: '‚Ä¢ Deep technical expertise in cloud architecture and modern development practices\n‚Ä¢ Strong client relationships with 95% retention rate\n‚Ä¢ Agile, adaptable team culture that responds quickly to market changes\n‚Ä¢ Proven track record: 50+ successful implementations in past 3 years\n‚Ä¢ Strong brand reputation in local market\n‚Ä¢ Diverse skill set across team (full-stack, DevOps, data, security)',
    weaknesses: '‚Ä¢ Limited brand recognition outside Pacific Northwest\n‚Ä¢ Heavy reliance on key personnel (3 senior engineers handle 60% of complex projects)\n‚Ä¢ Limited marketing budget compared to larger competitors\n‚Ä¢ No dedicated sales team until recently (CEO was primary salesperson)\n‚Ä¢ Limited experience with enterprise clients (500+ employees)\n‚Ä¢ Cash flow challenges during slow months (seasonal business)',
    opportunities: '‚Ä¢ Growing demand for digital transformation post-COVID\n‚Ä¢ Partnership opportunities with Microsoft and AWS (can become certified partner)\n‚Ä¢ Emerging AI/ML market - clients asking about implementation\n‚Ä¢ Remote work trend allows us to serve clients nationwide\n‚Ä¢ Government contracts (small business set-asides)\n‚Ä¢ Acquisition of smaller consulting firms in adjacent markets\n‚Ä¢ Industry-specific solutions (healthcare compliance, manufacturing automation)',
    threats: '‚Ä¢ Large consulting firms (Deloitte, Accenture) entering mid-market space with lower prices\n‚Ä¢ Economic downturn could reduce client IT budgets\n‚Ä¢ Talent shortage in tech industry - difficult to hire senior engineers\n‚Ä¢ Rapid technology changes require constant training investment\n‚Ä¢ Client concentration risk (top 3 clients = 40% of revenue)\n‚Ä¢ Cybersecurity threats to our own infrastructure and client systems',
    goals: [
        {
            title: 'Achieve $5M Annual Recurring Revenue',
            timeline: '3-year',
            strategicIntent: 'Leverage our strengths in cloud migration and client relationships while addressing weaknesses in sales capacity and geographic reach. Focus on expanding service offerings (AI/ML, cybersecurity) and building strategic partnerships to access new markets.',
            drivers: '1. Hire 2 additional senior sales executives\n2. Launch AI/ML consulting practice\n3. Establish AWS and Microsoft partner status\n4. Develop 3 industry-specific solution packages\n5. Expand marketing budget by 150%',
            enablers: '‚Ä¢ Salesforce CRM implementation\n‚Ä¢ Marketing automation platform (HubSpot)\n‚Ä¢ Enhanced project management tools\n‚Ä¢ Employee training program for AI/ML\n‚Ä¢ Strategic partnership framework\n‚Ä¢ $2M working capital line of credit'
        },
        {
            title: 'Build Scalable Operations Infrastructure',
            timeline: '1-year',
            strategicIntent: 'Address operational weaknesses by creating systems and processes that reduce dependency on key personnel. Implement standardized methodologies, knowledge management systems, and cross-training programs.',
            drivers: '1. Document all service delivery processes\n2. Implement knowledge base and internal wiki\n3. Cross-train team members on critical skills\n4. Establish quality assurance checkpoints\n5. Create client onboarding playbook',
            enablers: '‚Ä¢ Notion for documentation\n‚Ä¢ Standardized project templates\n‚Ä¢ Weekly team training sessions\n‚Ä¢ Quality metrics dashboard\n‚Ä¢ Client feedback system'
        }
    ],
    targetsInitiatives: 'Q1 Targets:\n‚Ä¢ Hire 1 senior sales executive\n‚Ä¢ Complete AWS partner application\n‚Ä¢ Launch 2 new service offerings (AI assessment, security audit)\n‚Ä¢ Achieve $400K quarterly revenue\n‚Ä¢ Onboard 8 new clients\n\nQ2 Targets:\n‚Ä¢ Hire second sales executive\n‚Ä¢ Complete Microsoft partner application\n‚Ä¢ Develop healthcare industry solution package\n‚Ä¢ Achieve $500K quarterly revenue\n‚Ä¢ Implement Salesforce CRM\n\nQ3-Q4 Targets:\n‚Ä¢ Launch AI/ML consulting practice\n‚Ä¢ Establish 2 strategic partnerships\n‚Ä¢ Enter 1 new geographic market\n‚Ä¢ Achieve $600K+ quarterly revenue\n‚Ä¢ Reduce client concentration risk (top 3 clients < 30% of revenue)',
    kpis: 'Revenue Metrics:\n‚Ä¢ Monthly Recurring Revenue (MRR)\n‚Ä¢ Annual Recurring Revenue (ARR)\n‚Ä¢ Revenue per client\n‚Ä¢ Revenue growth rate (target: 40% YoY)\n\nSales Metrics:\n‚Ä¢ Lead conversion rate (target: 30%)\n‚Ä¢ Average sales cycle length (target: 60 days)\n‚Ä¢ Sales pipeline value\n‚Ä¢ New client acquisition rate (target: 8-10 per quarter)\n\nOperational Metrics:\n‚Ä¢ Project delivery on-time rate (target: 90%)\n‚Ä¢ Client satisfaction score (target: 4.5/5)\n‚Ä¢ Employee utilization rate (target: 75%)\n‚Ä¢ Billable hours per employee\n\nFinancial Metrics:\n‚Ä¢ Gross margin (target: 65%)\n‚Ä¢ Operating margin (target: 20%)\n‚Ä¢ Cash runway (target: 6+ months)\n‚Ä¢ Days sales outstanding (target: < 45 days)',
    strategyMap: 'Communication Strategy:\n‚Ä¢ Monthly all-hands meeting to review progress on strategic goals\n‚Ä¢ Quarterly board meetings with key stakeholders\n‚Ä¢ Weekly leadership team check-ins\n‚Ä¢ Client quarterly business reviews\n‚Ä¢ Annual strategic planning retreat\n\nTesting & Validation:\n‚Ä¢ Monthly KPI dashboard review\n‚Ä¢ Quarterly strategy review and adjustment\n‚Ä¢ Annual comprehensive strategic plan update\n‚Ä¢ Client feedback surveys (quarterly)\n‚Ä¢ Employee engagement surveys (biannually)\n‚Ä¢ Competitive analysis (quarterly)\n\nSuccess Metrics:\n‚Ä¢ Track progress against KPIs monthly\n‚Ä¢ Review goal achievement quarterly\n‚Ä¢ Adjust tactics based on market feedback\n‚Ä¢ Celebrate wins and learn from failures',
    reviewFrequency: 'quarterly',
    successCriteria: 'Year 1 Success Criteria:\n‚Ä¢ Achieve $2M ARR\n‚Ä¢ Maintain 95%+ client retention\n‚Ä¢ Hire 5 new team members\n‚Ä¢ Launch 2 new service offerings\n‚Ä¢ Establish 1 strategic partnership\n‚Ä¢ Achieve 4.5+ client satisfaction score\n\nYear 2-3 Success Criteria:\n‚Ä¢ Achieve $5M ARR\n‚Ä¢ Serve 100+ active clients\n‚Ä¢ Expand to 2 new geographic markets\n‚Ä¢ Build team to 30+ employees\n‚Ä¢ Achieve 20%+ operating margin\n‚Ä¢ Establish thought leadership in 2 industry verticals',
    notes: 'Key Considerations:\n‚Ä¢ Monitor economic indicators closely - be prepared to pivot if recession impacts client budgets\n‚Ä¢ Invest in employee retention - competitive salaries and strong culture are critical in tight labor market\n‚Ä¢ Maintain focus on quality over quantity - better to have fewer high-value clients than many low-margin ones\n‚Ä¢ Build cash reserves during strong quarters to weather slow periods\n‚Ä¢ Stay current on technology trends - allocate 10% of time to learning and experimentation\n‚Ä¢ Consider acquisition opportunities if they accelerate strategic goals\n\nRisk Mitigation:\n‚Ä¢ Diversify client base to reduce concentration risk\n‚Ä¢ Build bench strength to reduce key person dependency\n‚Ä¢ Maintain strong banking relationships for working capital access\n‚Ä¢ Invest in cybersecurity to protect client data and our reputation'
};

// Template Library Functions
function showTemplateLibrary() {
    const modal = document.getElementById('templateLibrary');
    const list = document.getElementById('templateList');
    
    if (!modal || !list) return;

    list.innerHTML = '';
    templates.forEach((template, index) => {
        const item = document.createElement('div');
        item.className = 'template-item';
        item.innerHTML = `
            <h5>${template.name}</h5>
            <p>${template.description}</p>
        `;
        item.onclick = () => loadTemplate(index);
        list.appendChild(item);
    });

    modal.classList.add('show');
}

function closeTemplateLibrary(event) {
    if (event && event.target !== event.currentTarget) return;
    const modal = document.getElementById('templateLibrary');
    if (modal) {
        modal.classList.remove('show');
    }
}

function loadTemplate(index) {
    const template = templates[index];
    if (!template) return;

    if (confirm(`Load "${template.name}" template? This will replace your current data.`)) {
        // Save current user data before loading template
        saveData();
        userDataBackup = JSON.parse(JSON.stringify(planData));
        
        if (index === 0) {
            // First template uses the existing loadSampleData function
            loadSampleData();
        } else {
            // Other templates use their own data
            planData = JSON.parse(JSON.stringify(template.data));
            populateForm();
            updateStepCompletion();
            updateProgress();
            setupCharacterCounts();
            saveData();
        }
        
        closeTemplateLibrary();
        showYourDataButton();
    }
}

function showYourDataButton() {
    const container = document.getElementById('yourDataButtonContainer');
    if (container) {
        container.innerHTML = '<button onclick="restoreUserData()" style="background: #28a745; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: 600;">Your Data</button>';
        container.style.display = 'block';
    }
}

// Examples Mode Functions
function toggleExamplesMode() {
    examplesModeActive = !examplesModeActive;
    const overlay = document.getElementById('examplesModeOverlay');
    const btn = document.getElementById('examplesModeBtn');
    
    if (examplesModeActive) {
        overlay.classList.add('show');
        btn.textContent = '‚úñÔ∏è Hide Examples';
        renderExamplesMode();
    } else {
        overlay.classList.remove('show');
        btn.textContent = 'üëÅÔ∏è View Examples';
    }
}

function renderExamplesMode() {
    const content = document.getElementById('examplesModeContent');
    if (!content) return;
    
    let html = '<div style="max-width: 1000px; margin: 0 auto;">';
    
    // Step 1: Purpose
    html += '<div class="example-section"><h4>Step 1: Define Your Purpose</h4>';
    html += `<div class="example-card"><strong>Business Name:</strong> ${examplePlanData.businessName}</div>`;
    html += `<div class="example-card"><strong>Vision:</strong> ${examplePlanData.vision}</div>`;
    html += `<div class="example-card"><strong>Values:</strong> ${examplePlanData.values.replace(/\n/g, '<br>')}</div>`;
    html += `<div class="example-card"><strong>Mission:</strong> ${examplePlanData.mission}</div>`;
    html += '</div>';
    
    // Step 2: Business Proponents
    html += '<div class="example-section"><h4>Step 2: Business Proponents</h4>';
    html += `<div class="example-card"><strong>Marketing:</strong> ${examplePlanData.marketing.replace(/\n/g, '<br>')}</div>`;
    html += `<div class="example-card"><strong>Sales:</strong> ${examplePlanData.sales.replace(/\n/g, '<br>')}</div>`;
    html += `<div class="example-card"><strong>Operations:</strong> ${examplePlanData.operations.replace(/\n/g, '<br>')}</div>`;
    html += `<div class="example-card"><strong>Administration:</strong> ${examplePlanData.administration.replace(/\n/g, '<br>')}</div>`;
    html += '</div>';
    
    // Step 4: SWOT
    html += '<div class="example-section"><h4>Step 4: SWOT Analysis</h4>';
    html += `<div class="example-card"><strong>Strengths:</strong> ${examplePlanData.strengths.replace(/\n/g, '<br>')}</div>`;
    html += `<div class="example-card"><strong>Weaknesses:</strong> ${examplePlanData.weaknesses.replace(/\n/g, '<br>')}</div>`;
    html += `<div class="example-card"><strong>Opportunities:</strong> ${examplePlanData.opportunities.replace(/\n/g, '<br>')}</div>`;
    html += `<div class="example-card"><strong>Threats:</strong> ${examplePlanData.threats.replace(/\n/g, '<br>')}</div>`;
    html += '</div>';
    
    // Step 5: Strategy
    html += '<div class="example-section"><h4>Step 5: Develop Strategy</h4>';
    examplePlanData.goals.forEach((goal, idx) => {
        html += `<div class="example-card"><strong>Goal ${idx + 1}:</strong> ${goal.title}<br><strong>Strategic Intent:</strong> ${goal.strategicIntent}</div>`;
    });
    html += '</div>';
    
    // Step 6: Execution
    html += '<div class="example-section"><h4>Step 6: Plan Execution</h4>';
    html += `<div class="example-card"><strong>Targets & Initiatives:</strong> ${examplePlanData.targetsInitiatives.replace(/\n/g, '<br>')}</div>`;
    html += `<div class="example-card"><strong>KPIs:</strong> ${examplePlanData.kpis.replace(/\n/g, '<br>')}</div>`;
    html += '</div>';
    
    // Step 7: Review
    html += '<div class="example-section"><h4>Step 7: Review & Complete</h4>';
    html += `<div class="example-card"><strong>Review Frequency:</strong> ${examplePlanData.reviewFrequency}</div>`;
    html += `<div class="example-card"><strong>Success Criteria:</strong> ${examplePlanData.successCriteria.replace(/\n/g, '<br>')}</div>`;
    html += '</div>';
    
    html += '</div>';
    content.innerHTML = html;
}

// Learn Menu Functions
function showLearnMenu() {
    document.getElementById('learnMenu').classList.add('show');
}

function closeLearnMenu(event) {
    if (event && event.target !== event.currentTarget) return;
    document.getElementById('learnMenu').classList.remove('show');
    hideLearnContent();
}

// Video Links for Educational Content (HBR prioritized, with basic options)
const videoLinks = {
    'guide-overview': {
        url: 'https://www.youtube.com/watch?v=NcWzeUNobks',
        description: 'Harvard Business Review: Strategic insights on planning and strategy - Learn the critical distinction between planning and strategy from HBR.',
        hbrCreator: 'Harvard Business Review',
        basicUrl: '',
        basicDescription: '',
        basicCreator: ''
    },
    'guide-step1': {
        url: 'https://www.youtube.com/watch?v=dbiNhAZlXZk',
        description: 'Harvard Business Review: "Use Strategic Thinking to Create the Life You Want" - Learn how to apply strategic thinking to define your vision and purpose.',
        hbrCreator: 'Harvard Business Review',
        basicUrl: 'https://www.youtube.com/watch?v=NcWzeUNobks',
        basicDescription: 'Basic Tutorial: Defining your purpose (vision, mission, and values).',
        basicCreator: 'YouTube Creator'
    },
    'guide-step4': {
        url: 'https://www.youtube.com/watch?v=mR9eICQJLXA',
        description: 'Learn how to conduct a comprehensive SWOT analysis with practical examples and step-by-step guidance.',
        hbrCreator: 'Virtual Strategist',
        basicUrl: 'https://www.youtube.com/watch?v=I_6AVRGLXGA',
        basicDescription: 'Basic Tutorial: Simple step-by-step guide to performing a SWOT analysis for beginners.',
        basicCreator: 'B2U - Business To You',
        swotVideo: {
            url: 'https://www.youtube.com/watch?v=mR9eICQJLXA',
            description: 'Learn how to conduct a comprehensive SWOT analysis with practical examples and step-by-step guidance.',
            creator: 'Virtual Strategist'
        }
    },
    'guide-step5': {
        url: 'https://www.youtube.com/watch?v=iuYlGRnC7J8',
        description: 'Harvard Business Review: Learn how to develop effective strategies and make integrative choices for competitive advantage.',
        hbrCreator: 'Harvard Business Review',
        basicUrl: 'https://www.youtube.com/watch?v=HQ6348u6o08',
        basicDescription: 'Basic Tutorial: How to translate your SWOT analysis into actionable strategic goals.',
        basicCreator: 'GreggU'
    }
};

const learnContent = {
    'guide-overview': {
        title: 'What is Strategic Planning?',
        content: `
            <h3>What is Strategic Planning?</h3>
            <p>Strategic planning is a systematic process for defining an organization's direction and making decisions about allocating resources to pursue that direction. It involves setting goals, determining actions to achieve those goals, and mobilizing resources to execute the actions.</p>
            <div class="example-box">
                <strong>Key Benefits:</strong>
                <ul>
                    <li>Provides clear direction and focus</li>
                    <li>Aligns team efforts toward common goals</li>
                    <li>Helps prioritize resources and initiatives</li>
                    <li>Enables proactive rather than reactive decision-making</li>
                    <li>Improves communication and coordination</li>
                </ul>
            </div>
        `
    },
    'guide-step1': {
        title: 'Step 1: Define Your Purpose',
        content: `
            <h3>Step 1: Define Your Purpose</h3>
            <p>Your purpose is the foundation of everything you do. It consists of three key components:</p>
            <div class="example-box">
                <strong>Vision:</strong> Where you want to be in the future (5-10 years). It should be inspiring and aspirational.
                <br><br>
                <strong>Values:</strong> What matters most to your organization. These guide behavior and decision-making.
                <br><br>
                <strong>Mission:</strong> Why your organization exists and what it does. It should be clear and actionable.
            </div>
        `
    },
    'guide-step2': {
        title: 'Step 2: Business Proponents',
        content: `
            <h3>Step 2: Business Proponents</h3>
            <p>Business proponents are the key functional areas that drive your business forward:</p>
            <div class="example-box">
                <strong>Marketing:</strong> How you attract and reach customers
                <br><br>
                <strong>Sales:</strong> How you convert prospects into customers
                <br><br>
                <strong>Operations:</strong> How you deliver products or services
                <br><br>
                <strong>Administration:</strong> How you manage the business infrastructure
            </div>
        `
    },
    'guide-step3': {
        title: 'Step 3: Mind Map',
        content: `
            <h3>Step 3: Mind Map</h3>
            <p>A mind map helps you visualize the relationships between different aspects of your business. It shows how various components connect and interact.</p>
            <div class="example-box">
                <strong>Tips:</strong>
                <ul>
                    <li>Start with your core business in the center</li>
                    <li>Branch out to major functions and processes</li>
                    <li>Show connections and dependencies</li>
                    <li>Include external factors (customers, suppliers, partners)</li>
                </ul>
            </div>
        `
    },
    'guide-step4': {
        title: 'Step 4: SWOT Analysis',
        content: `
            <h3>Step 4: SWOT Analysis</h3>
            <p>SWOT analysis helps you understand your internal and external environment:</p>
            <div class="example-box">
                <strong>Strengths:</strong> Internal positive attributes and resources
                <br><br>
                <strong>Weaknesses:</strong> Internal limitations and areas for improvement
                <br><br>
                <strong>Opportunities:</strong> External factors you can leverage
                <br><br>
                <strong>Threats:</strong> External challenges and risks
            </div>
        `
    },
    'guide-step5': {
        title: 'Step 5: Develop Strategy',
        content: `
            <h3>Step 5: Develop Strategy</h3>
            <p>Strategy development involves setting goals and determining how to achieve them:</p>
            <div class="example-box">
                <strong>Strategic Goals:</strong> High-level objectives aligned with your vision
                <br><br>
                <strong>Strategic Intent:</strong> The overall approach to achieving each goal
                <br><br>
                <strong>Drivers:</strong> Key actions and initiatives that will drive success
                <br><br>
                <strong>Enablers:</strong> Resources, capabilities, and support needed
            </div>
        `
    },
    'guide-step6': {
        title: 'Step 6: Plan Execution',
        content: `
            <h3>Step 6: Plan Execution</h3>
            <p>Execution planning turns strategy into action:</p>
            <div class="example-box">
                <strong>Targets & Initiatives:</strong> Specific, time-bound objectives and projects
                <br><br>
                <strong>KPIs:</strong> Key Performance Indicators to measure progress
                <br><br>
                <strong>Strategy Map:</strong> How you'll communicate, test, and validate your strategy
            </div>
        `
    },
    'guide-step7': {
        title: 'Step 7: Review & Complete',
        content: `
            <h3>Step 7: Review & Complete</h3>
            <p>Regular review ensures your plan stays relevant and effective:</p>
            <div class="example-box">
                <strong>Review Frequency:</strong> How often you'll review progress (monthly, quarterly, annually)
                <br><br>
                <strong>Success Criteria:</strong> Clear metrics for determining if you're on track
                <br><br>
                <strong>Notes:</strong> Important considerations, risks, and adjustments
            </div>
        `
    },
    'best-practices': {
        title: 'Strategic Planning Fundamentals',
        content: `
            <h3>Strategic Planning Fundamentals</h3>
            <div class="example-box">
                <strong>Best Practices:</strong>
                <ul>
                    <li>Involve key stakeholders in the planning process</li>
                    <li>Be realistic about resources and capabilities</li>
                    <li>Set measurable goals with clear timelines</li>
                    <li>Regularly review and adjust your plan</li>
                    <li>Communicate the plan throughout your organization</li>
                    <li>Focus on execution, not just planning</li>
                </ul>
            </div>
        `
    },
    'common-frameworks': {
        title: 'Common Frameworks',
        content: `
            <h3>Common Strategic Planning Frameworks</h3>
            <div class="example-box">
                <strong>SWOT Analysis:</strong> Strengths, Weaknesses, Opportunities, Threats
                <br><br>
                <strong>OKRs:</strong> Objectives and Key Results
                <br><br>
                <strong>Balanced Scorecard:</strong> Multiple perspectives on performance
                <br><br>
                <strong>Porter's Five Forces:</strong> Industry analysis framework
            </div>
        `
    },
    'expert-tips': {
        title: 'Expert Tips',
        content: `
            <h3>Expert Tips for Strategic Planning</h3>
            <div class="example-box">
                <strong>Tips:</strong>
                <ul>
                    <li>Start with your "why" - your purpose and vision</li>
                    <li>Be specific and measurable in your goals</li>
                    <li>Break large goals into smaller, actionable steps</li>
                    <li>Regularly track progress and adjust as needed</li>
                    <li>Celebrate wins along the way</li>
                    <li>Learn from failures and iterate</li>
                </ul>
            </div>
        `
    },
    'common-mistakes': {
        title: 'Common Mistakes to Avoid',
        content: `
            <h3>Common Mistakes to Avoid</h3>
            <div class="example-box">
                <strong>Mistakes:</strong>
                <ul>
                    <li>Creating a plan but not executing it</li>
                    <li>Setting unrealistic goals</li>
                    <li>Not involving key stakeholders</li>
                    <li>Failing to review and adjust regularly</li>
                    <li>Being too vague in goals and actions</li>
                    <li>Ignoring external factors and market changes</li>
                </ul>
            </div>
        `
    }
};

// Helper function to render video link (HBR prioritized, with basic option)
function renderVideoLink(contentKey) {
    const video = videoLinks[contentKey];
    if (!video) return '';

    const creator = (video.hbrCreator || video.creator || '').toString();
    const isHbr = creator.toLowerCase().includes('harvard business review');
    const headerLabel = isHbr ? 'üéì Harvard Business Review (Recommended):' : 'üéì Recommended Video:';
    const buttonLabel = isHbr ? 'Watch HBR Video' : 'Watch Video';
    const creditLabel = creator || (isHbr ? 'Harvard Business Review' : 'YouTube Creator');

    // If this video isn't actually HBR, strip any accidental "Harvard Business Review:" prefix in description.
    const desc = isHbr ? (video.description || '') : String(video.description || '').replace(/^Harvard Business Review:\s*/i, '');
    
    let html = `
        <div class="video-link-section collapsible collapsed">
            <div class="video-link-header" onclick="toggleVideoSection(this)">
                <h4>
                    <span>üìπ</span> Video Tutorials
                </h4>
                <button class="video-toggle-btn" aria-label="Toggle video section">+</button>
            </div>
            <div class="video-link-content">
            <div style="margin-bottom: 15px;">
                <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">${headerLabel}</p>
                <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">${desc}</p>
                <a href="${video.url}" target="_blank" rel="noopener noreferrer" 
                   class="video-link-btn" 
                   style="display: inline-flex; align-items: center; gap: 8px; background: #FF0000; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(255, 0, 0, 0.3); margin-bottom: 10px;">
                    <span>‚ñ∂Ô∏è</span> ${buttonLabel}
                </a>
                <div style="margin-top: 8px; font-size: 0.8em; color: var(--text-tertiary); font-style: italic;">
                    <p style="margin: 0;"><strong>Video Credit:</strong> ${creditLabel}</p>
                </div>
            </div>`;
    
    // Add basic video if available
    if (video.basicUrl) {
        html += `
            <div style="padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1);">
                <p style="color: var(--text-secondary); margin-bottom: 8px; font-size: 0.95em; font-weight: 600;">üìö Basic Tutorial (For Beginners):</p>
                <p style="color: var(--text-secondary); margin-bottom: 12px; font-size: 0.9em;">${video.basicDescription}</p>
                <a href="${video.basicUrl}" target="_blank" rel="noopener noreferrer" 
                   class="video-link-btn" 
                   style="display: inline-flex; align-items: center; gap: 8px; background: #6B7280; color: white; padding: 12px 20px; border-radius: var(--radius-full); text-decoration: none; font-weight: 600; transition: all 0.3s ease; box-shadow: 0 2px 8px rgba(107, 114, 128, 0.3); margin-bottom: 10px;">
                    <span>‚ñ∂Ô∏è</span> Watch Basic Tutorial
                </a>
                <div style="margin-top: 8px; font-size: 0.8em; color: var(--text-tertiary); font-style: italic;">
                    <p style="margin: 0;"><strong>Video Credit:</strong> ${video.basicCreator || 'YouTube Creator'}</p>
                </div>
            </div>`;
    }
    
    html += `
            <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(0,0,0,0.1); font-size: 0.75em; color: var(--text-tertiary); font-style: italic;">
                <p style="margin: 0;">This is an external link to a YouTube video. We do not own this content; it is linked for educational purposes only. Content is subject to YouTube's terms and may change or be removed by the original creator.</p>
            </div>
            </div>
        </div>`;
    return html;
}

function showLearnContent(key) {
    const content = learnContent[key];
    if (!content) return;
    
    const display = document.getElementById('learnContentDisplay');
    const text = document.getElementById('learnContentText');
    
    if (display && text) {
        let htmlContent = `<h3>${content.title}</h3>${content.content}`;
        // Add video link if available
        htmlContent += renderVideoLink(key);
        text.innerHTML = htmlContent;
        display.style.display = 'block';
        display.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }
}

function hideLearnContent() {
    const display = document.getElementById('learnContentDisplay');
    if (display) {
        display.style.display = 'none';
    }
}

// Contextual Help Functions
function closeContextualHelp(event) {
    if (event && event.target !== event.currentTarget) return;
    const modal = document.getElementById('contextualHelpModal');
    if (modal) {
        modal.classList.remove('show');
    }
}

// Update restoreUserData to work with new button container
function restoreUserData() {
    if (!userDataBackup) {
        // No backup means user hasn't entered anything, so clear the form
        clearForm();
    } else {
        // Restore the user's data
        planData = JSON.parse(JSON.stringify(userDataBackup));
        userDataBackup = null;
        
        // Populate the form with user's data
        populateForm();
    }
    
    // Update UI
    updateStepCompletion();
    updateProgress();
    setupCharacterCounts();
    
    // Hide "Your Data" button and show template button again
    const container = document.getElementById('yourDataButtonContainer');
    if (container) {
        container.style.display = 'none';
    }
    
    // Save restored/cleared data
    saveData();
}

// Initialize when page loads
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', init);
} else {
    init();
}

// ============================================================================
// Authentication and Unified Save System
// ============================================================================

var currentUser = null;
var isLoggedIn = false;

// Initialize authentication on page load
function initAuth() {
    var session = sessionStorage.getItem('prototype_userSession');
    if (session) {
        try {
            var sessionData = JSON.parse(session);
            currentUser = sessionData.user;
            isLoggedIn = true;
            // Auto-load user's data ONLY after confirming login
            loadSavedData();
        } catch (e) {
            console.log('Session invalid');
            logout();
        }
    } else {
        // No session - ensure we're in a clean state
        currentUser = null;
        isLoggedIn = false;
    }
}

// Logout user
function logout() {
    // Persist latest edits before clearing session (so data survives log out / browser close)
    try { saveData(); } catch (e) { /* ignore */ }
    currentUser = null;
    isLoggedIn = false;
    sessionStorage.removeItem('prototype_userSession');
    // Clear form when logged out
    window.__suppressStrategicPlanAutosave = true;
    clearForm();
    // Re-enable autosave after the clear has completed
    setTimeout(function() { window.__suppressStrategicPlanAutosave = false; }, 0);
}

// Collect all prototype data into unified structure
function collectAllPrototypeData() {
    // Save current form data first
    saveData();
    
    var allData = {
        strategicPlan: null,
        savedGoals: null,
        strategicCanvas: null,
        goalSettingTemplate: null,
        strategicActionPlan: null,
        portersFiveForces: null,
        lastSaved: new Date().toISOString()
    };
    
    var username = getCurrentUsername();
    if (!username) {
        return allData;
    }
    
    // Get strategic plan data (user-specific)
    try {
        var saved = localStorage.getItem('prototype_strategicPlan_' + username);
        if (saved) {
            allData.strategicPlan = JSON.parse(saved);
        }
    } catch (e) {
        console.log('Could not load strategic plan data');
    }
    
    // Get saved goals (user-specific)
    try {
        var savedGoals = localStorage.getItem('prototype_savedGoals_' + username);
        if (savedGoals) {
            allData.savedGoals = JSON.parse(savedGoals);
        }
    } catch (e) {
        console.log('Could not load saved goals');
    }
    
    // Get strategic canvas data (user-specific)
    try {
        var canvasData = localStorage.getItem('strategicCanvasData_' + username);
        if (canvasData) {
            allData.strategicCanvas = JSON.parse(canvasData);
        }
    } catch (e) {
        console.log('Could not load strategic canvas data');
    }
    
    // Get goal setting template data (user-specific)
    try {
        var goalData = localStorage.getItem('goalSettingTemplateData_' + username);
        if (goalData) {
            allData.goalSettingTemplate = JSON.parse(goalData);
        }
    } catch (e) {
        console.log('Could not load goal setting template data');
    }
    
    // Get strategic action plan data (user-specific)
    try {
        var actionPlanData = localStorage.getItem('strategicActionPlanData_' + username);
        if (actionPlanData) {
            allData.strategicActionPlan = JSON.parse(actionPlanData);
        }
    } catch (e) {
        console.log('Could not load strategic action plan data');
    }
    
    // Get Porter's Five Forces data (user-specific)
    try {
        var forcesData = localStorage.getItem('portersFiveForcesData_' + username);
        if (forcesData) {
            allData.portersFiveForces = JSON.parse(forcesData);
        }
    } catch (e) {
        console.log('Could not load Porter\'s Five Forces data');
    }
    
    return allData;
}




// Initialize authentication on page load
if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initAuth);
} else {
    initAuth();
}

    </script>

    <!-- Contextual Help Modal (if needed for future enhancements) -->
    <div class="contextual-help-modal" id="contextualHelpModal" onclick="closeContextualHelp(event)">
        <div class="contextual-help-content" onclick="event.stopPropagation()">
            <button class="contextual-help-close" onclick="closeContextualHelp()">&times;</button>
            <div id="contextualHelpContent"></div>
        </div>
    </div>

    <!-- Examples Mode Overlay -->
    <div class="examples-mode-overlay" id="examplesModeOverlay">
        <button class="examples-close-btn" onclick="toggleExamplesMode()">‚úñÔ∏è Close Examples</button>
        <div style="max-width: 1200px; margin: 0 auto; padding: 20px;">
            <h3>Example Strategic Plan</h3>
            <div id="examplesModeContent"></div>
        </div>
    </div>

    <!-- Learn Menu Modal -->
    <div class="learn-menu" id="learnMenu" onclick="closeLearnMenu(event)">
        <div class="learn-menu-content" onclick="event.stopPropagation()">
            <button class="learn-menu-close" onclick="closeLearnMenu()">&times;</button>
            <h2>üìö Learn Center</h2>
            <div class="learn-section">
                <h3>Strategic Planning Guide</h3>
                <ul>
                    <li onclick="showLearnContent('guide-overview')">What is Strategic Planning?</li>
                    <li onclick="showLearnContent('guide-step1')">Step 1: Define Your Purpose</li>
                    <li onclick="showLearnContent('guide-step2')">Step 2: Business Proponents</li>
                    <li onclick="showLearnContent('guide-step3')">Step 3: Mind Map</li>
                    <li onclick="showLearnContent('guide-step4')">Step 4: SWOT Analysis</li>
                    <li onclick="showLearnContent('guide-step5')">Step 5: Develop Strategy</li>
                    <li onclick="showLearnContent('guide-step6')">Step 6: Plan Execution</li>
                    <li onclick="showLearnContent('guide-step7')">Step 7: Review & Complete</li>
                </ul>
            </div>
            <div class="learn-section">
                <h3>Best Practices</h3>
                <ul>
                    <li onclick="showLearnContent('best-practices')">Strategic Planning Fundamentals</li>
                    <li onclick="showLearnContent('common-frameworks')">Common Frameworks</li>
                    <li onclick="showLearnContent('expert-tips')">Expert Tips</li>
                    <li onclick="showLearnContent('common-mistakes')">Common Mistakes to Avoid</li>
                </ul>
            </div>
            <div id="learnContentDisplay" style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #0f4c75; display: none;">
                <div id="learnContentText"></div>
                <button onclick="hideLearnContent()" style="margin-top: 15px; padding: 8px 16px; background: #0f4c75; color: white; border: none; border-radius: 6px; cursor: pointer;">Close</button>
            </div>
        </div>
    </div>

    <!-- Template Library Modal -->
    <div class="template-library" id="templateLibrary" onclick="closeTemplateLibrary(event)">
        <div class="template-library-content" onclick="event.stopPropagation()">
            <button class="contextual-help-close" onclick="closeTemplateLibrary()">&times;</button>
            <h3 style="color: #0f4c75; margin-bottom: 20px;">üìö Template Library</h3>
            <p style="color: #666; margin-bottom: 20px;">Choose a template to load example data and learn best practices:</p>
            <div class="template-list" id="templateList">
                <!-- Templates will be loaded here -->
            </div>
        </div>
    </div>

</body>
</html>
